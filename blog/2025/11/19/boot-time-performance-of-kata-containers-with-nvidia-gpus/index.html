
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Landon's personal life and coding blog">
      
      
        <meta name="author" content="Landon Clipp">
      
      
        <link rel="canonical" href="https://topofmind.dev/blog/2025/11/19/boot-time-performance-of-kata-containers-with-nvidia-gpus/">
      
      
        <link rel="prev" href="../../../10/21/gpu-based-containers-as-a-service/">
      
      
        <link rel="next" href="../../../12/09/colorado-san-juan-mountains/">
      
      
        
      
      
        <link rel="alternate" type="application/rss+xml" title="RSS feed" href="../../../../../feed_rss_created.xml">
        <link rel="alternate" type="application/rss+xml" title="RSS feed of updated content" href="../../../../../feed_rss_updated.xml">
      
      <link rel="icon" href="../../../../../assets/images/favicon.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Boot-time Performance of Kata Containers With NVIDIA GPUs - Top of Mind</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    




<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i%7CPress+Start+2P:300,300i,400,400i,700,700i&display=fallback">
<style>
:root{
    --md-text-font:"Roboto";
    --md-code-font:"Roboto Mono";
    --md-header-font:"Press Start 2P";
}
</style>


    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-F9YVCCMVEX"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-F9YVCCMVEX",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-F9YVCCMVEX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  
<meta property="og:type" content="website" />
<meta property="og:title" content="Boot-time Performance of Kata Containers With NVIDIA GPUs - Top of Mind" />
<meta property="og:description" content="Landon's personal life and coding blog" />
<meta property="og:image" content="https://topofmind.dev/assets/images/social/blog/2025/11/19/boot-time-performance-of-kata-containers-with-nvidia-gpus.png" />
<meta property="og:image:type" content="image/png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:url" content="https://topofmind.dev/blog/2025/11/19/boot-time-performance-of-kata-containers-with-nvidia-gpus/" />
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter.title" content="Boot-time Performance of Kata Containers With NVIDIA GPUs - Top of Mind" />
<meta property="twitter:description" content="Landon's personal life and coding blog" />
<meta property="twitter:image" content="https://topofmind.dev/assets/images/social/blog/2025/11/19/boot-time-performance-of-kata-containers-with-nvidia-gpus.png" />
 <link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#vm-console-logs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Top of Mind" class="md-header__button md-logo" aria-label="Top of Mind" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 21v-3H3l5-5H5l5-5H7l5-5 5 5h-3l5 5h-3l5 5h-7v3z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Top of Mind
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Boot-time Performance of Kata Containers With NVIDIA GPUs
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/LandonTClipp/LandonTClipp.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    LandonTClipp.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        
  
  
    
  
  Welcome!

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../notes/" class="md-tabs__link">
          
  
  
    
  
  Notes

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../misc/suggested-readings/" class="md-tabs__link">
          
  
  
    
  
  Misc

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Top of Mind" class="md-nav__button md-logo" aria-label="Top of Mind" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 21v-3H3l5-5H5l5-5H7l5-5 5 5h-3l5 5h-3l5 5h-7v3z"/></svg>

    </a>
    Top of Mind
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/LandonTClipp/LandonTClipp.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    LandonTClipp.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome!
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Blog
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blog
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Archive
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Archive
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2026/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      2026
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      2025
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      2024
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      2023
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2018/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      2018
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Categories
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Categories
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/aws/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      AWS
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/career/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Career
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/cloud/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Cloud
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/gpu-virtualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      GPU Virtualization
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/golang/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Golang
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/grafana/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Grafana
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/math/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Math
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/misc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Misc
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/poems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Poems
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/programming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Programming
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Python
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/rv/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      RV
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/system-administration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      System Administration
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/system-design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      System Design
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../../notes/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    Notes
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Notes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Programming
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Programming
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/programming/bash/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 9h2.31l.32-3h2l-.32 3h2l.32-3h2l-.32 3H15v2h-1.9l-.2 2H15v2h-2.31l-.32 3h-2l.32-3h-2l-.32 3h-2l.32-3H5v-2h1.9l.2-2H5zm4.1 2-.2 2h2l.2-2M19 6h-2v8h2m0 2h-2v2h2Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Bash
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/programming/computer-science/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-3.1 3.9s-.7-.3-1-.3c-.6-.1-1 .1-1.2 1.1L12 16.8c-.2.8-.5 1.4-1 1.8-.4.3-.8.4-1.3.4-.8 0-2-.5-2-.5l.5-1.4s.8.3 1 .3c.3.1.5 0 .7-.1s.3-.4.4-.7l1.6-9.2c.1-.8.5-1.4 1-1.9.6-.4 1.3-.5 2.1-.4.7.1 1.5.5 1.5.5z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Computer Science
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/programming/golang/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M1.811 10.231c-.047 0-.058-.023-.035-.059l.246-.315c.023-.035.081-.058.128-.058h4.172c.046 0 .058.035.035.07l-.199.303c-.023.036-.082.07-.117.07zM.047 11.306c-.047 0-.059-.023-.035-.058l.245-.316c.023-.035.082-.058.129-.058h5.328c.047 0 .07.035.058.07l-.093.28c-.012.047-.058.07-.105.07zm2.828 1.075c-.047 0-.059-.035-.035-.07l.163-.292c.023-.035.07-.07.117-.07h2.337c.047 0 .07.035.07.082l-.023.28c0 .047-.047.082-.082.082zm12.129-2.36c-.736.187-1.239.327-1.963.514-.176.046-.187.058-.34-.117-.174-.199-.303-.327-.548-.444-.737-.362-1.45-.257-2.115.175-.795.514-1.204 1.274-1.192 2.22.011.935.654 1.706 1.577 1.835.795.105 1.46-.175 1.987-.77.105-.13.198-.27.315-.434H10.47c-.245 0-.304-.152-.222-.35.152-.362.432-.97.596-1.274a.32.32 0 0 1 .292-.187h4.253c-.023.316-.023.631-.07.947a5 5 0 0 1-.958 2.29c-.841 1.11-1.94 1.8-3.33 1.986-1.145.152-2.209-.07-3.143-.77-.865-.655-1.356-1.52-1.484-2.595-.152-1.274.222-2.419.993-3.424.83-1.086 1.928-1.776 3.272-2.02 1.098-.2 2.15-.07 3.096.571.62.41 1.063.97 1.356 1.648.07.105.023.164-.117.2m3.868 6.461c-1.064-.024-2.034-.328-2.852-1.029a3.67 3.67 0 0 1-1.262-2.255c-.21-1.32.152-2.489.947-3.529.853-1.122 1.881-1.706 3.272-1.95 1.192-.21 2.314-.095 3.33.595.923.63 1.496 1.484 1.648 2.605.198 1.578-.257 2.863-1.344 3.962-.771.783-1.718 1.273-2.805 1.495-.315.06-.63.07-.934.106m2.78-4.72c-.011-.153-.011-.27-.034-.387-.21-1.157-1.274-1.81-2.384-1.554-1.087.245-1.788.935-2.045 2.033-.21.912.234 1.835 1.075 2.21.643.28 1.285.244 1.905-.07.923-.48 1.425-1.228 1.484-2.233z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Golang
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/programming/javascript/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0zm22.034 18.276c-.175-1.095-.888-2.015-3.003-2.873-.736-.345-1.554-.585-1.797-1.14-.091-.33-.105-.51-.046-.705.15-.646.915-.84 1.515-.66.39.12.75.42.976.9 1.034-.676 1.034-.676 1.755-1.125-.27-.42-.404-.601-.586-.78-.63-.705-1.469-1.065-2.834-1.034l-.705.089c-.676.165-1.32.525-1.71 1.005-1.14 1.291-.811 3.541.569 4.471 1.365 1.02 3.361 1.244 3.616 2.205.24 1.17-.87 1.545-1.966 1.41-.811-.18-1.26-.586-1.755-1.336l-1.83 1.051c.21.48.45.689.81 1.109 1.74 1.756 6.09 1.666 6.871-1.004.029-.09.24-.705.074-1.65zm-8.983-7.245h-2.248c0 1.938-.009 3.864-.009 5.805 0 1.232.063 2.363-.138 2.711-.33.689-1.18.601-1.566.48-.396-.196-.597-.466-.83-.855-.063-.105-.11-.196-.127-.196l-1.825 1.125c.305.63.75 1.172 1.324 1.517.855.51 2.004.675 3.207.405.783-.226 1.458-.691 1.811-1.411.51-.93.402-2.07.397-3.346.012-2.054 0-4.109 0-6.179z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Javascript
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/programming/leetcode/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.483 0a1.37 1.37 0 0 0-.961.438L7.116 6.226l-3.854 4.126a5.3 5.3 0 0 0-1.209 2.104 5 5 0 0 0-.125.513 5.5 5.5 0 0 0 .062 2.362 6 6 0 0 0 .349 1.017 5.9 5.9 0 0 0 1.271 1.818l4.277 4.193.039.038c2.248 2.165 5.852 2.133 8.063-.074l2.396-2.392c.54-.54.54-1.414.003-1.955a1.38 1.38 0 0 0-1.951-.003l-2.396 2.392a3.02 3.02 0 0 1-4.205.038l-.02-.019-4.276-4.193c-.652-.64-.972-1.469-.948-2.263a2.7 2.7 0 0 1 .066-.523 2.55 2.55 0 0 1 .619-1.164L9.13 8.114c1.058-1.134 3.204-1.27 4.43-.278l3.501 2.831c.593.48 1.461.387 1.94-.207a1.384 1.384 0 0 0-.207-1.943l-3.5-2.831c-.8-.647-1.766-1.045-2.774-1.202l2.015-2.158A1.384 1.384 0 0 0 13.483 0m-2.866 12.815a1.38 1.38 0 0 0-1.38 1.382 1.38 1.38 0 0 0 1.38 1.382H20.79a1.38 1.38 0 0 0 1.38-1.382 1.38 1.38 0 0 0-1.38-1.382z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Leetcode
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/programming/python/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.25.18.9.2.73.26.59.3.45.32.34.34.25.34.16.33.1.3.04.26.02.2-.01.13V8.5l-.05.63-.13.55-.21.46-.26.38-.3.31-.33.25-.35.19-.35.14-.33.1-.3.07-.26.04-.21.02H8.77l-.69.05-.59.14-.5.22-.41.27-.33.32-.27.35-.2.36-.15.37-.1.35-.07.32-.04.27-.02.21v3.06H3.17l-.21-.03-.28-.07-.32-.12-.35-.18-.36-.26-.36-.36-.35-.46-.32-.59-.28-.73-.21-.88-.14-1.05-.05-1.23.06-1.22.16-1.04.24-.87.32-.71.36-.57.4-.44.42-.33.42-.24.4-.16.36-.1.32-.05.24-.01h.16l.06.01h8.16v-.83H6.18l-.01-2.75-.02-.37.05-.34.11-.31.17-.28.25-.26.31-.23.38-.2.44-.18.51-.15.58-.12.64-.1.71-.06.77-.04.84-.02 1.27.05zm-6.3 1.98-.23.33-.08.41.08.41.23.34.33.22.41.09.41-.09.33-.22.23-.34.08-.41-.08-.41-.23-.33-.33-.22-.41-.09-.41.09zm13.09 3.95.28.06.32.12.35.18.36.27.36.35.35.47.32.59.28.73.21.88.14 1.04.05 1.23-.06 1.23-.16 1.04-.24.86-.32.71-.36.57-.4.45-.42.33-.42.24-.4.16-.36.09-.32.05-.24.02-.16-.01h-8.22v.82h5.84l.01 2.76.02.36-.05.34-.11.31-.17.29-.25.25-.31.24-.38.2-.44.17-.51.15-.58.13-.64.09-.71.07-.77.04-.84.01-1.27-.04-1.07-.14-.9-.2-.73-.25-.59-.3-.45-.33-.34-.34-.25-.34-.16-.33-.1-.3-.04-.25-.02-.2.01-.13v-5.34l.05-.64.13-.54.21-.46.26-.38.3-.32.33-.24.35-.2.35-.14.33-.1.3-.06.26-.04.21-.02.13-.01h5.84l.69-.05.59-.14.5-.21.41-.28.33-.32.27-.35.2-.36.15-.36.1-.35.07-.32.04-.28.02-.21V6.07h2.09l.14.01zm-6.47 14.25-.23.33-.08.41.08.41.23.33.33.23.41.08.41-.08.33-.23.23-.33.08-.41-.08-.41-.23-.33-.33-.23-.41-.08-.41.08z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Python
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/programming/tools/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m21.71 20.29-1.42 1.42a1 1 0 0 1-1.41 0L7 9.85A3.8 3.8 0 0 1 6 10a4 4 0 0 1-3.78-5.3l2.54 2.54.53-.53 1.42-1.42.53-.53L4.7 2.22A4 4 0 0 1 10 6a3.8 3.8 0 0 1-.15 1l11.86 11.88a1 1 0 0 1 0 1.41M2.29 18.88a1 1 0 0 0 0 1.41l1.42 1.42a1 1 0 0 0 1.41 0l5.47-5.46-2.83-2.83M20 2l-4 2v2l-2.17 2.17 2 2L18 8h2l2-4Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/programming/vim/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M24 11.986h-.027l-4.318-4.318 4.303-4.414V1.461l-.649-.648h-8.198l-.66.605v1.045L12.015.027V0L12 .014 11.986 0v.027l-1.29 1.291-.538-.539H2.035l-.638.692v1.885l.616.616h.72v5.31L.027 11.987H0L.014 12 0 12.014h.027l2.706 2.706v6.467l.907.523h2.322l1.857-1.904 4.166 4.166V24l.015-.014.014.014v-.028l2.51-2.509h.485c.111 0 .211-.07.25-.179l.146-.426a.26.26 0 0 0-.037-.239l1.462-1.462-.612 1.962a.265.265 0 0 0 .255.344h1.824a.27.27 0 0 0 .243-.163l.165-.394a.27.27 0 0 0-.247-.365h-.075l.84-2.644h1.232l-1.016 3.221a.266.266 0 0 0 .255.344h2.002c.11 0 .207-.066.248-.17l.164-.428a.266.266 0 0 0-.249-.358h-.145l1.131-3.673a.26.26 0 0 0-.039-.24l-.375-.504-.003-.005a.27.27 0 0 0-.209-.102h-1.436a.27.27 0 0 0-.19.081l-.4.439h-.624l-.042-.046 4.445-4.445H24L23.986 12zM9.838 21.139l1.579-4.509h-.501l.297-.304h1.659l-1.563 4.555h.623l-.079.258zm3.695-7.516.15.151-.269.922-.225.226h-.969l-.181-.181.311-.871.288-.247zM5.59 20.829H3.877l-.262-.15V3.091H2.379l-.1-.1V1.815l.143-.154h7.371l.213.214v1.108l-.142.173H8.785v8.688l8.807-8.688h-2.086l-.175-.188V1.805l.121-.111h7.49l.132.133v1.07L12.979 13.25h-.373q-.022-.001-.042.001l-.02.003a.26.26 0 0 0-.119.06l-.343.295-.004.003a.3.3 0 0 0-.073.111l-.296.83zm14.768-3.952.474-.519h1.334l.309.415-1.265 4.107h.493l-.08.209H19.84l1.124-3.564h-2.015l-1.077 3.391h.424l-.073.174h-1.605l1.107-3.548h-2.096l-1.062 3.339h.436l-.072.209H13.27l1.514-4.46h-.586l.091-.271h1.65l.519.537h.906l.491-.554h1.061l.489.535z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Vim
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/programming/yaml/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m0 .97 4.111 6.453v4.09h2.638v-4.09L11.053.969H8.214L5.58 5.125 2.965.969Zm12.093.024-4.47 10.544h2.114l.97-2.345h4.775l.804 2.345h2.26L14.255.994Zm1.133 2.225 1.463 3.87h-3.096zm3.06 9.475v10.29H24v-2.199h-5.454v-8.091zm-12.175.002v10.335h2.217v-7.129l2.32 4.792h1.746l2.4-4.96v7.295h2.127V12.696h-2.904L9.44 17.37l-2.455-4.674Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    YAML
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    System Administration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    System Administration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/databases/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 3.5c0-.626.292-1.165.7-1.59.406-.422.956-.767 1.579-1.041C4.525.32 6.195 0 8 0s3.475.32 4.722.869c.622.274 1.172.62 1.578 1.04.408.426.7.965.7 1.591v9c0 .626-.292 1.165-.7 1.59-.406.422-.956.767-1.579 1.041C11.476 15.68 9.806 16 8 16c-1.805 0-3.475-.32-4.721-.869-.623-.274-1.173-.62-1.579-1.04-.408-.426-.7-.965-.7-1.591Zm1.5 0c0 .133.058.318.282.551.227.237.591.483 1.101.707C4.898 5.205 6.353 5.5 8 5.5s3.101-.295 4.118-.742c.508-.224.873-.471 1.1-.708.224-.232.282-.417.282-.55s-.058-.318-.282-.551c-.227-.237-.591-.483-1.101-.707C11.102 1.795 9.647 1.5 8 1.5s-3.101.295-4.118.742c-.508.224-.873.471-1.1.708-.224.232-.282.417-.282.55m0 4.5c0 .133.058.318.282.551.227.237.591.483 1.101.707C4.898 9.705 6.353 10 8 10s3.101-.295 4.118-.742c.508-.224.873-.471 1.1-.708.224-.232.282-.417.282-.55V5.724c-.241.15-.503.286-.778.407C11.475 6.68 9.805 7 8 7s-3.475-.32-4.721-.869a6 6 0 0 1-.779-.407Zm0 2.225V12.5c0 .133.058.318.282.55.227.237.592.484 1.1.708 1.016.447 2.471.742 4.118.742s3.102-.295 4.117-.742c.51-.224.874-.47 1.101-.707.224-.233.282-.418.282-.551v-2.275c-.241.15-.503.285-.778.406-1.247.549-2.917.869-4.722.869s-3.475-.32-4.721-.869a6 6 0 0 1-.779-.406"/></svg>
  
  <span class="md-ellipsis">
    
  
    Databases
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_3_2" id="__nav_3_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Filesystems
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Filesystems
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/cvmfs/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"/></svg>
  
  <span class="md-ellipsis">
    
  
    CVMFS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/nfs/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2 1.75C2 .784 2.784 0 3.75 0h6.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v9.586A1.75 1.75 0 0 1 13.25 16h-9.5A1.75 1.75 0 0 1 2 14.25Zm1.75-.25a.25.25 0 0 0-.25.25v12.5c0 .138.112.25.25.25h9.5a.25.25 0 0 0 .25-.25V6h-2.75A1.75 1.75 0 0 1 9 4.25V1.5Zm6.75.062V4.25c0 .138.112.25.25.25h2.688l-.011-.013-2.914-2.914z"/></svg>
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      NFS
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3_3" id="__nav_3_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Hardware
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Hardware
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/bmc/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 1h12.5c.966 0 1.75.784 1.75 1.75v4c0 .372-.116.717-.314 1 .198.283.314.628.314 1v4a1.75 1.75 0 0 1-1.75 1.75H1.75A1.75 1.75 0 0 1 0 12.75v-4c0-.358.109-.707.314-1a1.74 1.74 0 0 1-.314-1v-4C0 1.784.784 1 1.75 1M1.5 2.75v4c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25v-4a.25.25 0 0 0-.25-.25H1.75a.25.25 0 0 0-.25.25m.25 5.75a.25.25 0 0 0-.25.25v4c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25v-4a.25.25 0 0 0-.25-.25ZM7 4.75A.75.75 0 0 1 7.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5A.75.75 0 0 1 7 4.75M7.75 10h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5M3 4.75A.75.75 0 0 1 3.75 4h.5a.75.75 0 0 1 0 1.5h-.5A.75.75 0 0 1 3 4.75M3.75 10h.5a.75.75 0 0 1 0 1.5h-.5a.75.75 0 0 1 0-1.5"/></svg>
  
  <span class="md-ellipsis">
    
  
    BMC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/cpu/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.5.75V2h3V.75a.75.75 0 0 1 1.5 0V2h1.25c.966 0 1.75.784 1.75 1.75V5h1.25a.75.75 0 0 1 0 1.5H14v3h1.25a.75.75 0 0 1 0 1.5H14v1.25A1.75 1.75 0 0 1 12.25 14H11v1.25a.75.75 0 0 1-1.5 0V14h-3v1.25a.75.75 0 0 1-1.5 0V14H3.75A1.75 1.75 0 0 1 2 12.25V11H.75a.75.75 0 0 1 0-1.5H2v-3H.75a.75.75 0 0 1 0-1.5H2V3.75C2 2.784 2.784 2 3.75 2H5V.75a.75.75 0 0 1 1.5 0m5.75 11.75a.25.25 0 0 0 .25-.25v-8.5a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25v8.5c0 .138.112.25.25.25ZM5.75 5h4.5a.75.75 0 0 1 .75.75v4.5a.75.75 0 0 1-.75.75h-4.5a.75.75 0 0 1-.75-.75v-4.5A.75.75 0 0 1 5.75 5m.75 4.5h3v-3h-3Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    CPU
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/gpu/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.948 8.798v-1.43a7 7 0 0 1 .424-.018c3.922-.124 6.493 3.374 6.493 3.374s-2.774 3.851-5.75 3.851a3.7 3.7 0 0 1-1.158-.185v-4.346c1.528.185 1.837.857 2.747 2.385l2.04-1.714s-1.492-1.952-4-1.952a6 6 0 0 0-.796.035m0-4.735v2.138l.424-.027c5.45-.185 9.01 4.47 9.01 4.47s-4.08 4.964-8.33 4.964a6.5 6.5 0 0 1-1.095-.097v1.325c.3.035.61.062.91.062 3.957 0 6.82-2.023 9.593-4.408.459.371 2.34 1.263 2.73 1.652-2.633 2.208-8.772 3.984-12.253 3.984-.335 0-.653-.018-.971-.053v1.864H24V4.063zm0 10.326v1.131c-3.657-.654-4.673-4.46-4.673-4.46s1.758-1.944 4.673-2.262v1.237H8.94c-1.528-.186-2.73 1.245-2.73 1.245s.68 2.412 2.739 3.11M2.456 10.9s2.164-3.197 6.5-3.533V6.201C4.153 6.59 0 10.653 0 10.653s2.35 6.802 8.948 7.42v-1.237c-4.84-.6-6.492-5.936-6.492-5.936"/></svg>
  
  <span class="md-ellipsis">
    
  
    GPU
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/misc/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13M6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75M8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/></svg>
  
  <span class="md-ellipsis">
    
  
    Misc
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/storage/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 3.5c0-.626.292-1.165.7-1.59.406-.422.956-.767 1.579-1.041C4.525.32 6.195 0 8 0s3.475.32 4.722.869c.622.274 1.172.62 1.578 1.04.408.426.7.965.7 1.591v9c0 .626-.292 1.165-.7 1.59-.406.422-.956.767-1.579 1.041C11.476 15.68 9.806 16 8 16c-1.805 0-3.475-.32-4.721-.869-.623-.274-1.173-.62-1.579-1.04-.408-.426-.7-.965-.7-1.591Zm1.5 0c0 .133.058.318.282.551.227.237.591.483 1.101.707C4.898 5.205 6.353 5.5 8 5.5s3.101-.295 4.118-.742c.508-.224.873-.471 1.1-.708.224-.232.282-.417.282-.55s-.058-.318-.282-.551c-.227-.237-.591-.483-1.101-.707C11.102 1.795 9.647 1.5 8 1.5s-3.101.295-4.118.742c-.508.224-.873.471-1.1.708-.224.232-.282.417-.282.55m0 4.5c0 .133.058.318.282.551.227.237.591.483 1.101.707C4.898 9.705 6.353 10 8 10s3.101-.295 4.118-.742c.508-.224.873-.471 1.1-.708.224-.232.282-.417.282-.55V5.724c-.241.15-.503.286-.778.407C11.475 6.68 9.805 7 8 7s-3.475-.32-4.721-.869a6 6 0 0 1-.779-.407Zm0 2.225V12.5c0 .133.058.318.282.55.227.237.592.484 1.1.708 1.016.447 2.471.742 4.118.742s3.102-.295 4.117-.742c.51-.224.874-.47 1.101-.707.224-.233.282-.418.282-.551v-2.275c-.241.15-.503.285-.778.406-1.247.549-2.917.869-4.722.869s-3.475-.32-4.721-.869a6 6 0 0 1-.779-.406"/></svg>
  
  <span class="md-ellipsis">
    
  
    Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/k8s/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10.204 14.35.007.01-.999 2.413a5.17 5.17 0 0 1-2.075-2.597l2.578-.437.004.005a.44.44 0 0 1 .484.606zm-.833-2.129a.44.44 0 0 0 .173-.756l.002-.011L7.585 9.7a5.14 5.14 0 0 0-.73 3.255l2.514-.725zm1.145-1.98a.44.44 0 0 0 .699-.337l.01-.005.15-2.62a5.14 5.14 0 0 0-3.01 1.442l2.147 1.523zm.76 2.75.723.349.722-.347.18-.78-.5-.623h-.804l-.5.623.179.779zm1.5-3.095a.44.44 0 0 0 .7.336l.008.003 2.134-1.513a5.2 5.2 0 0 0-2.992-1.442l.148 2.615zm10.876 5.97-5.773 7.181a1.6 1.6 0 0 1-1.248.594l-9.261.003a1.6 1.6 0 0 1-1.247-.596l-5.776-7.18a1.58 1.58 0 0 1-.307-1.34L2.1 5.573c.108-.47.425-.864.863-1.073L11.305.513a1.6 1.6 0 0 1 1.385 0l8.345 3.985c.438.209.755.604.863 1.073l2.062 8.955c.108.47-.005.963-.308 1.34m-3.289-2.057c-.042-.01-.103-.026-.145-.034-.174-.033-.315-.025-.479-.038-.35-.037-.638-.067-.895-.148-.105-.04-.18-.165-.216-.216l-.201-.059a6.5 6.5 0 0 0-.105-2.332 6.5 6.5 0 0 0-.936-2.163c.052-.047.15-.133.177-.159.008-.09.001-.183.094-.282.197-.185.444-.338.743-.522.142-.084.273-.137.415-.242.032-.024.076-.062.11-.089.24-.191.295-.52.123-.736s-.506-.236-.745-.045c-.034.027-.08.062-.111.088-.134.116-.217.23-.33.35-.246.25-.45.458-.673.609-.097.056-.239.037-.303.033l-.19.135a6.55 6.55 0 0 0-4.146-2.003l-.012-.223c-.065-.062-.143-.115-.163-.25-.022-.268.015-.557.057-.905.023-.163.061-.298.068-.475.001-.04-.001-.099-.001-.142 0-.306-.224-.555-.5-.555-.275 0-.499.249-.499.555l.001.014c0 .041-.002.092 0 .128.006.177.044.312.067.475.042.348.078.637.056.906a.55.55 0 0 1-.162.258l-.012.211a6.42 6.42 0 0 0-4.166 2.003l-.18-.128c-.09.012-.18.04-.297-.029-.223-.15-.427-.358-.673-.608-.113-.12-.195-.234-.329-.349l-.111-.088a.6.6 0 0 0-.348-.132.48.48 0 0 0-.398.176c-.172.216-.117.546.123.737l.007.005.104.083c.142.105.272.159.414.242.299.185.546.338.743.522.076.082.09.226.1.288l.16.143a6.46 6.46 0 0 0-1.02 4.506l-.208.06c-.055.072-.133.184-.215.217-.257.081-.546.11-.895.147-.164.014-.305.006-.48.039-.037.007-.09.02-.133.03l-.004.002-.007.002c-.295.071-.484.342-.423.608.061.267.349.429.645.365l.007-.001.01-.003.129-.029c.17-.046.294-.113.448-.172.33-.118.604-.217.87-.256.112-.009.23.069.288.101l.217-.037a6.5 6.5 0 0 0 2.88 3.596l-.09.218c.033.084.069.199.044.282-.097.252-.263.517-.452.813-.091.136-.185.242-.268.399-.02.037-.045.095-.064.134-.128.275-.034.591.213.71.248.12.556-.007.69-.282v-.002c.02-.039.046-.09.062-.127.07-.162.094-.301.144-.458.132-.332.205-.68.387-.897.05-.06.13-.082.215-.105l.113-.205a6.45 6.45 0 0 0 4.609.012l.106.192c.086.028.18.042.256.155.136.232.229.507.342.84.05.156.074.295.145.457.016.037.043.09.062.129.133.276.442.402.69.282.247-.118.341-.435.213-.71-.02-.039-.045-.096-.065-.134-.083-.156-.177-.261-.268-.398-.19-.296-.346-.541-.443-.793-.04-.13.007-.21.038-.294-.018-.022-.059-.144-.083-.202a6.5 6.5 0 0 0 2.88-3.622c.064.01.176.03.213.038.075-.05.144-.114.28-.104.266.039.54.138.87.256.154.06.277.128.448.173.036.01.088.019.13.028l.009.003.007.001c.297.064.584-.098.645-.365.06-.266-.128-.537-.423-.608M16.4 9.701l-1.95 1.746v.005a.44.44 0 0 0 .173.757l.003.01 2.526.728a5.2 5.2 0 0 0-.108-1.674A5.2 5.2 0 0 0 16.4 9.7zm-4.013 5.325a.44.44 0 0 0-.404-.232.44.44 0 0 0-.372.233h-.002l-1.268 2.292a5.16 5.16 0 0 0 3.326.003l-1.27-2.296zm1.888-1.293a.44.44 0 0 0-.27.036.44.44 0 0 0-.214.572l-.003.004 1.01 2.438a5.15 5.15 0 0 0 2.081-2.615l-2.6-.44z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Kubernetes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_3_5" id="__nav_3_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Linux
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Linux
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/linux/cli-tools/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25Zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25ZM7.25 8a.75.75 0 0 1-.22.53l-2.25 2.25a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734L5.44 8 3.72 6.28a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l2.25 2.25c.141.14.22.331.22.53m1.5 1.5h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5"/></svg>
  
  <span class="md-ellipsis">
    
  
    CLI Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/linux/hugepages/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 17H7V7h10m4 4V9h-2V7a2 2 0 0 0-2-2h-2V3h-2v2h-2V3H9v2H7c-1.11 0-2 .89-2 2v2H3v2h2v2H3v2h2v2a2 2 0 0 0 2 2h2v2h2v-2h2v2h2v-2h2a2 2 0 0 0 2-2v-2h2v-2h-2v-2m-6 2h-2v-2h2m2-2H9v6h6z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Hugepages
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/linux/systemd/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25Zm1.75-.25a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 0 0 .25-.25V2.75a.25.25 0 0 0-.25-.25ZM7.25 8a.75.75 0 0 1-.22.53l-2.25 2.25a.749.749 0 0 1-1.275-.326.75.75 0 0 1 .215-.734L5.44 8 3.72 6.28a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l2.25 2.25c.141.14.22.331.22.53m1.5 1.5h3a.75.75 0 0 1 0 1.5h-3a.75.75 0 0 1 0-1.5"/></svg>
  
  <span class="md-ellipsis">
    
  
    Systemd
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/linux/tty/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 16H3V4h18m0-2H3c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h7v2H8v2h8v-2h-2v-2h7a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2"/></svg>
  
  <span class="md-ellipsis">
    
  
    TTY
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/linux/misc/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.504 0q-.232 0-.48.021c-4.226.333-3.105 4.807-3.17 6.298-.076 1.092-.3 1.953-1.05 3.02-.885 1.051-2.127 2.75-2.716 4.521-.278.832-.41 1.684-.287 2.489a.4.4 0 0 0-.11.135c-.26.268-.45.6-.663.839-.199.199-.485.267-.797.4-.313.136-.658.269-.864.68-.09.189-.136.394-.132.602 0 .199.027.4.055.536.058.399.116.728.04.97-.249.68-.28 1.145-.106 1.484.174.334.535.47.94.601.81.2 1.91.135 2.774.6.926.466 1.866.67 2.616.47.526-.116.97-.464 1.208-.946.587-.003 1.23-.269 2.26-.334.699-.058 1.574.267 2.577.2.025.134.063.198.114.333l.003.003c.391.778 1.113 1.132 1.884 1.071s1.592-.536 2.257-1.306c.631-.765 1.683-1.084 2.378-1.503.348-.199.629-.469.649-.853.023-.4-.2-.811-.714-1.376v-.097l-.003-.003c-.17-.2-.25-.535-.338-.926-.085-.401-.182-.786-.492-1.046h-.003c-.059-.054-.123-.067-.188-.135a.36.36 0 0 0-.19-.064c.431-1.278.264-2.55-.173-3.694-.533-1.41-1.465-2.638-2.175-3.483-.796-1.005-1.576-1.957-1.56-3.368.026-2.152.236-6.133-3.544-6.139m.529 3.405h.013c.213 0 .396.062.584.198.19.135.33.332.438.533.105.259.158.459.166.724 0-.02.006-.04.006-.06v.105l-.004-.021-.004-.024a1.8 1.8 0 0 1-.15.706.95.95 0 0 1-.213.335 1 1 0 0 0-.088-.042c-.104-.045-.198-.064-.284-.133a1.3 1.3 0 0 0-.22-.066c.05-.06.146-.133.183-.198q.08-.193.088-.402v-.02a1.2 1.2 0 0 0-.061-.4c-.045-.134-.101-.2-.183-.333-.084-.066-.167-.132-.267-.132h-.016c-.093 0-.176.03-.262.132a.8.8 0 0 0-.205.334 1.2 1.2 0 0 0-.09.4v.019q.002.134.02.267c-.193-.067-.438-.135-.607-.202a2 2 0 0 1-.018-.2v-.02a1.8 1.8 0 0 1 .15-.768 1.08 1.08 0 0 1 .43-.533 1 1 0 0 1 .594-.2zm-2.962.059h.036c.142 0 .27.048.399.135.146.129.264.288.344.465.09.199.14.4.153.667v.004c.007.134.006.2-.002.266v.08c-.03.007-.056.018-.083.024-.152.055-.274.135-.393.2q.018-.136.003-.267v-.015c-.012-.133-.04-.2-.082-.333a.6.6 0 0 0-.166-.267.25.25 0 0 0-.183-.064h-.021c-.071.006-.13.04-.186.132a.55.55 0 0 0-.12.27 1 1 0 0 0-.023.33v.015c.012.135.037.2.08.334.046.134.098.2.166.268q.014.014.034.024c-.07.057-.117.07-.176.136a.3.3 0 0 1-.131.068 2.6 2.6 0 0 1-.275-.402 1.8 1.8 0 0 1-.155-.667 1.8 1.8 0 0 1 .08-.668 1.4 1.4 0 0 1 .283-.535c.128-.133.26-.2.418-.2m1.37 1.706c.332 0 .733.065 1.216.399.293.2.523.269 1.052.468h.003c.255.136.405.266.478.399v-.131a.57.57 0 0 1 .016.47c-.123.31-.516.643-1.063.842v.002c-.268.135-.501.333-.775.465-.276.135-.588.292-1.012.267a1.1 1.1 0 0 1-.448-.067 4 4 0 0 1-.322-.198c-.195-.135-.363-.332-.612-.465v-.005h-.005c-.4-.246-.616-.512-.686-.71q-.104-.403.193-.6c.224-.135.38-.271.483-.336.104-.074.143-.102.176-.131h.002v-.003c.169-.202.436-.47.839-.601.139-.036.294-.065.466-.065zm2.8 2.142c.358 1.417 1.196 3.475 1.735 4.473.286.534.855 1.659 1.102 3.024.156-.005.33.018.513.064.646-1.671-.546-3.467-1.089-3.966-.22-.2-.232-.335-.123-.335.59.534 1.365 1.572 1.646 2.757.13.535.16 1.104.021 1.67.067.028.135.06.205.067 1.032.534 1.413.938 1.23 1.537v-.043c-.06-.003-.12 0-.18 0h-.016c.151-.467-.182-.825-1.065-1.224-.915-.4-1.646-.336-1.77.465-.008.043-.013.066-.018.135-.068.023-.139.053-.209.064-.43.268-.662.669-.793 1.187-.13.533-.17 1.156-.205 1.869v.003c-.02.334-.17.838-.319 1.35-1.5 1.072-3.58 1.538-5.348.334a2.7 2.7 0 0 0-.402-.533 1.5 1.5 0 0 0-.275-.333c.182 0 .338-.03.465-.067a.62.62 0 0 0 .314-.334c.108-.267 0-.697-.345-1.163s-.931-.995-1.788-1.521c-.63-.4-.986-.87-1.15-1.396-.165-.534-.143-1.085-.015-1.645.245-1.07.873-2.11 1.274-2.763.107-.065.037.135-.408.974-.396.751-1.14 2.497-.122 3.854a8.1 8.1 0 0 1 .647-2.876c.564-1.278 1.743-3.504 1.836-5.268.048.036.217.135.289.202.218.133.38.333.59.465.21.201.477.335.876.335q.058.005.11.006c.412 0 .73-.134.997-.268.29-.134.52-.334.74-.4h.005c.467-.135.835-.402 1.044-.7zm2.185 8.958c.037.6.343 1.245.882 1.377.588.134 1.434-.333 1.791-.765l.211-.01c.315-.007.577.01.847.268l.003.003c.208.199.305.53.391.876.085.4.154.78.409 1.066.486.527.645.906.636 1.14l.003-.007v.018l-.003-.012c-.015.262-.185.396-.498.595-.63.401-1.746.712-2.457 1.57-.618.737-1.37 1.14-2.036 1.191-.664.053-1.237-.2-1.574-.898l-.005-.003c-.21-.4-.12-1.025.056-1.69.176-.668.428-1.344.463-1.897.037-.714.076-1.335.195-1.814.12-.465.308-.797.641-.984l.045-.022zm-10.814.049h.01q.08 0 .157.014c.376.055.706.333 1.023.752l.91 1.664.003.003c.243.533.754 1.064 1.189 1.637.434.598.77 1.131.729 1.57v.006c-.057.744-.48 1.148-1.125 1.294-.645.135-1.52.002-2.395-.464-.968-.536-2.118-.469-2.857-.602q-.553-.1-.723-.4c-.11-.2-.113-.602.123-1.23v-.004l.002-.003c.117-.334.03-.752-.027-1.118-.055-.401-.083-.71.043-.94.16-.334.396-.4.69-.533.294-.135.64-.202.915-.47h.002v-.002c.256-.268.445-.601.668-.838.19-.201.38-.336.663-.336m7.159-9.074c-.435.201-.945.535-1.488.535-.542 0-.97-.267-1.28-.466-.154-.134-.28-.268-.373-.335-.164-.134-.144-.333-.074-.333.109.016.129.134.199.2.096.066.215.2.36.333.292.2.68.467 1.167.467.485 0 1.053-.267 1.398-.466.195-.135.445-.334.648-.467.156-.136.149-.267.279-.267.128.016.034.134-.147.332a8 8 0 0 1-.69.468zm-1.082-1.583V5.64c-.006-.02.013-.042.029-.05.074-.043.18-.027.26.004.063 0 .16.067.15.135-.006.049-.085.066-.135.066-.055 0-.092-.043-.141-.068-.052-.018-.146-.008-.163-.065m-.551 0c-.02.058-.113.049-.166.066-.047.025-.086.068-.14.068-.05 0-.13-.02-.136-.068-.01-.066.088-.133.15-.133.08-.031.184-.047.259-.005.019.009.036.03.03.05v.02h.003z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Misc
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_3_6" id="__nav_3_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Networking
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Networking
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/networking/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 9h-2V7h2zm7 11v2h-7a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1H2v-2h7a1 1 0 0 1 1-1h1v-2H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-4v2h1a1 1 0 0 1 1 1zM9 5H7v10h2zm2 10h2v-4h2a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-4z"/></svg>
  
  <span class="md-ellipsis">
    
  
    General
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/infiniband/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 18h1a1 1 0 0 1 1 1h7v2h-7a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1H2v-2h7a1 1 0 0 1 1-1h1v-2H8a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1h-3zm0-12h1V4h-1zM9 4v2h2V4zm0 4v2h2V8zm0 4v2h2v-2z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Infiniband
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/openstack/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18.575 9.29h5.418v5.42h-5.418zM0 9.29h5.419v5.42H0zm18.575 7.827a1.207 1.207 0 0 1-1.206 1.206H6.623a1.207 1.207 0 0 1-1.205-1.206v-.858H0v5.252a2.236 2.236 0 0 0 2.229 2.23h19.53A2.237 2.237 0 0 0 24 21.512V16.26h-5.425zM21.763.258H2.233a2.236 2.236 0 0 0-2.23 2.23V7.74h5.419v-.858a1.206 1.206 0 0 1 1.205-1.206h10.746a1.206 1.206 0 0 1 1.205 1.206v.858H24V2.487A2.237 2.237 0 0 0 21.763.258"/></svg>
  
  <span class="md-ellipsis">
    
  
    OpenStack
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/osi-model/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M11 3v4h2V3zM8 4v7h8V4h-2v4h-4V4zm2 8v10h4V12z"/></svg>
  
  <span class="md-ellipsis">
    
  
    OSI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/software-defined-networking/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 20c0-.55-.45-1-1-1h-1v-2h6c1.11 0 2-.89 2-2V3a2 2 0 0 0-2-2H5c-1.1 0-2 .9-2 2v12a2 2 0 0 0 2 2h6v2h-1c-.55 0-1 .45-1 1H2v2h7c0 .55.45 1 1 1h4c.55 0 1-.45 1-1h7v-2zM13 5h6v4h-6zm0 6h6v4h-6zM5 5h6v4H5zm0 10v-4h6v4z"/></svg>
  
  <span class="md-ellipsis">
    
  
    SDN
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/network-tracing/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M2 2h2v18h18v2H2zm5 8h10v3H7zm4 5h10v3H11zM6 4h16v4h-2V6H8v2H6z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Tracing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/pcie/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PCIe
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/repositories/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2 2.5A2.5 2.5 0 0 1 4.5 0h8.75a.75.75 0 0 1 .75.75v12.5a.75.75 0 0 1-.75.75h-2.5a.75.75 0 0 1 0-1.5h1.75v-2h-8a1 1 0 0 0-.714 1.7.75.75 0 1 1-1.072 1.05A2.5 2.5 0 0 1 2 11.5Zm10.5-1h-8a1 1 0 0 0-1 1v6.708A2.5 2.5 0 0 1 4.5 9h8ZM5 12.25a.25.25 0 0 1 .25-.25h3.5a.25.25 0 0 1 .25.25v3.25a.25.25 0 0 1-.4.2l-1.45-1.087a.25.25 0 0 0-.3 0L5.4 15.7a.25.25 0 0 1-.4-.2Z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Repositories
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3_9" >
        
          
          <label class="md-nav__link" for="__nav_3_3_9" id="__nav_3_3_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3_9">
            <span class="md-nav__icon md-icon"></span>
            
  
    Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/security/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12h7c-.53 4.11-3.28 7.78-7 8.92zH5V6.3l7-3.11M12 1 3 5v6c0 5.55 3.84 10.73 9 12 5.16-1.27 9-6.45 9-12V5z"/></svg>
  
  <span class="md-ellipsis">
    
  
    HTTP
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/gpg/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12h7c-.53 4.11-3.28 7.78-7 8.92zH5V6.3l7-3.11M12 1 3 5v6c0 5.55 3.84 10.73 9 12 5.16-1.27 9-6.45 9-12V5z"/></svg>
  
  <span class="md-ellipsis">
    
  
    GPG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/timekeeping/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0M1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0m7-3.25v2.992l2.028.812a.75.75 0 0 1-.557 1.392l-2.5-1A.75.75 0 0 1 7 8.25v-3.5a.75.75 0 0 1 1.5 0"/></svg>
  
  <span class="md-ellipsis">
    
  
    Timekeeping
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/sysadmin/virtualization/" class="md-nav__link">
        
  
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 1.758 5.182 20c.129.455.25.691.421.945q.094.137.202.264.26.305.59.525c.243.163.49.286.763.371.324.1.61.137.99.137h4.327l1.918-6.615h6.798v3.699a.11.11 0 0 1-.109.11h-4.88l-.813 2.806h5.654a2.92 2.92 0 0 0 1.95-.725A2.9 2.9 0 0 0 24 19.285v-6.47H12.28l-1.919 6.614H7.937L3.715 4.564h2.922l1.546 5.444H11.1l-2.343-8.25zm15.496 0-2.4 8.25H24v-5.29a2.96 2.96 0 0 0-1.825-2.741 3 3 0 0 0-1.129-.22zm2.11 2.806h3.476a.11.11 0 0 1 .11.112V7.2h-4.354z"/></svg>
  
  <span class="md-ellipsis">
    
  
    Virutalization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    System Design
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    System Design
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/system-design/databases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Databases
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/system-design/system-design-interview-alex-xu/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    System Design Interview: An Insider's Guide
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../notes/system-design/tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Misc
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Misc
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../misc/suggested-readings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Suggested Readings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../misc/word-of-the-day/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Word of the Day
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vm-console-logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          VM Console Logs
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-bpftrace-to-time-dma-mappings" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Using <code>bpftrace</code> to Time <abbr title="Direct Memory Access">DMA</abbr> Mappings
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using bpftrace to Time DMA Mappings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kprobe" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          <code>kprobe</code>
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kretprobe" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          <code>kretprobe</code>
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#booting-a-new-vm" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Booting a new VM
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interpreting-the-results" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Interpreting the Results
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cant-we-use-iommu-hugepages" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Can't we use <abbr title="Input-Output Memory Management Unit">IOMMU</abbr> Hugepages?
        </span>
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-linux-function_graph-tracer" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Using Linux function_graph Tracer
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aside-on-mmio-mappings" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Aside on <abbr title="Memory Mapped IO">MMIO</abbr> Mappings
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hugepages" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Hugepages
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hugepages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#turned-off" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Turned Off
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#turned-on" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Turned On
        </span>
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-problems-with-vfio-mmio-mappings" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Performance Problems with VFIO <abbr title="Memory Mapped IO">MMIO</abbr> Mappings
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Problems with VFIO MMIO Mappings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#is-iommufd-faster-than-legacy-vfio-backend" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Is IOMMUFD Faster Than Legacy VFIO Backend?
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Is IOMMUFD Faster Than Legacy VFIO Backend?">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#legacy-vfio-backend" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Legacy VFIO Backend
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iommufd-vfio-backend" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          IOMMUFD VFIO Backend
        </span>
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parting-thoughts" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Parting Thoughts
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          References
        </span>
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="https://github.com/LandonTClipp.png" alt="Landon Clipp">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          Landon Clipp
                        
                      </strong>
                      <br>
                      Creator
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2025-11-19 00:00:00+00:00" class="md-ellipsis">November 19, 2025</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../../../../category/system-design/">System Design</a>, 
                              <a href="../../../../category/cloud/">Cloud</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              60 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  



  
    <a href="https://github.com/LandonTClipp/LandonTClipp.github.io/edit/main/docs/blog/posts/2025-11-19-gpu-passthrough-boot.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/LandonTClipp/LandonTClipp.github.io/raw/main/docs/blog/posts/2025-11-19-gpu-passthrough-boot.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


  <h1>Boot-time Performance of Kata Containers With NVIDIA GPUs</h1>

<p>If you recall in my <a href="../../../10/21/gpu-based-containers-as-a-service/">previous post</a>, we looked into how to utilize Kata VMs to create a multi-tenant, GPU-based Kubernetes cluster. We briefly mentioned various performance problems related to the VM boot process. This post will dive deeper into this issue and shed some insight into where time is being spent during the VM boot.</p>
<!-- more -->

<h2 id="vm-console-logs">VM Console Logs<a class="headerlink" href="#vm-console-logs" title="Permanent link">&para;</a></h2>
<p>The first thing we should establish is the timeline of events. Recall in the previous post that we're running Kata containers inside of a Kubernetes cluster. We attach 7 GPUs to the VM (instead of 8, because one of them on my machine is broken) and watch the Kata agent logs. To recap, this is a diagram that shows how the OCI components are fitting together:</p>
<pre class="mermaid"><code>flowchart TD
    containerd[containerd.service]
    kataShim[containerd-shim-kata-v2]

    subgraph QEMU
        kataAgent[kata-agent.service]
    end

    containerd --&gt; kataShim
    kataShim -- creates --&gt; QEMU

    kataShim &lt;-- VSOCK --&gt; kataAgent</code></pre>
<p>By enabling various debug flags in the Kata runtime config and by setting <code>level = "debug"</code> in the containerd config, we can view all of the logs coming not only from the <abbr title="Quick Emulator">QEMU</abbr> dmesg logs, but also the kata-agent itself. Let's now boot a VM and see what's happening. We can look at the containerd logs, grep for the specific sandbox we care about, and can see an example log message:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Nov 20 16:25:32 dal03-sgpu-160 containerd[2771108]: time=&quot;2025-11-20T16:25:32.996810781Z&quot; level=debug msg=&quot;reading guest console&quot; console-protocol=unix console-url=/run/vc/vm/38f55c4a058a0f7227e64edd75f2aed134bee7db4b211f071be84fb44d17b0bb/console.sock name=containerd-shim-v2 pid=3426175 sandbox=38f55c4a058a0f7227e64edd75f2aed134bee7db4b211f071be84fb44d17b0bb source=virtcontainers subsystem=sandbox vmconsole=&quot;{\&quot;msg\&quot;:\&quot;policy check: StatsContainerRequest\&quot;,\&quot;level\&quot;:\&quot;DEBG\&quot;,\&quot;ts\&quot;:\&quot;2025-11-20T16:25:33.010026353Z\&quot;,\&quot;version\&quot;:\&quot;0.1.0\&quot;,\&quot;name\&quot;:\&quot;kata-agent\&quot;,\&quot;subsystem\&quot;:\&quot;rpc\&quot;,\&quot;source\&quot;:\&quot;agent\&quot;,\&quot;pid\&quot;:\&quot;1\&quot;}&quot;
</span></code></pre></div>
<p>Let's use some additional awk trickery to clean this up. All we really care about is the <code>vmconsole</code> field, so let's separate that out and make the formatting a bit nicer:</p>
<div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>journalctl<span class="w"> </span>-u<span class="w"> </span>containerd<span class="w"> </span>-S<span class="w"> </span><span class="s1">&#39;40m ago&#39;</span><span class="w"> </span><span class="p">|&amp;</span><span class="w"> </span>grep<span class="w"> </span><span class="nv">sandbox</span><span class="o">=</span>38f55c4a058a0f7227e64edd75f2aed134bee7db4b211f071be84fb44d17b0bb<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span>-F<span class="s1">&#39;vmconsole=&#39;</span><span class="w"> </span><span class="s1">&#39;{ print $2 }&#39;</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span>&gt;<span class="w"> </span>vmconsole.txt
</span></code></pre></div>
<p>The first messages we see are the dmesg logs which are kernel-level messages:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>[    0.437005] brd: module loaded
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>[    0.443558] loop: module loaded
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>[    0.443819] virtio_scsi virtio1: 1/0/0 default/read/poll queues
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>[...]
</span></code></pre></div>
<p>Shortly after this, we also see kata-agent logs:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>{&quot;msg&quot;:&quot;\&quot;proc\&quot; is already mounted at \&quot;/proc\&quot;&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:09.356676179Z&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;subsystem&quot;:&quot;baremount&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;source&quot;:&quot;agent&quot;}
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>{&quot;msg&quot;:&quot;\&quot;sysfs\&quot; is already mounted at \&quot;/sys\&quot;&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:09.356699617Z&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;subsystem&quot;:&quot;baremount&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;name&quot;:&quot;kata-agent&quot;}
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>{&quot;msg&quot;:&quot;\&quot;dev\&quot; is already mounted at \&quot;/dev\&quot;&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:09.356718292Z&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;subsystem&quot;:&quot;baremount&quot;,&quot;source&quot;:&quot;agent&quot;}
</span></code></pre></div>
<p>Kata-agent was configured to redirect its log message to <code>/dev/console</code>, which makes sense, so this is what we want. Let's zoom down further for more relevant info. It starts off by checking for cloud-init data (which it doesn't find any because I have not configured it):</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>{&quot;msg&quot;:&quot;Initdata check device `ptmx`&quot;,&quot;level&quot;:&quot;DEBG&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:09.359571917Z&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;subsystem&quot;:&quot;initdata&quot;,&quot;pid&quot;:&quot;1&quot;}
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>{&quot;msg&quot;:&quot;Initdata check device `pts`&quot;,&quot;level&quot;:&quot;DEBG&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:09.359640437Z&quot;,&quot;subsystem&quot;:&quot;initdata&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;source&quot;:&quot;agent&quot;}
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>{&quot;msg&quot;:&quot;Initdata check device `shm`&quot;,&quot;level&quot;:&quot;DEBG&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:09.3596694Z&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;subsystem&quot;:&quot;initdata&quot;,&quot;source&quot;:&quot;agent&quot;}
</span></code></pre></div>
<p>We can see it receiving some commands from the containerd shim:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>{&quot;msg&quot;:&quot;rpc call from shim to agent: \&quot;create_sandbox\&quot;&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:09.374408769Z&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;subsystem&quot;:&quot;rpc&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;pid&quot;:&quot;1&quot;}
</span></code></pre></div>
<p>We begin to see the dmesg logs again and we can see the precense of the GPUs showing up on the VM's PCIe bus only 3 seconds after the kernel first booted:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>[    3.201931] pci 0000:02:00.0: [10de:2330] type 00 class 0x030200 PCIe Endpoint
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>[    3.202399] pci 0000:02:00.0: BAR 0 [mem 0x00000000-0x00ffffff 64bit pref]
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>[    3.202551] pci 0000:02:00.0: BAR 2 [mem 0x00000000-0x1fffffffff 64bit pref]
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>[    3.202726] pci 0000:02:00.0: BAR 4 [mem 0x00000000-0x01ffffff 64bit pref]
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>[    3.202962] pci 0000:02:00.0: Max Payload Size set to 128 (was 256, max 256)
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>[    3.203347] pci 0000:02:00.0: Enabling HDA controller
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>[    4.858791] pci 0000:02:00.0: 252.048 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x16 link at 0000:00:05.0 (capable of 504.112 Gb/s with 32.0 GT/s PCIe x16 link)
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>[    5.681204] pci 0000:02:00.0: BAR 2 [mem 0x3a4000000000-0x3a5fffffffff 64bit pref]: assigned
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>[    5.681521] pci 0000:02:00.0: BAR 4 [mem 0x3a6000000000-0x3a6001ffffff 64bit pref]: assigned
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a>[    5.681842] pci 0000:02:00.0: BAR 0 [mem 0x3a6002000000-0x3a6002ffffff 64bit pref]: assigned
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a>[    6.505076] pci 0000:02:00.0: nv_msi_ht_cap_quirk_leaf+0x0/0x20 took 803659 usecs
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For those curious, <code>10de</code> is the PCIe vendor code for NVIDIA and <code>2330</code> is the PCIe Device ID for NVIDIA H100 GPUs. </p>
</div>
<p>It's showing us the <abbr title="Base Address Register">BAR</abbr> regions of each GPU. In fact, we should be able to see seven instances of this kind of message:</p>
<div class="language-bash highlight"><span class="filename">Bash</span><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>$<span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;\[10de\:2330\]&#39;</span><span class="w"> </span>vmconsole.txt<span class="w"> </span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="o">[</span><span class="w">    </span><span class="m">3</span>.201931<span class="o">]</span><span class="w"> </span>pci<span class="w"> </span><span class="m">0000</span>:02:00.0:<span class="w"> </span><span class="o">[</span>10de:2330<span class="o">]</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>class<span class="w"> </span>0x030200<span class="w"> </span>PCIe<span class="w"> </span>Endpoint
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="o">[</span><span class="w">    </span><span class="m">7</span>.329101<span class="o">]</span><span class="w"> </span>pci<span class="w"> </span><span class="m">0000</span>:06:00.0:<span class="w"> </span><span class="o">[</span>10de:2330<span class="o">]</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>class<span class="w"> </span>0x030200<span class="w"> </span>PCIe<span class="w"> </span>Endpoint
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="o">[</span><span class="w">    </span><span class="m">8</span>.159058<span class="o">]</span><span class="w"> </span>pci<span class="w"> </span><span class="m">0000</span>:05:00.0:<span class="w"> </span><span class="o">[</span>10de:2330<span class="o">]</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>class<span class="w"> </span>0x030200<span class="w"> </span>PCIe<span class="w"> </span>Endpoint
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="o">[</span><span class="w">    </span><span class="m">8</span>.165639<span class="o">]</span><span class="w"> </span>pci<span class="w"> </span><span class="m">0000</span>:04:00.0:<span class="w"> </span><span class="o">[</span>10de:2330<span class="o">]</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>class<span class="w"> </span>0x030200<span class="w"> </span>PCIe<span class="w"> </span>Endpoint
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="o">[</span><span class="w">    </span><span class="m">8</span>.170375<span class="o">]</span><span class="w"> </span>pci<span class="w"> </span><span class="m">0000</span>:03:00.0:<span class="w"> </span><span class="o">[</span>10de:2330<span class="o">]</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>class<span class="w"> </span>0x030200<span class="w"> </span>PCIe<span class="w"> </span>Endpoint
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="o">[</span><span class="w">    </span><span class="m">8</span>.177573<span class="o">]</span><span class="w"> </span>pci<span class="w"> </span><span class="m">0000</span>:08:00.0:<span class="w"> </span><span class="o">[</span>10de:2330<span class="o">]</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>class<span class="w"> </span>0x030200<span class="w"> </span>PCIe<span class="w"> </span>Endpoint
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="o">[</span><span class="w">    </span><span class="m">8</span>.182313<span class="o">]</span><span class="w"> </span>pci<span class="w"> </span><span class="m">0000</span>:07:00.0:<span class="w"> </span><span class="o">[</span>10de:2330<span class="o">]</span><span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="m">00</span><span class="w"> </span>class<span class="w"> </span>0x030200<span class="w"> </span>PCIe<span class="w"> </span>Endpoint
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>$<span class="w"> </span>grep<span class="w"> </span><span class="s1">&#39;\[10de\:2330\]&#39;</span><span class="w"> </span>vmconsole.txt<span class="w">  </span><span class="p">|</span><span class="w"> </span>wc<span class="w"> </span>-l
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="m">7</span>
</span></code></pre></div>
<p>We can then see the kata-agent receives a uevent from the kernel regarding the presence of these GPUs being enumerated on the bus. For some context, userspace programs can subscribe to kernel uevent messages so that we can be alerted when something about a device has changed. In this case, the kata-agent cares about when a GPU device appears on the bus. Let's grep for the <code>0000:07:00.0</code> device to see the whole end-to-end flow:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>$ grep &#39;0000:07:00.0&#39; vmconsole.txt 
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>{&quot;msg&quot;:&quot;Waiting for PciMatcher { devpath: \&quot;/devices/pci0000:00/0000:00:0a.0/0000:07:00.0\&quot; }&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:15.701000961Z&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;source&quot;:&quot;agent&quot;}
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>{&quot;msg&quot;:&quot;Waiting for PciMatcher { devpath: \&quot;/devices/pci0000:00/0000:00:0a.0/0000:07:00.0\&quot; }: waiting on channel&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:15.701021912Z&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;name&quot;:&quot;kata-agent&quot;}
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>[    8.182313] pci 0000:07:00.0: [10de:2330] type 00 class 0x030200 PCIe Endpoint
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>[    8.182722] pci 0000:07:00.0: BAR 0 [mem 0x00000000-0x00ffffff 64bit pref]
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>[    8.182858] pci 0000:07:00.0: BAR 2 [mem 0x00000000-0x1fffffffff 64bit pref]
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>[    8.183003] pci 0000:07:00.0: BAR 4 [mem 0x00000000-0x01ffffff 64bit pref]
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>[    8.183217] pci 0000:07:00.0: Max Payload Size set to 128 (was 256, max 256)
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>[    8.184788] pci 0000:07:00.0: Enabling HDA controller
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>[    8.186130] pci 0000:07:00.0: 252.048 Gb/s available PCIe bandwidth, limited by 16.0 GT/s PCIe x16 link at 0000:00:0a.0 (capable of 504.112 Gb/s with 32.0 GT/s PCIe x16 link)
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>[    8.186969] pci 0000:07:00.0: BAR 2 [mem 0x390000000000-0x391fffffffff 64bit pref]: assigned
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>[    8.187249] pci 0000:07:00.0: BAR 4 [mem 0x392000000000-0x392001ffffff 64bit pref]: assigned
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>[    8.187528] pci 0000:07:00.0: BAR 0 [mem 0x392002000000-0x392002ffffff 64bit pref]: assigned
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>{&quot;msg&quot;:&quot;got uevent message&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:15.71233274Z&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;event&quot;:&quot;Uevent { action: \&quot;add\&quot;, devpath: \&quot;/devices/pci0000:00/0000:00:0a.0/0000:07:00.0\&quot;, devname: \&quot;\&quot;, subsystem: \&quot;pci\&quot;, seqnum: \&quot;1379\&quot;, interface: \&quot;\&quot; }&quot;}
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>{&quot;msg&quot;:&quot;Waiting for PciMatcher { devpath: \&quot;/devices/pci0000:00/0000:00:0a.0/0000:07:00.0\&quot; }: found Uevent { action: \&quot;add\&quot;, devpath: \&quot;/devices/pci0000:00/0000:00:0a.0/0000:07:00.0\&quot;, devname: \&quot;\&quot;, subsystem: \&quot;pci\&quot;, seqnum: \&quot;1379\&quot;, interface: \&quot;\&quot; } on channel&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:15.712365772Z&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;pid&quot;:&quot;1&quot;}
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a>[   32.130338] nvidia 0000:07:00.0: enabling device (0140 -&gt; 0142)
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a>{&quot;msg&quot;:&quot;got uevent message&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:42.96188988Z&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;event&quot;:&quot;Uevent { action: \&quot;bind\&quot;, devpath: \&quot;/devices/pci0000:00/0000:00:0a.0/0000:07:00.0\&quot;, devname: \&quot;\&quot;, subsystem: \&quot;pci\&quot;, seqnum: \&quot;1387\&quot;, interface: \&quot;\&quot; }&quot;}
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>{&quot;msg&quot;:&quot;ignoring event&quot;,&quot;level&quot;:&quot;DEBG&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:42.961921263Z&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;uevent&quot;:&quot;Uevent { action: \&quot;bind\&quot;, devpath: \&quot;/devices/pci0000:00/0000:00:0a.0/0000:07:00.0\&quot;, devname: \&quot;\&quot;, subsystem: \&quot;pci\&quot;, seqnum: \&quot;1387\&quot;, interface: \&quot;\&quot; }&quot;}
</span></code></pre></div>
<p>We can see the following steps happening:</p>
<ol>
<li>Kata subscribes to the uevent system for this particular BDF.</li>
<li>The kernel enumerates the PCIe bus, finds this device, and assignes (what I assume to be) <abbr title="Memory Mapped IO">MMIO</abbr> regions for the device <abbr title="Base Address Register">BARs</abbr>.</li>
<li>The kata agent is informed by the kernel that this device has been added.</li>
<li>
<p>The kata agent saves a reference to this device in-memory and then waits for the CDI spec for this device to be injected by the shim. We see this in the logs:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>{&quot;msg&quot;:&quot;waiting for CDI spec(s) to be generated (0 of 100 max tries) \&quot;unresolvable CDI devices nvidia.com/gpu=3, nvidia.com/gpu=1, nvidia.com/gpu=4, nvidia.com/gpu=6, nvidia.com/gpu=5, nvidia.com/gpu=2, nvidia.com/gpu=0\&quot;&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:15.71245172Z&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;subsystem&quot;:&quot;rpc&quot;,&quot;pid&quot;:&quot;1&quot;}
</span></code></pre></div>
</li>
</ol>
<p>What can we gather here? Well, the PCIe endpoints representing the GPUs show up in the VM in a matter of a few seconds from first boot. The agent recognizes this immediately. After this step, the kata-agent ends up waiting a <em>LONG</em> time for the CDI spec to be injected from the Kata shim. What does this mean precisely? Well, if you recall in the previous blog post regarding the <a href="../../../10/21/gpu-based-containers-as-a-service/#cdi-device-plugin">CDI device plugin</a>, our CDI plugin on the host creates a file at <code>/var/run/cdi/nvidia-gpu.json</code> that describes the OCI container spec edits that must be made to inject these GPUs into the container sandbox. The first few lines of this file look something like:</p>
<div class="language-json highlight"><span class="filename">/var/run/cdi/nvidia-gpu.json</span><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">  </span><span class="nt">&quot;cdiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.7.0&quot;</span><span class="p">,</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">  </span><span class="nt">&quot;kind&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nvidia.com/gpu&quot;</span><span class="p">,</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w">  </span><span class="nt">&quot;containerEdits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w">  </span><span class="nt">&quot;devices&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">      </span><span class="nt">&quot;containerEdits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">        </span><span class="nt">&quot;deviceNodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">            </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/dev/vfio/66&quot;</span><span class="p">,</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;c&quot;</span><span class="p">,</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">            </span><span class="nt">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rwm&quot;</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">    </span><span class="p">},</span>
</span></code></pre></div>
<p>What the agent is telling us is that, for whatever reason, the CDI spec has not shown up in the guest's <code>/var/run/cdi</code> directory (which is populated by the nvidia-ctk toolkit, called from the NVRC init system), so the agent doesn't yet know which edits it needs to make to the container to properly expose the GPU to the process. In fact, look at how long it waits!</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>$ grep &#39;waiting for CDI spec&#39; vmconsole.txt 
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>{&quot;msg&quot;:&quot;waiting for CDI spec(s) to be generated (0 of 100 max tries) \&quot;unresolvable CDI devices nvidia.com/gpu=3, nvidia.com/gpu=1, nvidia.com/gpu=4, nvidia.com/gpu=6, nvidia.com/gpu=5, nvidia.com/gpu=2, nvidia.com/gpu=0\&quot;&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T16:05:15.71245172Z&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;subsystem&quot;:&quot;rpc&quot;,&quot;pid&quot;:&quot;1&quot;}
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>[...]
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>{&quot;msg&quot;:&quot;waiting for CDI spec(s) to be generated (39 of 100 max tries) \&quot;unresolvable CDI devices nvidia.com/gpu=3, nvidia.com/gpu=1, nvidia.com/gpu=4, nvidia.com/gpu=6, nvidia.com/gpu=5, nvidia.com/gpu=2, nvidia.com/gpu=0\&quot;&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T16:06:37.462492776Z&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;subsystem&quot;:&quot;rpc&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;source&quot;:&quot;agent&quot;}
</span></code></pre></div>
<p>It spends over a minute just waiting. Given the overall boot time of the VM (which I've gotten down to 2 minutes), this represents HALF of the entire boot process. The question is why?</p>
<p>Another clue we have are some messages from the guest NVIDIA Kernel Driver:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>$ grep &#39;enabling device&#39; vmconsole.txt 
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>[   11.721284] nvidia 0000:02:00.0: enabling device (0140 -&gt; 0142)
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>[   15.137841] nvidia 0000:06:00.0: enabling device (0140 -&gt; 0142)
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>[   18.534911] nvidia 0000:05:00.0: enabling device (0140 -&gt; 0142)
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>[   22.032357] nvidia 0000:04:00.0: enabling device (0140 -&gt; 0142)
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>[   25.719357] nvidia 0000:03:00.0: enabling device (0140 -&gt; 0142)
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>[   28.918995] nvidia 0000:08:00.0: enabling device (0140 -&gt; 0142)
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>[   32.130338] nvidia 0000:07:00.0: enabling device (0140 -&gt; 0142)
</span></code></pre></div>
<p>It seems that each instance of "enabling device" takes the driver around 4 seconds to complete, or about 28 seconds total for all 7 GPUs. It's possible this could be a red herring because it does seem that more time is spent on waiting for the CDI specs to arrive, not for the driver to enable all devices.</p>
<p>It also spends an additional 13 seconds handling some kind of bug:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a># grep gpuClearFbhubPoisonIntrForBug2924523_GA100 vmconsole.txt 
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>[   35.757629] NVRM: gpuClearFbhubPoisonIntrForBug2924523_GA100: FBHUB Interrupt detected. Clearing it.
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>[   37.904920] NVRM: gpuClearFbhubPoisonIntrForBug2924523_GA100: FBHUB Interrupt detected. Clearing it.
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>[   40.019364] NVRM: gpuClearFbhubPoisonIntrForBug2924523_GA100: FBHUB Interrupt detected. Clearing it.
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>[   42.144963] NVRM: gpuClearFbhubPoisonIntrForBug2924523_GA100: FBHUB Interrupt detected. Clearing it.
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>[   44.272692] NVRM: gpuClearFbhubPoisonIntrForBug2924523_GA100: FBHUB Interrupt detected. Clearing it.
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>[   46.396907] NVRM: gpuClearFbhubPoisonIntrForBug2924523_GA100: FBHUB Interrupt detected. Clearing it.
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>[   48.518811] NVRM: gpuClearFbhubPoisonIntrForBug2924523_GA100: FBHUB Interrupt detected. Clearing it.
</span></code></pre></div>
<p>The time spent waiting for <code>nvidia-ctk</code> to create the CDI file could also be the fault of the NVIDIA driver itself. What's obvious is that cold starts of GPUs take a long time, and utilizing alternative technologies like NVIDIA vGPU (whereby the kernel driver is always loaded either on the host or in a sibling VM like what <a href="edera.dev">edera.dev</a> does.</p>
<h2 id="using-bpftrace-to-time-dma-mappings">Using <code>bpftrace</code> to Time <abbr title="Direct Memory Access">DMA</abbr> Mappings<a class="headerlink" href="#using-bpftrace-to-time-dma-mappings" title="Permanent link">&para;</a></h2>
<p>One of my suspicions in the boot performance issue was that a lot of time was being spent in creating the <abbr title="Direct Memory Access">DMA</abbr> mappings between the GPUs and physical CPU memory. One of the most crucial parts of creating <abbr title="Direct Memory Access">DMA</abbr> mappings is pinning pages in memory. To pin a page means that you force the page to be backed by real physical memory (as opposed requiring page faults to lazily back a page into memory only when the page is touched). Because the GPUs are being passed through using the vfio-pci kernel driver, we can look in the VFIO source code to see what function call does this. It is in fact a function called <a href="https://github.com/torvalds/linux/blob/8e621c9a337555c914cf1664605edfaa6f839774/drivers/vfio/vfio_iommu_type1.c#L676"><code>vfio_pin_pages_remote</code></a>.</p>
<p>There is a technology in the Linux kernel called eBPF which stands for Extended Berkley Packet Filter. It was originally created as a way to filter packets flowing into and out of network cards, but the technology was extended to allow us to trace basically any part of the kernel we want. The <a href="https://bpftrace.org/"><code>bpftrace</code></a> tool in particular is something we can use to create eBPF programs.</p>
<p>Let's look at a program I created:</p>
<div class="language-text highlight"><span class="filename">vfio_trace.bpf</span><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>kprobe:vfio_pin_pages_remote {
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>    @start[tid] = nsecs;
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>    $sec = strftime(&quot;%Y-%m-%dT%H:%M:%S&quot;, nsecs);
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>    $nsec = nsecs % 1000000000;
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    printf(&quot;%s.%09dZ: vfio_pin_pages_remote(): vaddr=0x%lx npage=%lu size=%luB limit=%lu pid=%d\n&quot;,
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>           $sec, $nsec, arg1, arg2, arg2 * 4096, arg4, pid);
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>}
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>kretprobe:vfio_pin_pages_remote {
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>    $d = (nsecs - @start[tid]) / 1e6;
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>    $sec = strftime(&quot;%Y-%m-%dT%H:%M:%S&quot;, nsecs);
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>    $nsec = nsecs % 1000000000;
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>    printf(&quot;%s.%09dZ: vfio_pin_pages_remote took %d ms\n&quot;, $sec, $nsec, $d);
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>    @hist = hist($d);
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>    delete(@start[tid]);
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>}
</span></code></pre></div>
<p>There are two components to this:</p>
<h3 id="kprobe"><code>kprobe</code><a class="headerlink" href="#kprobe" title="Permanent link">&para;</a></h3>
<p>This section creates a callback that is triggered at the beginning of the function call. Using the eBPF language (which looks a lot like C in many respects), we save the start time of the execution and then print some of the arguments of the call along with a timestamp.</p>
<h3 id="kretprobe"><code>kretprobe</code><a class="headerlink" href="#kretprobe" title="Permanent link">&para;</a></h3>
<p>This callback is similar to <code>kprobe</code> except it is called after the function exits. We grab the start time (based off of the thread ID <code>tid</code>) and subtract it from the end time. This gives us the runtime in milliseconds which we can then print.</p>
<p>The result is messages like this:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>vfio_pin_pages_remote(): vaddr=0x74de00000000 npage=33554432 size=137438953472B limit=2048 pid=3449227                                                                                                                                             
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>vfio_pin_pages_remote took 3274 ms   
</span></code></pre></div>
<p>When the traces end, bpftrace also gives us a histogram of the function runtimes:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>@hist:                                                                                                                                                                                                                                             
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>[0]                   89 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@|
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>[1]                    2 |@                                                   |
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>[2, 4)                 8 |@@@@                                                |
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>[4, 8)                 0 |                                                    |
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>[8, 16)                0 |                                                    |
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>[16, 32)               0 |                                                    |
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>[32, 64)               1 |                                                    |
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>[64, 128)              0 |                                                    |
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>[128, 256)             0 |                                                    |
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>[256, 512)             0 |                                                    |
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>[512, 1K)              0 |                                                    |
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>[1K, 2K)               0 |                                                    |
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>[2K, 4K)               7 |@@@@                                                |
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>[4K, 8K)               0 |                                                    |
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>[8K, 16K)              0 |                                                    |
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>[16K, 32K)             1 |                                                    |
</span></code></pre></div>
<p>Using these timestamps, we can now cross-reference what's happening on the host side regarding <abbr title="Direct Memory Access">DMA</abbr> mappings and the guest side. Let's try it!</p>
<h3 id="booting-a-new-vm">Booting a new VM<a class="headerlink" href="#booting-a-new-vm" title="Permanent link">&para;</a></h3>
<p>I booted a new Kata VM and saved the containerd logs:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a># journalctl -u containerd -S &#39;40 minutes ago&#39; |&amp; grep &#39;sandbox=c9f7bf13c1911810fa49a6be9a9d1efe0872d4088a008ac9eddd5bece6e56889&#39; | awk -F&#39;vmconsole=&#39; &#39;{ print $2 }&#39;  | jq -r &gt; vmconsole2.txt
</span></code></pre></div>
<p>You can view those <a href="https://assets.topofmind.dev/posts/2025-11-19-gpu-passthrough-boot/vmconsole.txt">here</a>.</p>
<p>The output of the bpftrace program lives <a href="https://assets.topofmind.dev/posts/2025-11-19-gpu-passthrough-boot/bpftrace_out.txt">here</a>.</p>
<p>The first significant traces we can see are these 128GiB sections.</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>2025-11-20T17:56:21.688170596Z: vfio_pin_pages_remote(): vaddr=0x786c40000000 npage=33554432 size=137438953472B limit=2048 pid=3454228
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>2025-11-20T17:56:25.955145443Z: vfio_pin_pages_remote took 3266 ms
</span></code></pre></div>
<p>There are seven of them in fact (coincidence? I think not!). The first one happens at timestamp <code>2025-11-20T17:56:21.688170596Z</code>. What was happening in the guest around this time?</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>[   21.101954] nvidia 0000:02:00.0: enabling device (0140 -&gt; 0142)
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>{&quot;msg&quot;:&quot;waiting for CDI spec(s) to be generated (5 of 100 max tries) \&quot;unresolvable CDI devices nvidia.com/gpu=2, nvidia.com/gpu=0, nvidia.com/gpu=1, nvidia.com/gpu=6, nvidia.com/gpu=5, nvidia.com/gpu=3, nvidia.com/gpu=4\&quot;&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:56:21.93953012Z&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;subsystem&quot;:&quot;rpc&quot;}
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>{&quot;msg&quot;:&quot;got uevent message&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:56:21.947065025Z&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;event&quot;:&quot;Uevent { action: \&quot;bind\&quot;, devpath: \&quot;/devices/pci0000:00/0000:00:05.0/0000:02:00.0\&quot;, devname: \&quot;\&quot;, subsystem: \&quot;pci\&quot;, seqnum: \&quot;1381\&quot;, interface: \&quot;\&quot; }&quot;}
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>{&quot;msg&quot;:&quot;ignoring event&quot;,&quot;level&quot;:&quot;DEBG&quot;,&quot;ts&quot;:&quot;2025-11-20T17:56:21.947096369Z&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;uevent&quot;:&quot;Uevent { action: \&quot;bind\&quot;, devpath: \&quot;/devices/pci0000:00/0000:00:05.0/0000:02:00.0\&quot;, devname: \&quot;\&quot;, subsystem: \&quot;pci\&quot;, seqnum: \&quot;1381\&quot;, interface: \&quot;\&quot; }&quot;}
</span></code></pre></div>
<p>The kata-agent noticed that the GPU device at <code>0000:02:00.0</code> was bound to the NVIDIA driver. It isn't until about 3221 milliseconds later that the NVIDIA driver gets bound to the next GPU:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>[   24.322027] nvidia 0000:07:00.0: enabling device (0140 -&gt; 0142)
</span></code></pre></div>
<p>This matches almost exactly with the runtime of <code>vfio_pin_pages_remote</code>. This process repeats for a total of 7 times until the next semi-significant <abbr title="Direct Memory Access">DMA</abbr> mappings occur:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>2025-11-20T17:57:56.948647354Z: vfio_pin_pages_remote(): vaddr=0x7832c0000000 npage=26214400 size=107374182400B limit=2048 pid=3454228
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>2025-11-20T17:57:56.437252192Z: vfio_pin_pages_remote took 488 ms
</span></code></pre></div>
<p>While these calls take less time, there are far more of them that happen in rapid succession starting from the timestamp <code>2025-11-20T17:57:56.948647354Z</code> and ending in <code>2025-11-20T17:58:13.178330994Z</code> for a total of roughly 17 seconds. Again, we look inside the guest:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>{&quot;msg&quot;:&quot;rpc call from shim to agent: \&quot;online_cpu_mem\&quot;&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:58:13.487517854Z&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;subsystem&quot;:&quot;rpc&quot;}
</span></code></pre></div>
<p>There's a flurry of memory devices being added.</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>{&quot;msg&quot;:&quot;got uevent message&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:58:13.50283434Z&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;event&quot;:&quot;Uevent { action: \&quot;add\&quot;, devpath: \&quot;/devices/system/memory/memory176\&quot;, devname: \&quot;\&quot;, subsystem: \&quot;memory\&quot;, seqnum: \&quot;1400\&quot;, interface: \&quot;\&quot; }&quot;}
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>{&quot;msg&quot;:&quot;got uevent message&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:58:13.50289347Z&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;event&quot;:&quot;Uevent { action: \&quot;add\&quot;, devpath: \&quot;/devices/system/memory/memory177\&quot;, devname: \&quot;\&quot;, subsystem: \&quot;memory\&quot;, seqnum: \&quot;1401\&quot;, interface: \&quot;\&quot; }&quot;}
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>{&quot;msg&quot;:&quot;got uevent message&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:58:13.502941403Z&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;event&quot;:&quot;Uevent { action: \&quot;add\&quot;, devpath: \&quot;/devices/system/memory/memory178\&quot;, devname: \&quot;\&quot;, subsystem: \&quot;memory\&quot;, seqnum: \&quot;1402\&quot;, interface: \&quot;\&quot; }&quot;}
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>{&quot;msg&quot;:&quot;got uevent message&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:58:13.50298798Z&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;event&quot;:&quot;Uevent { action: \&quot;add\&quot;, devpath: \&quot;/devices/system/memory/memory179\&quot;, devname: \&quot;\&quot;, subsystem: \&quot;memory\&quot;, seqnum: \&quot;1403\&quot;, interface: \&quot;\&quot; }&quot;}
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>{&quot;msg&quot;:&quot;got uevent message&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:58:13.503030684Z&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;event&quot;:&quot;Uevent { action: \&quot;add\&quot;, devpath: \&quot;/devices/system/memory/memory180\&quot;, devname: \&quot;\&quot;, subsystem: \&quot;memory\&quot;, seqnum: \&quot;1404\&quot;, interface: \&quot;\&quot; }&quot;}
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>{&quot;msg&quot;:&quot;got uevent message&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:58:13.503075124Z&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;event&quot;:&quot;Uevent { action: \&quot;add\&quot;, devpath: \&quot;/devices/system/memory/memory181\&quot;, devname: \&quot;\&quot;, subsystem: \&quot;memory\&quot;, seqnum: \&quot;1405\&quot;, interface: \&quot;\&quot; }&quot;}
</span></code></pre></div>
<p>The guest receives the last memory device around this message:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>{&quot;msg&quot;:&quot;got uevent message&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:58:13.55354784Z&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;subsystem&quot;:&quot;uevent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;event&quot;:&quot;Uevent { action: \&quot;add\&quot;, devpath: \&quot;/devices/system/memory/memory927\&quot;, devname: \&quot;\&quot;, subsystem: \&quot;memory\&quot;, seqnum: \&quot;2151\&quot;, interface: \&quot;\&quot; }&quot;}
</span></code></pre></div>
<p>Which also lines up with the last time <code>vfio_pin_pages_remote</code> is called:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>025-11-20T17:58:12.678281961Z: vfio_pin_pages_remote(): vaddr=0x784ac0000000 npage=1048576 size=4294967296B limit=2048 pid=3454228
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>2025-11-20T17:58:13.178330994Z: vfio_pin_pages_remote took 500 ms
</span></code></pre></div>
<h3 id="interpreting-the-results">Interpreting the Results<a class="headerlink" href="#interpreting-the-results" title="Permanent link">&para;</a></h3>
<p>We now have a fairly clear picture of where a lot of the time is being spent.</p>
<table>
    <tr>
        <td> timestamp </td>
        <td> side </td>
        <td> time from last event </td>
        <td> description </td>
    </tr>
    <tr>
        <td> <code>2025-11-20T17:55:59.692656146Z</code> </td>
        <td> guest </td>
        <td> 1.2 seconds from T=0 </td>
        <td> The VM boots and calls out to the Kata agent. </td>
    </tr>
    <tr>
        <td> <code>2025-11-20T17:56:00.118714278Z</code> </td>
        <td> guest </td>
        <td> 0.5 seconds </td>
        <td> The kata agent finishes its initial sanity checks and bookkeeping tasks. A minimal amount of memory is hotplugged. </td>
    </tr>
    <tr>
        <td> <code>2025-11-20T17:56:11</code> </td>
        <td> guest </td>
        <td> ~11 seconds </td>
        <td>
            <div class="markdown">
                The PCIe enumeration process in the kernel notices its first NVIDIA GPU:

                <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>[   12.582377] pci 0000:02:00.0: [10de:2330] type 00 class 0x030200 PCIe Endpoint
</span></code></pre></div>
            </div>
        </td>
    </tr>
    <tr>
        <td> <code>2025-11-20T17:56:13.514397783Z</code> </td>
        <td> guest </td>
        <td> 2 seconds </td>
        <td> 
            <div class="markdown">
                The PCI device is added and Kata notices:

                <div class="language-json highlight"><span class="filename">JSON</span><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="p">{</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="nt">&quot;msg&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;got uevent message&quot;</span><span class="p">,</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">    </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="nt">&quot;ts&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-11-20T17:56:13.514397783Z&quot;</span><span class="p">,</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">    </span><span class="nt">&quot;pid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="p">,</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">    </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.1.0&quot;</span><span class="p">,</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">    </span><span class="nt">&quot;subsystem&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uevent&quot;</span><span class="p">,</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;kata-agent&quot;</span><span class="p">,</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">    </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;agent&quot;</span><span class="p">,</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">    </span><span class="nt">&quot;event&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Uevent { action: \&quot;add\&quot;, devpath: \&quot;/devices/pci0000:00/0000:00:05.0/0000:02:00.0\&quot;[...]&quot;</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="p">}</span>
</span></code></pre></div>
            </div>
        </td>
    </tr>
    <tr>
        <td> <code>2025-11-20T17:56:14.369905314Z</code> </td>
        <td> guest </td>
        <td> 1 second </td>
        <td> 
            <div class="markdown">
                The last GPU device is added to the PCI tree.
            </div>
        </td>
    </tr>
    <tr>
        <td> <code>2025-11-20T17:56:18.466861384Z</code> </td>
        <td> host </td>
        <td> 4 seconds </td>
        <td> 
            <div class="markdown">

                The first heavyweight `vfio_pin_pages_remote` call is made. This roughly corresponds to the guest-side NVIDIA kernel driver making this statement:

                <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>[   21.101954] nvidia 0000:02:00.0: enabling device (0140 -&gt; 0142)
</span></code></pre></div>

            </div>
        </td>
    </tr>
    <tr>
        <td> <code>2025-11-20T17:56:42.438059073Z</code> </td>
        <td> host </td>
        <td> 24 seconds </td>
        <td> 
            <div class="markdown">
                The last heavyweight `vfio_pin_pages_remote` call completes. This tells us each page pin for the GPUs takes about 3 seconds, which again matches the timings we get from bpftrace.


                <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>2025-11-20T17:56:39.269298767Z: vfio_pin_pages_remote(): vaddr=0x784c00000000 npage=33554432 size=137438953472B limit=2048 pid=3454228
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>2025-11-20T17:56:42.438059073Z: vfio_pin_pages_remote took 3168 ms
</span></code></pre></div>
            </div>
        </td>
    </tr>
    <tr>
        <td> <code>2025-11-20T17:57:40.052488828Z</code> </td>
        <td> guest </td>
        <td> 58 seconds </td>
        <td> 
            <div class="markdown">
                The CDI specs for all devices were injected successfully to kata-agent.

                <div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>{&quot;msg&quot;:&quot;waiting for CDI spec(s) to be generated (40 of 100 max tries) \&quot;unresolvable CDI devices nvidia.com/gpu=2, nvidia.com/gpu=0, nvidia.com/gpu=1, nvidia.com/gpu=6, nvidia.com/gpu=5, nvidia.com/gpu=3, nvidia.com/gpu=4\&quot;&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:57:37.23937483Z&quot;,&quot;subsystem&quot;:&quot;rpc&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;version&quot;:&quot;0.1.0&quot;}
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>{&quot;msg&quot;:&quot;handling signal&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:57:37.775940382Z&quot;,&quot;subsystem&quot;:&quot;signals&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;signal&quot;:&quot;SIGCHLD&quot;}
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>{&quot;msg&quot;:&quot;wait_status&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:57:37.775976033Z&quot;,&quot;version&quot;:&quot;0.1.0&quot;,&quot;subsystem&quot;:&quot;signals&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;wait_status result&quot;:&quot;Signaled(Pid(139), SIGKILL, false)&quot;}
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>{&quot;msg&quot;:&quot;child exited unexpectedly&quot;,&quot;level&quot;:&quot;INFO&quot;,&quot;ts&quot;:&quot;2025-11-20T17:57:37.775999136Z&quot;,&quot;pid&quot;:&quot;1&quot;,&quot;child-pid&quot;:&quot;139&quot;,&quot;source&quot;:&quot;agent&quot;,&quot;subsystem&quot;:&quot;signals&quot;,&quot;name&quot;:&quot;kata-agent&quot;,&quot;version&quot;:&quot;0.1.0&quot;}
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>{&quot;msg&quot;:&quot;all devices injected successfully, modified CDI container spec:
</span></code></pre></div>
            </div>
        </td>
    </tr>
</table>

<p>What did we learn from this? Well, the page pinning steps indeed take a long time to complete at around 24 seconds. That is significant, but it's not as significant as the amount of time that the kata-agent waits for the CDI specs to be injected into it.</p>
<p>The kata devs told me that after the devices are initialized and bound to the NVIDIA kernel driver, the Kata init system (NVRC) calls out to nvidia-ctk to create the CDI. This is where the point of synchronization comes from, so we must investigate this more.</p>
<h3 id="cant-we-use-iommu-hugepages">Can't we use <abbr title="Input-Output Memory Management Unit">IOMMU</abbr> Hugepages?<a class="headerlink" href="#cant-we-use-iommu-hugepages" title="Permanent link">&para;</a></h3>
<p>This page pinning step is an obvious area for performance improvements. One might reflexively reach for the idea of reducing the number of pages that have to be pinned. We can look again at one of our heavyweight <code>vfio_pin_pages_remote</code> calls:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>2025-11-24T23:06:01.865912341Z: vfio_pin_pages_remote(): vaddr=0x7d92c0000000 npage=33554432 size=137438953472B limit=2048 pid=705877                                                                                                              
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>2025-11-24T23:06:04.337004440Z: vfio_pin_pages_remote took 3471 ms  
</span></code></pre></div>
<p>If we divide the size by the number of pages, we get 4096. My intuition tells me that Intel VT-d <em>should</em> be able to support hugepages for <abbr title="Direct Memory Access">DMA</abbr> mappings, and <a href="https://edc.intel.com/content/www/us/en/design/ipla/software-development-platforms/client/platforms/alder-lake-desktop/12th-generation-intel-core-processors-datasheet-volume-1-of-2/004/intel-virtualization-technology-for-directed-i-o/#:~:text=The%20processor%20supports%20the%20following%20added%20new,Intel%C2%AE%20VT%2Dd%20engine%20when%20iGfx%20is%20enabled.">it in fact does</a>. However, the Linux <abbr title="Input-Output Memory Management Unit">IOMMU</abbr> driver <strong>does not</strong> support it for a few reasons. <abbr title="Input-Output Memory Management Unit">IOMMU</abbr> mappings need to be pinned, aligned, and contiguous at hugepage boundaries in host physical memory. Memory allocated by <abbr title="Quick Emulator">QEMU</abbr> often is not contiguous, and even when it has hugepages, they may not be aligned. We can see how the Intel <abbr title="Input-Output Memory Management Unit">IOMMU</abbr> driver handles these mappings:</p>
<div class="language-c highlight"><span class="filename">https://github.com/torvalds/linux/blob/v6.17/drivers/iommu/intel/iommu.c#L3590-L3594</span><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="w">    </span><span class="cm">/* Round up size to next multiple of PAGE_SIZE, if it and</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="cm">       the low bits of hpa would take us onto the next page */</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">    </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aligned_nrpages</span><span class="p">(</span><span class="n">hpa</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">);</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">__domain_mapping</span><span class="p">(</span><span class="n">dmar_domain</span><span class="p">,</span><span class="w"> </span><span class="n">iova</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">VTD_PAGE_SHIFT</span><span class="p">,</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">                </span><span class="n">hpa</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">VTD_PAGE_SHIFT</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">prot</span><span class="p">,</span><span class="w"> </span><span class="n">gfp</span><span class="p">);</span>
</span></code></pre></div>
<div class="language-c highlight"><span class="filename">https://github.com/torvalds/linux/blob/v6.17/drivers/iommu/intel/iommu.h#L1085-L1090</span><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="cm">/* Returns a number of VTD pages, but aligned to MM page size */</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="k">static</span><span class="w"> </span><span class="kr">inline</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">aligned_nrpages</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">host_addr</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="p">{</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="n">host_addr</span><span class="w"> </span><span class="o">&amp;=</span><span class="w"> </span><span class="o">~</span><span class="n">PAGE_MASK</span><span class="p">;</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">PAGE_ALIGN</span><span class="p">(</span><span class="n">host_addr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">VTD_PAGE_SHIFT</span><span class="p">;</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="p">}</span>
</span></code></pre></div>
<div class="language-c highlight"><span class="filename">https://github.com/torvalds/linux/blob/v6.17/include/linux/mm.h#L208-L209</span><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="cm">/* to align the pointer to the (next) page boundary */</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="cp">#define PAGE_ALIGN(addr) ALIGN(addr, PAGE_SIZE)</span>
</span></code></pre></div>
<p>And this <code>PAGE_SIZE</code> is statically compiled to 4KiB. So we're out of luck. This might be a further area of investigation to look into why this problem has not been solved and what attempts (if any) have been made to solve it.</p>
<h2 id="using-linux-function_graph-tracer">Using Linux function_graph Tracer<a class="headerlink" href="#using-linux-function_graph-tracer" title="Permanent link">&para;</a></h2>
<p>For a bit of fun, I wanted try the linux ftrace utility. This should give us the same information as bpftrace but through a different mechanism. We do this with the following steps:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>cd /sys/kernel/tracing
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a># Turn on
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>echo 1 &gt; tracing_on
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a># Use the function_graph tracer
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>echo function_graph &gt; current_tracer
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a># Only trace the function we care about
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>echo vfio_pin_pages_remote &gt; set_ftrace_filter
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a># We boot a Kata VM
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a># Turn off
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a>echo 0 &gt; tracing_on
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a># Inspect
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a>cat trace &gt; /tmp/trace.out
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a>less /tmp/trace.out
</span></code></pre></div>
<div class="result">

<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>223) $ 3389981 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>223) ! 899.140 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a>223) ! 370.991 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>223) ! 125.701 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a>108) $ 3460872 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>108) ! 852.023 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a>108) ! 372.259 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a>108) ! 133.358 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a>223) $ 3542329 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>223) ! 901.558 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>223) ! 400.939 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a>223) ! 137.331 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a>108) $ 3748615 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a>108) ! 938.270 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a>223) ! 388.741 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a>223) ! 123.352 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a>108) $ 3173935 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a>108) ! 853.867 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a>108) ! 390.508 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a>108) ! 139.837 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-21"><a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a>108) $ 3288427 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-22"><a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a>108) ! 964.999 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-23"><a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a>108) ! 407.721 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-24"><a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a>108) ! 141.893 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-25"><a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a>108) $ 3358507 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span><span id="__span-36-26"><a id="__codelineno-36-26" name="__codelineno-36-26" href="#__codelineno-36-26"></a>108) ! 954.615 us  |  vfio_pin_pages_remote [vfio_iommu_type1]();
</span></code></pre></div>

</div>

<p>We see a similar result. There are 7 heavyweight page pinning calls that each take about 3.5 seconds.</p>
<h2 id="aside-on-mmio-mappings">Aside on <abbr title="Memory Mapped IO">MMIO</abbr> Mappings<a class="headerlink" href="#aside-on-mmio-mappings" title="Permanent link">&para;</a></h2>
<p>So far, we have measured the <abbr title="Input-Output Memory Management Unit">IOMMU</abbr> mapping performance which deals specifically with giving the passed-through GPU devices <abbr title="Direct Memory Access">DMA</abbr> capabilities into the guest physical address space. There is another side of memory mapping that deals with CPU access into the GPU, which in a way can be considered <abbr title="Direct Memory Access">DMA</abbr> in the opposite direction. This of course is called Memory-Mapped IO (<abbr title="Memory Mapped IO">MMIO</abbr>).</p>
<p>I won't go into the history of why <abbr title="Memory Mapped IO">MMIO</abbr> exists. Instead, we first need to consider how <abbr title="Memory Mapped IO">MMIO</abbr> is being established in this case. We're running a <abbr title="Quick Emulator">QEMU</abbr> VMM that is using Linux <abbr title="Kernel Virtual Machine">KVM</abbr> acceleration. <abbr title="Kernel Virtual Machine">KVM</abbr> is essentially Linux's implementation of a type-1 hypervisor: it allows userspace processes like <abbr title="Quick Emulator">QEMU</abbr> to offload virtualization tasks to the kernel rather than having to emulate everything themselves. Thus, the <abbr title="Kernel Virtual Machine">KVM</abbr> code is where <abbr title="Quick Emulator">QEMU</abbr> will be requesting to establish <abbr title="Memory Mapped IO">MMIO</abbr> mappings.</p>
<p>To summarize more, the vfio-pci kernel driver exposes the device <abbr title="Base Address Register">BARs</abbr> as offsets into a file descriptor. This host-side <abbr title="Memory Mapped IO">MMIO</abbr> mapping has already been created as part of the PCIe enumeration process. What <abbr title="Quick Emulator">QEMU</abbr> must do is establish with <abbr title="Kernel Virtual Machine">KVM</abbr> a callback that says "when the guest attempts to access this range of memory, let me handle the page fault." This is done by calling the <code>KVM_SET_USER_MEMORY_REGION</code> ioctl which establishes a guest memory region (which is perhaps obvious). <abbr title="Quick Emulator">QEMU</abbr> then purposefully does not map this region to any RAM, which in effect creates a memory region "hole" in the guest memory. When the guest touches this hole, <abbr title="Kernel Virtual Machine">KVM</abbr> can't resolve it to RAM, so it calls back to <abbr title="Quick Emulator">QEMU</abbr> to handle this page fault (this is considered a VM Exit scenario). After receiving this callback from <abbr title="Kernel Virtual Machine">KVM</abbr>, <abbr title="Quick Emulator">QEMU</abbr> will forward the access to the vfio-pci kernel driver using the appropriate file handle. This guest-physical-memory to device file descriptor mapping is maintained by <abbr title="Quick Emulator">QEMU</abbr> itself. From this point onward, vfio-pci relies on normal host <abbr title="Memory Mapped IO">MMIO</abbr> mappings to then talk directly to the device in question.</p>
<p>To put it more concretely in what this looks like from <abbr title="Quick Emulator">QEMU</abbr>'s source code:</p>
<div class="language-c highlight"><span class="filename">https://github.com/qemu/qemu/blob/v10.1.2/accel/kvm/kvm-all.c#L3402</span><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">kvm_vcpu_ioctl</span><span class="p">(</span><span class="n">CPUState</span><span class="w"> </span><span class="o">*</span><span class="n">cpu</span><span class="p">,</span><span class="w"> </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="p">{</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">arg</span><span class="p">;</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="w">    </span><span class="kt">va_list</span><span class="w"> </span><span class="n">ap</span><span class="p">;</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="w">    </span><span class="n">va_start</span><span class="p">(</span><span class="n">ap</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="p">);</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="w">    </span><span class="n">arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">va_arg</span><span class="p">(</span><span class="n">ap</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="p">);</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="w">    </span><span class="n">va_end</span><span class="p">(</span><span class="n">ap</span><span class="p">);</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="w">    </span><span class="n">trace_kvm_vcpu_ioctl</span><span class="p">(</span><span class="n">cpu</span><span class="o">-&gt;</span><span class="n">cpu_index</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">);</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a><span class="w">    </span><span class="n">accel_cpu_ioctl_begin</span><span class="p">(</span><span class="n">cpu</span><span class="p">);</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ioctl</span><span class="p">(</span><span class="n">cpu</span><span class="o">-&gt;</span><span class="n">kvm_fd</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">);</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a><span class="w">    </span><span class="n">accel_cpu_ioctl_end</span><span class="p">(</span><span class="n">cpu</span><span class="p">);</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ret</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a><span class="w">        </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">errno</span><span class="p">;</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a><span class="p">}</span>
</span></code></pre></div>
<p>This <code>ioctl</code> is called from an outer loop called <code>kvm_cpu_exec</code>, specifically this line:</p>
<div class="language-c highlight"><span class="filename">https://github.com/qemu/qemu/blob/v10.1.2/accel/kvm/kvm-all.c#L3205</span><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="w">        </span><span class="n">run_ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kvm_vcpu_ioctl</span><span class="p">(</span><span class="n">cpu</span><span class="p">,</span><span class="w"> </span><span class="n">KVM_RUN</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span></code></pre></div>
<p>The return code is then checked for various cases, one of them being <code>KVM_EXIT_MMIO</code>:</p>
<div class="language-c highlight"><span class="filename">https://github.com/qemu/qemu/blob/v10.1.2/accel/kvm/kvm-all.c#L3253-L3261</span><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">KVM_EXIT_MMIO</span><span class="p">:</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">            </span><span class="cm">/* Called outside BQL */</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">            </span><span class="n">address_space_rw</span><span class="p">(</span><span class="o">&amp;</span><span class="n">address_space_memory</span><span class="p">,</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">                             </span><span class="n">run</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">.</span><span class="n">phys_addr</span><span class="p">,</span><span class="w"> </span><span class="n">attrs</span><span class="p">,</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">                             </span><span class="n">run</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">.</span><span class="n">data</span><span class="p">,</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">                             </span><span class="n">run</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">.</span><span class="n">len</span><span class="p">,</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">                             </span><span class="n">run</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">.</span><span class="n">is_write</span><span class="p">);</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">            </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span></code></pre></div>
<p>The question we can then ask is: what boot-time performance hit is incurred from creating these <abbr title="Memory Mapped IO">MMIO</abbr> mappings? From the host kernel's perspective, there is no work done at all; <abbr title="Quick Emulator">QEMU</abbr> simply created a guest memory region and left a hole for <abbr title="Memory Mapped IO">MMIO</abbr> regions. There is still a performance hit incurred when the kernel must walk the page tables to determine whether or not this memory access is backed by RAM or if it must be handled by <abbr title="Quick Emulator">QEMU</abbr>, but that can be optimized just like any other page-table access pattern through the use of hugepages. </p>
<p>What about <abbr title="Quick Emulator">QEMU</abbr>'s performance hit when creating these mappings? This is also unlikely to be significant. We assume that the <abbr title="Quick Emulator">QEMU</abbr> developers are smart and they would only have to create one mapping per <abbr title="Base Address Register">BAR</abbr>. Most PCIe devices only have a small handful of <abbr title="Base Address Register">BARs</abbr>, so the only work <abbr title="Quick Emulator">QEMU</abbr> must do is:</p>
<ol>
<li>Discover the device <abbr title="Base Address Register">BARs</abbr></li>
<li>Create a range in memory reserved for <abbr title="Memory Mapped IO">MMIO</abbr> to those <abbr title="Base Address Register">BARs</abbr> (which should be a constant time operation, i.e. independent of the actual size of the <abbr title="Base Address Register">BARs</abbr>).</li>
<li>Translate the <abbr title="Memory Mapped IO">MMIO</abbr> page fault into the correct vfio-pci file descriptor (which again should be effectively a constant-time operation).</li>
</ol>
<p>You can see that there is really no opportunity for the creation, maintenance, or servicing of these mappings to have any significant affect on boot-time performance. Just like we discovered with <abbr title="Input-Output Memory Management Unit">IOMMU</abbr> mappings, the only real optimization to be made here is to reduce the size of the page trees that the Linux kernel must walk, which again is most often done by giving <abbr title="Quick Emulator">QEMU</abbr> access to hugepages.</p>
<h2 id="hugepages">Hugepages<a class="headerlink" href="#hugepages" title="Permanent link">&para;</a></h2>
<h3 id="turned-off">Turned Off<a class="headerlink" href="#turned-off" title="Permanent link">&para;</a></h3>
<p>In the last few sections, we've established pretty clearly that hugepages are necessary for increasing the boot performance of <abbr title="Quick Emulator">QEMU</abbr>. Kata containers allows us to specify hypervisor-level configuration options that we'll be interested in: <a href="https://github.com/kata-containers/kata-containers/blob/55489818d6d5c2ab4c8dbd586c1001474048c2b9/docs/how-to/how-to-set-sandbox-config-kata.md">https://github.com/kata-containers/kata-containers/blob/55489818d6d5c2ab4c8dbd586c1001474048c2b9/docs/how-to/how-to-set-sandbox-config-kata.md</a></p>
<p>These are passed in as Kubernetes annotations. Specifically, we care about <code>io.katacontainers.config.hypervisor.enable_hugepages</code>. We have to configure Kata to allow certain parameters to be passed, so I have this specified:</p>
<div class="language-toml highlight"><span class="filename">configuration.toml</span><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="k">[hypervisor.qemu]</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">enable_annotations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;enable_hugepages&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;default_memory&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;enable_iommu&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;virtio_fs_extra_args&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;kernel_params&quot;</span><span class="p">]</span><span class="w"> </span>
</span></code></pre></div>
<p>Now when we set <code>io.katacontainers.config.hypervisor.enable_hugepages</code> in k8s manifest annotations, it overrides the relevant configuration set in that same <code>configuration.toml</code> file. This is the explanation given in the default Kata config file:</p>
<div class="language-toml highlight"><span class="filename">configuration.toml</span><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1"># Enable huge pages for VM RAM, default false</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="c1"># Enabling this will result in the VM memory</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="c1"># being allocated using huge pages.</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="c1"># This is useful when you want to use vhost-user network</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="c1"># stacks within the container. This will automatically</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="c1"># result in memory pre allocation</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="c1">#enable_hugepages = true</span>
</span></code></pre></div>
<p>First we must tell the Linux kernel to create hugepages. I have already configured my kernel with 1GiB hugepages:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>$ cat /sys/kernel/mm/hugepages/hugepages-1048576kB/nr_hugepages
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>504
</span></code></pre></div>
<p>You can also see this reflected in k8s:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>$ kubectl describe node dal03-sgpu-160 |&amp; grep hugepages
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>  hugepages-1Gi:        504Gi
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>  hugepages-2Mi:        0
</span></code></pre></div>
<p>Let's first boot a Kata <abbr title="Quick Emulator">QEMU</abbr> VM with no hugepages attached (and to be clear, the container image has already been downloaded):</p>
<div class="language-yaml highlight"><span class="filename">pod.yaml</span><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cdi-vfio-gpu0-test-160</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">    </span><span class="nt">io.katacontainers.config.hypervisor.default_memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10240&quot;</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="w">    </span><span class="c1">#io.katacontainers.config.hypervisor.enable_hugepages: &quot;true&quot;</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="w">  </span><span class="nt">runtimeClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kata-qemu-nvidia-gpu</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="w">  </span><span class="nt">nodeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dal03-sgpu-160</span>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">check</span>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu:22.04</span>
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a><span class="w">        </span><span class="nt">nvidia.com/gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500m</span>
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100Gi</span>
</span><span id="__span-44-20"><a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a><span class="w">        </span><span class="c1">#hugepages-1Gi: 125Gi</span>
</span><span id="__span-44-21"><a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a><span class="w">      </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-44-22"><a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a><span class="w">        </span><span class="nt">nvidia.com/gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>
</span><span id="__span-44-23"><a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500m</span>
</span><span id="__span-44-24"><a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100Gi</span>
</span><span id="__span-44-25"><a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a><span class="w">        </span><span class="c1">#hugepages-1Gi: 125Gi</span>
</span><span id="__span-44-26"><a id="__codelineno-44-26" name="__codelineno-44-26" href="#__codelineno-44-26"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span>
</span><span id="__span-44-27"><a id="__codelineno-44-27" name="__codelineno-44-27" href="#__codelineno-44-27"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/bash</span>
</span><span id="__span-44-28"><a id="__codelineno-44-28" name="__codelineno-44-28" href="#__codelineno-44-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-lc</span>
</span><span id="__span-44-29"><a id="__codelineno-44-29" name="__codelineno-44-29" href="#__codelineno-44-29"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sleep 9999</span>
</span></code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Pod Overhead</p>
<p>Also note that the Kata RuntimeClass needs to have overhead set:</p>
<div class="language-yaml highlight"><span class="filename">YAML</span><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node.k8s.io/v1</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="nt">handler</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kata-qemu-nvidia-gpu</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RuntimeClass</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="nt">creationTimestamp</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2025-09-09T20:16:14Z&quot;</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kata-qemu-nvidia-gpu</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="nt">resourceVersion</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;17416951&quot;</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="nt">uid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ba2819f0-4370-44c8-b745-9cdfa49890ff</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="nt">overhead</span><span class="p">:</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="nt">podFixed</span><span class="p">:</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="w">    </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="w">    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="nt">scheduling</span><span class="p">:</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="nt">nodeSelector</span><span class="p">:</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="w">    </span><span class="nt">katacontainers.io/kata-runtime</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
</span></code></pre></div>
<p>The Pod overhead specifies how much additional memory overhead should be added to the pod cgroup to account for memory taken up by <abbr title="Quick Emulator">QEMU</abbr> and the host kernel itself related to bookkeeping structures (mainly page tables, it seems). You can see that 20GiB + 100GiB are represented exactly in the cgroup limit:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>$ cat /sys/fs/cgroup/kubepods.slice/kubepods-podea116782_533a_4cc7_af74_c19661ac9c47.slice/memory.max
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>128849018880
</span></code></pre></div>
<p>Not specifying this overhead will cause the Linux cgroup OOM killer to kill your pod, because <abbr title="Quick Emulator">QEMU</abbr> will allocate 100GiB of shared memory for the guest in addition to the host kernel overhead that is taken up to maintain the 4KiB page table mappings.</p>
</div>
<p>We submit the pod and find the difference between the start (submission) time and the time the pod transitioned to a <code>Running</code> state:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>$ kubectl describe pod cdi-vfio-gpu0-test-160 |&amp; grep &#39;Nov 2025&#39;
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>Start Time:          Mon, 24 Nov 2025 21:21:09 +0000
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>      Started:      Mon, 24 Nov 2025 21:24:12 +0000
</span></code></pre></div>
<p>Or in other words, 3:03 minutes. It's also interesting to look at various memory statistics:</p>
<p><a class="glightbox" href="https://assets.topofmind.dev/posts/2025-11-19-gpu-passthrough-boot/Screenshot+2025-11-24+at+3.36.51%E2%80%AFPM.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="https://assets.topofmind.dev/posts/2025-11-19-gpu-passthrough-boot/Screenshot+2025-11-24+at+3.36.51%E2%80%AFPM.png" /></a>
<a class="glightbox" href="https://assets.topofmind.dev/posts/2025-11-19-gpu-passthrough-boot/Screenshot+2025-11-24+at+3.58.32%E2%80%AFPM.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="https://assets.topofmind.dev/posts/2025-11-19-gpu-passthrough-boot/Screenshot+2025-11-24+at+3.58.32%E2%80%AFPM.png" /></a></p>
<p>The page table bytes themselves (accounted as part of what the host kernel uses) are almost 2GiB! That's significant. The overall kernel bytes, which includes page tables but also any other data structures in use to support this <abbr title="Quick Emulator">QEMU</abbr> process, is 3.43GiB. We can also take a look at the process memory map:</p>
<details class="note">
<summary>pmap</summary>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>$ pmap 678295
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>678295:   /opt/kata/bin/qemu-system-x86_64 -name sandbox-6b5d0d72fe60c5c4055f1fb0137b5d6138b3b79d299ec09d9d91191a5f5ad6aa,debug-threads=on -uuid b3ea4564-b366-45e7-90eb-f98e3c1015e6 -machine q35,accel=kvm -cpu host,pmu=off -qmp unix:fd=3,server=on,wait=off -m 10240M,slots=10,maxmem=2060538M -device pci-bridge,bus=pcie.0,id=pci-bridge-0,chassis_nr=1,shpc=off,addr=2,io-reserve=4k,mem-reserve=1m,pref64-reserve=1m -device virtio-serial-pci,disable-modern=false,id=serial0 -device virtconsole,chardev=charconsole0,id=console0 -chardev socket,id=charconsole0,path=/run/vc/vm/6b5d0d72fe60c5c4055f1fb0137b5d6138b3b79d299ec09d9d91191a5f5ad6aa/console.sock,server=on,wait=off -device virtio-scsi-pci,id=scsi0,disable-modern=false -object rng-random,id=rng0,filename=/dev/urandom -device virtio-rng-pci,rng=rng0 -device pcie-root-port,id=rp0,bus=pcie.0,chassis=0,slot=0,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp1,bus=pcie.0,chassis=0,slot=1,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp2,bus=pcie.0,chassis=0,slot=2,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp3,bus=pcie.0,chassis=0,slot=3,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp4,bus=pcie.0,chassis=0,slot=4,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp5,bus=pcie.0,chassis=0,slot=5,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp6,bus=pcie.0,chassis=0,slot=6,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -devicepcie-root-port,id=rp7,bus=pcie.0,chassis=0,slot=7,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp8,bus=pcie.0,chassis=0,slot=8,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp9,bus=pcie.0,chassis=0,slot=9,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device vhost-vsock-pci,disable-modern=false,vhostfd=4,id=vsock-1243457778,guest-cid=1243457778 -chardev socket,id=char-ae1f2f6fcddb4b1b,path=/run/vc/vm/6b5d0d72fe60c5c4055f1fb0137b5d6138b3b79d299ec09d9d91191a5f5ad6aa/vhost-fs.sock -device vhost-user-fs-pci,chardev=char-ae1f2f6fcddb4b1b,tag=kataShared,queue-size=1024 -netdev tap,id=network-0,vhost=on,vhostfds=5,fds=6 -device driver=virtio-net-pci,netdev=network-0,mac=7a:d1:ec:bc:16:2a,disable-modern=false,mq=on,vectors=4 -rtc base=utc,driftfix=slew,clock=host -global kvm-pit.lost_tick_policy=discard -vga none -no-user-config -nodefaults -nographic --no-reboot -object memory-backend-file,id=dimm1,size=10240M,mem-path=/dev/shm,share=on -numa node,memdev=dimm1 -kernel /opt/kata/share/kata-containers/vmlinux-6.12.47-166-nvidia-gpu -initrd /opt/kata/share/kata-containers/kata-ubuntu-noble-nvidia-gpu-580.65.06.initrd -append tsc=reliable no_timer_check rcupdate.rcu_expedited=1 i8042.direct=1 i8042.dumbkbd=1 i8042.nopnp=1 i8042.noaux=1 noreplace-smp reboot=k cryptomgr.notests net.ifnames=0 pci=lastbus=0 console=hvc0 console=hvc1 debug panic=1 nr_cpus=224 selinux=0 scsi_mod.scan=none agent.log=debug agent.debug_console agent.debug_console_vport=1026 agent.debug_console agent.debug_console_vport=1026 agent.hotplug_timeout=20 cgroup_no_v1=all -pidfile /run/vc/vm/6b5d0d72fe60c5c4055f1fb0137b5d6138b3b79d299ec09d9d91191a5f5ad6aa/pid -smp 1,cores=1,threads=1,sockets=224,maxcpus=224
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>000055558a964000 122196K rw---   [ anon ]
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>00007a35bffff000 104857600K rw-s- qemu_back_mem.mem0.FMRypy (deleted)
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>00007a4ebffff000      4K -----   [ anon ]
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>00007a4ec0000000 134217728K rw-s-   [ anon ]
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>00007a6f00000000 134217728K rw-s-   [ anon ]
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>00007a8f40000000 134217728K rw-s-   [ anon ]
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a>00007aaf80000000 134217728K rw-s-   [ anon ]
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a>00007acfc0000000 134217728K rw-s-   [ anon ]
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>00007af000000000 134217728K rw-s-   [ anon ]
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a>00007b1020000000    132K rw---   [ anon ]
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a>00007b1020021000  65404K -----   [ anon ]
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a>00007b1024000000  32768K rw-s-   [ anon ]
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a>00007b1028000000  16384K rw-s-   [ anon ]
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a>00007b102a000000  32768K rw-s-   [ anon ]
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a>00007b102e000000  16384K rw-s-   [ anon ]
</span><span id="__span-48-18"><a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a>00007b1030000000  32768K rw-s-   [ anon ]
</span><span id="__span-48-19"><a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a>00007b1034000000  16384K rw-s-   [ anon ]
</span><span id="__span-48-20"><a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a>00007b1036000000  32768K rw-s-   [ anon ]
</span><span id="__span-48-21"><a id="__codelineno-48-21" name="__codelineno-48-21" href="#__codelineno-48-21"></a>00007b103a000000  16384K rw-s-   [ anon ]
</span><span id="__span-48-22"><a id="__codelineno-48-22" name="__codelineno-48-22" href="#__codelineno-48-22"></a>00007b103c000000  32768K rw-s-   [ anon ]
</span><span id="__span-48-23"><a id="__codelineno-48-23" name="__codelineno-48-23" href="#__codelineno-48-23"></a>00007b1040000000 134217728K rw-s-   [ anon ]
</span><span id="__span-48-24"><a id="__codelineno-48-24" name="__codelineno-48-24" href="#__codelineno-48-24"></a>00007b3042000000  16384K rw-s-   [ anon ]
</span><span id="__span-48-25"><a id="__codelineno-48-25" name="__codelineno-48-25" href="#__codelineno-48-25"></a>00007b3044000000  32768K rw-s-   [ anon ]
</span><span id="__span-48-26"><a id="__codelineno-48-26" name="__codelineno-48-26" href="#__codelineno-48-26"></a>00007b3048000000  32768K rw-s-   [ anon ]
</span><span id="__span-48-27"><a id="__codelineno-48-27" name="__codelineno-48-27" href="#__codelineno-48-27"></a>00007b304a200000 132788K r---- kata-ubuntu-noble-nvidia-gpu-580.65.06.initrd
</span><span id="__span-48-28"><a id="__codelineno-48-28" name="__codelineno-48-28" href="#__codelineno-48-28"></a>00007b3052400000 289048K rw--- vmlinux-6.12.47-166-nvidia-gpu
</span><span id="__span-48-29"><a id="__codelineno-48-29" name="__codelineno-48-29" href="#__codelineno-48-29"></a>00007b3064000000  52388K rw---   [ anon ]
</span><span id="__span-48-30"><a id="__codelineno-48-30" name="__codelineno-48-30" href="#__codelineno-48-30"></a>00007b3067329000  13148K -----   [ anon ]
</span><span id="__span-48-31"><a id="__codelineno-48-31" name="__codelineno-48-31" href="#__codelineno-48-31"></a>00007b306a000000  16384K rw-s-   [ anon ]
</span><span id="__span-48-32"><a id="__codelineno-48-32" name="__codelineno-48-32" href="#__codelineno-48-32"></a>00007b306c000000    132K rw---   [ anon ]
</span><span id="__span-48-33"><a id="__codelineno-48-33" name="__codelineno-48-33" href="#__codelineno-48-33"></a>00007b306c021000  65404K -----   [ anon ]
</span><span id="__span-48-34"><a id="__codelineno-48-34" name="__codelineno-48-34" href="#__codelineno-48-34"></a>00007b3072000000  16384K rw-s-   [ anon ]
</span><span id="__span-48-35"><a id="__codelineno-48-35" name="__codelineno-48-35" href="#__codelineno-48-35"></a>00007b3073fff000 10485760K rw-s- qemu_back_mem.dimm1.NFzjyN (deleted)
</span><span id="__span-48-36"><a id="__codelineno-48-36" name="__codelineno-48-36" href="#__codelineno-48-36"></a>00007b32f3fff000      4K -----   [ anon ]
</span><span id="__span-48-37"><a id="__codelineno-48-37" name="__codelineno-48-37" href="#__codelineno-48-37"></a>00007b32f4000000    132K rw---   [ anon ]
</span><span id="__span-48-38"><a id="__codelineno-48-38" name="__codelineno-48-38" href="#__codelineno-48-38"></a>00007b32f4021000  65404K -----   [ anon ]
</span><span id="__span-48-39"><a id="__codelineno-48-39" name="__codelineno-48-39" href="#__codelineno-48-39"></a>00007b32f97ff000      4K -----   [ anon ]
</span><span id="__span-48-40"><a id="__codelineno-48-40" name="__codelineno-48-40" href="#__codelineno-48-40"></a>00007b32f9800000   8192K rw---   [ anon ]
</span><span id="__span-48-41"><a id="__codelineno-48-41" name="__codelineno-48-41" href="#__codelineno-48-41"></a>00007b32fa000000      4K rw---   [ anon ]
</span><span id="__span-48-42"><a id="__codelineno-48-42" name="__codelineno-48-42" href="#__codelineno-48-42"></a>00007b32fa001000      4K -----   [ anon ]
</span><span id="__span-48-43"><a id="__codelineno-48-43" name="__codelineno-48-43" href="#__codelineno-48-43"></a>00007b32fa200000     64K rw---   [ anon ]
</span><span id="__span-48-44"><a id="__codelineno-48-44" name="__codelineno-48-44" href="#__codelineno-48-44"></a>00007b32fa210000      4K -----   [ anon ]
</span><span id="__span-48-45"><a id="__codelineno-48-45" name="__codelineno-48-45" href="#__codelineno-48-45"></a>00007b32fa400000   2048K rw---   [ anon ]
</span><span id="__span-48-46"><a id="__codelineno-48-46" name="__codelineno-48-46" href="#__codelineno-48-46"></a>00007b32fa600000      4K -----   [ anon ]
</span><span id="__span-48-47"><a id="__codelineno-48-47" name="__codelineno-48-47" href="#__codelineno-48-47"></a>00007b32fa800000    256K rw---   [ anon ]
</span><span id="__span-48-48"><a id="__codelineno-48-48" name="__codelineno-48-48" href="#__codelineno-48-48"></a>00007b32fa840000      4K -----   [ anon ]
</span><span id="__span-48-49"><a id="__codelineno-48-49" name="__codelineno-48-49" href="#__codelineno-48-49"></a>00007b32faa0a000    924K rw---   [ anon ]
</span><span id="__span-48-50"><a id="__codelineno-48-50" name="__codelineno-48-50" href="#__codelineno-48-50"></a>00007b32fac00000    128K rw---   [ anon ]
</span><span id="__span-48-51"><a id="__codelineno-48-51" name="__codelineno-48-51" href="#__codelineno-48-51"></a>00007b32fac20000      4K -----   [ anon ]
</span><span id="__span-48-52"><a id="__codelineno-48-52" name="__codelineno-48-52" href="#__codelineno-48-52"></a>00007b32fac64000   1648K rw---   [ anon ]
</span><span id="__span-48-53"><a id="__codelineno-48-53" name="__codelineno-48-53" href="#__codelineno-48-53"></a>00007b32fae00000    256K rw---   [ anon ]
</span><span id="__span-48-54"><a id="__codelineno-48-54" name="__codelineno-48-54" href="#__codelineno-48-54"></a>00007b32fae40000      4K -----   [ anon ]
</span><span id="__span-48-55"><a id="__codelineno-48-55" name="__codelineno-48-55" href="#__codelineno-48-55"></a>00007b32faef9000      4K -----   [ anon ]
</span><span id="__span-48-56"><a id="__codelineno-48-56" name="__codelineno-48-56" href="#__codelineno-48-56"></a>00007b32faefa000   8192K rw---   [ anon ]
</span><span id="__span-48-57"><a id="__codelineno-48-57" name="__codelineno-48-57" href="#__codelineno-48-57"></a>00007b32fb6fa000      4K -----   [ anon ]
</span><span id="__span-48-58"><a id="__codelineno-48-58" name="__codelineno-48-58" href="#__codelineno-48-58"></a>00007b32fb6fb000   8192K rw---   [ anon ]
</span><span id="__span-48-59"><a id="__codelineno-48-59" name="__codelineno-48-59" href="#__codelineno-48-59"></a>00007b32fbefb000   1040K rw---   [ anon ]
</span><span id="__span-48-60"><a id="__codelineno-48-60" name="__codelineno-48-60" href="#__codelineno-48-60"></a>00007b32fbfff000      4K -----   [ anon ]
</span><span id="__span-48-61"><a id="__codelineno-48-61" name="__codelineno-48-61" href="#__codelineno-48-61"></a>00007b32fc000000   8192K rw---   [ anon ]
</span><span id="__span-48-62"><a id="__codelineno-48-62" name="__codelineno-48-62" href="#__codelineno-48-62"></a>00007b32fc800000   3020K r---- qemu-system-x86_64
</span><span id="__span-48-63"><a id="__codelineno-48-63" name="__codelineno-48-63" href="#__codelineno-48-63"></a>00007b32fcaf3000   7144K r-x-- qemu-system-x86_64
</span><span id="__span-48-64"><a id="__codelineno-48-64" name="__codelineno-48-64" href="#__codelineno-48-64"></a>00007b32fd1ed000   3804K r---- qemu-system-x86_64
</span><span id="__span-48-65"><a id="__codelineno-48-65" name="__codelineno-48-65" href="#__codelineno-48-65"></a>00007b32fd5a4000  12140K r---- qemu-system-x86_64
</span><span id="__span-48-66"><a id="__codelineno-48-66" name="__codelineno-48-66" href="#__codelineno-48-66"></a>00007b32fe17f000    892K rw--- qemu-system-x86_64
</span><span id="__span-48-67"><a id="__codelineno-48-67" name="__codelineno-48-67" href="#__codelineno-48-67"></a>00007b32fe25e000     64K rw---   [ anon ]
</span><span id="__span-48-68"><a id="__codelineno-48-68" name="__codelineno-48-68" href="#__codelineno-48-68"></a>00007b32fe2a6000     12K rw-s-   [ anon ]
</span><span id="__span-48-69"><a id="__codelineno-48-69" name="__codelineno-48-69" href="#__codelineno-48-69"></a>00007b32fe2a9000     12K rw-s-   [ anon ]
</span><span id="__span-48-70"><a id="__codelineno-48-70" name="__codelineno-48-70" href="#__codelineno-48-70"></a>00007b32fe2ac000      4K rw-s- zero (deleted)
</span><span id="__span-48-71"><a id="__codelineno-48-71" name="__codelineno-48-71" href="#__codelineno-48-71"></a>00007b32fe2ad000    520K rw---   [ anon ]
</span><span id="__span-48-72"><a id="__codelineno-48-72" name="__codelineno-48-72" href="#__codelineno-48-72"></a>00007b32fe32f000      4K -----   [ anon ]
</span><span id="__span-48-73"><a id="__codelineno-48-73" name="__codelineno-48-73" href="#__codelineno-48-73"></a>00007b32fe330000   1024K rw---   [ anon ]
</span><span id="__span-48-74"><a id="__codelineno-48-74" name="__codelineno-48-74" href="#__codelineno-48-74"></a>00007ffc432c8000    132K rw---   [ stack ]
</span><span id="__span-48-75"><a id="__codelineno-48-75" name="__codelineno-48-75" href="#__codelineno-48-75"></a>00007ffc4335a000     16K r----   [ anon ]
</span><span id="__span-48-76"><a id="__codelineno-48-76" name="__codelineno-48-76" href="#__codelineno-48-76"></a>00007ffc4335e000      8K r-x--   [ anon ]
</span><span id="__span-48-77"><a id="__codelineno-48-77" name="__codelineno-48-77" href="#__codelineno-48-77"></a>ffffffffff600000      4K --x--   [ anon ]
</span><span id="__span-48-78"><a id="__codelineno-48-78" name="__codelineno-48-78" href="#__codelineno-48-78"></a>total       1056085680K
</span></code></pre></div>
</details>
<details class="pmap">
<summary>pmap extended format</summary>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a># pmap 695044 -X
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>695044:   /opt/kata/bin/qemu-system-x86_64 -name sandbox-7e02176c05039fe1b548e19b4740185b85dd41d64d53de2516f3e499eb171d63,debug-threads=on -uuid 0187de4d-dde5-4903-8df3-c58c3157cff5 -machine q35,accel=kvm -cpu host,pmu=off -qmp unix:fd=3,server=on,wait=off -m 10240M,slots=10,maxmem=2060538M -device pci-bridge,bus=pcie.0,id=pci-bridge-0,chassis_nr=1,shpc=off,addr=2,io-reserve=4k,mem-reserve=1m,pref64-reserve=1m -device virtio-serial-pci,disable-modern=false,id=serial0 -device virtconsole,chardev=charconsole0,id=console0 -chardev socket,id=charconsole0,path=/run/vc/vm/7e02176c05039fe1b548e19b4740185b85dd41d64d53de2516f3e499eb171d63/console.sock,server=on,wait=off -device virtio-scsi-pci,id=scsi0,disable-modern=false -object rng-random,id=rng0,filename=/dev/urandom -device virtio-rng-pci,rng=rng0 -device pcie-root-port,id=rp0,bus=pcie.0,chassis=0,slot=0,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp1,bus=pcie.0,chassis=0,slot=1,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp2,bus=pcie.0,chassis=0,slot=2,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp3,bus=pcie.0,chassis=0,slot=3,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp4,bus=pcie.0,chassis=0,slot=4,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp5,bus=pcie.0,chassis=0,slot=5,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp6,bus=pcie.0,chassis=0,slot=6,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp7,bus=pcie.0,chassis=0,slot=7,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp8,bus=pcie.0,chassis=0,slot=8,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp9,bus=pcie.0,chassis=0,slot=9,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device vhost-vsock-pci,disable-modern=false,vhostfd=4,id=vsock-521422038,guest-cid=521422038 -chardev socket,id=char-9891c1fc58405e2d,path=/run/vc/vm/7e02176c05039fe1b548e19b4740185b85dd41d64d53de2516f3e499eb171d63/vhost-fs.sock -device vhost-user-fs-pci,chardev=char-9891c1fc58405e2d,tag=kataShared,queue-size=1024 -netdev tap,id=network-0,vhost=on,vhostfds=5,fds=6 -device driver=virtio-net-pci,netdev=network-0,mac=be:67:c5:11:20:26,disable-modern=false,mq=on,vectors=4 -rtc base=utc,driftfix=slew,clock=host -global kvm-pit.lost_tick_policy=discard -vga none -no-user-config -nodefaults -nographic --no-reboot -object memory-backend-file,id=dimm1,size=10240M,mem-path=/dev/shm,share=on -numa node,memdev=dimm1 -kernel /opt/kata/share/kata-containers/vmlinux-6.12.47-166-nvidia-gpu -initrd /opt/kata/share/kata-containers/kata-ubuntu-noble-nvidia-gpu-580.65.06.initrd -append tsc=reliable no_timer_check rcupdate.rcu_expedited=1 i8042.direct=1 i8042.dumbkbd=1 i8042.nopnp=1 i8042.noaux=1 noreplace-smp reboot=k cryptomgr.notests net.ifnames=0 pci=lastbus=0 console=hvc0 console=hvc1 debug panic=1 nr_cpus=224 selinux=0 scsi_mod.scan=none agent.log=debug agent.debug_console agent.debug_console_vport=1026 agent.debug_console agent.debug_console_vport=1026 agent.hotplug_timeout=20 cgroup_no_v1=all -pidfile /run/vc/vm/7e02176c05039fe1b548e19b4740185b85dd41d64d53de2516f3e499eb171d63/pid -smp 1,cores=1,threads=1,sockets=224,maxcpus=224
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>        Address Perm       Offset Device   Inode       Size       Rss       Pss Pss_Dirty Referenced Anonymous  KSM LazyFree ShmemPmdMapped FilePmdMapped Shared_Hugetlb Private_Hugetlb Swap SwapPss Locked THPeligible ProtectionKey Mapping
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>    555585386000 rw-p     00000000  00:00       0     122196    105904    105904    105904     105904    105904    0        0              0             0              0               0    0       0      0           0             0 [heap]
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>    711ebffff000 rw-s     00000000  00:1c     252  104857600 104857600 104857600 104857600  104857600         0    0        0              0             0              0               0    0       0      0           0             0 qemu_back_mem.mem0.mvNUmy (deleted)
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>    7137bffff000 ---p     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a>    7137c0000000 rw-s 57a000000000  00:0f    1050  134217728         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>    715800000000 rw-s 53a000000000  00:0f    1050  134217728         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>    717840000000 rw-s 4fa000000000  00:0f    1050  134217728         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>    719880000000 rw-s 43a000000000  00:0f    1050  134217728         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>    71b8c0000000 rw-s 3fa000000000  00:0f    1050  134217728         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a>    71d900000000 rw-s 3da000000000  00:0f    1050  134217728         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>    71f940000000 rw-s 3ba000000000  00:0f    1050  134217728         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a>    72194c000000 rw-p     00000000  00:00       0        132        52        52        52         52        52    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a>    72194c021000 ---p     00000000  00:00       0      65404         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a>    721952000000 rw-s 57e040000000  00:0f    1050      32768         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a>    721956000000 rw-s 57e042000000  00:0f    1050      16384         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a>    721958000000 rw-s 53e040000000  00:0f    1050      32768         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a>    72195c000000 rw-s 53e042000000  00:0f    1050      16384         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a>    72195e000000 rw-s 4fe040000000  00:0f    1050      32768         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a>    721962000000 rw-s 4fe042000000  00:0f    1050      16384         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a>    721964000000 rw-s 43e040000000  00:0f    1050      32768         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a>    721968000000 rw-s 43e042000000  00:0f    1050      16384         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24" href="#__codelineno-49-24"></a>    72196a000000 rw-s 3fe040000000  00:0f    1050      32768         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-25"><a id="__codelineno-49-25" name="__codelineno-49-25" href="#__codelineno-49-25"></a>    72196e000000 rw-s 3fe042000000  00:0f    1050      16384         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-26"><a id="__codelineno-49-26" name="__codelineno-49-26" href="#__codelineno-49-26"></a>    721970000000 rw-s 3de040000000  00:0f    1050      32768         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-27"><a id="__codelineno-49-27" name="__codelineno-49-27" href="#__codelineno-49-27"></a>    721974000000 rw-s 3be040000000  00:0f    1050      32768         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-28"><a id="__codelineno-49-28" name="__codelineno-49-28" href="#__codelineno-49-28"></a>    721976200000 r--p     00000000 103:1f 6553611     132788    132788    132788         0     132788         0    0        0              0             0              0               0    0       0      0           0             0 kata-ubuntu-noble-nvidia-gpu-580.65.06.initrd
</span><span id="__span-49-29"><a id="__codelineno-49-29" name="__codelineno-49-29" href="#__codelineno-49-29"></a>    72197e400000 rw-p     00000000 103:1f 6553612     289048     20864     20864         0      20864         0    0        0              0             0              0               0    0       0      0           0             0 vmlinux-6.12.47-166-nvidia-gpu
</span><span id="__span-49-30"><a id="__codelineno-49-30" name="__codelineno-49-30" href="#__codelineno-49-30"></a>    721990000000 rw-p     00000000  00:00       0      52392      2060      2060      2060       2060      2060    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-31"><a id="__codelineno-49-31" name="__codelineno-49-31" href="#__codelineno-49-31"></a>    72199332a000 ---p     00000000  00:00       0      13144         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-32"><a id="__codelineno-49-32" name="__codelineno-49-32" href="#__codelineno-49-32"></a>    721996000000 rw-s 3de042000000  00:0f    1050      16384         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-33"><a id="__codelineno-49-33" name="__codelineno-49-33" href="#__codelineno-49-33"></a>    721998000000 rw-p     00000000  00:00       0        132        64        64        64         64        64    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-34"><a id="__codelineno-49-34" name="__codelineno-49-34" href="#__codelineno-49-34"></a>    721998021000 ---p     00000000  00:00       0      65404         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-35"><a id="__codelineno-49-35" name="__codelineno-49-35" href="#__codelineno-49-35"></a>    72199e000000 rw-s 3be042000000  00:0f    1050      16384         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-49-36"><a id="__codelineno-49-36" name="__codelineno-49-36" href="#__codelineno-49-36"></a>    72199ffff000 rw-s     00000000  00:1c     251   10485760  10485760  10475768  10475768   10485760         0    0        0              0             0              0               0    0       0      0           0             0 qemu_back_mem.dimm1.R0EWjI (deleted)
</span><span id="__span-49-37"><a id="__codelineno-49-37" name="__codelineno-49-37" href="#__codelineno-49-37"></a>    721c1ffff000 ---p     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-38"><a id="__codelineno-49-38" name="__codelineno-49-38" href="#__codelineno-49-38"></a>    721c20000000 rw-p     00000000  00:00       0        132        12        12        12         12        12    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-39"><a id="__codelineno-49-39" name="__codelineno-49-39" href="#__codelineno-49-39"></a>    721c20021000 ---p     00000000  00:00       0      65404         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-40"><a id="__codelineno-49-40" name="__codelineno-49-40" href="#__codelineno-49-40"></a>    721c245ff000 ---p     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-41"><a id="__codelineno-49-41" name="__codelineno-49-41" href="#__codelineno-49-41"></a>    721c24600000 rw-p     00000000  00:00       0       8192        12        12        12         12        12    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-42"><a id="__codelineno-49-42" name="__codelineno-49-42" href="#__codelineno-49-42"></a>    721c24e00000 rw-p     00000000  00:00       0          4         4         4         4          4         4    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-43"><a id="__codelineno-49-43" name="__codelineno-49-43" href="#__codelineno-49-43"></a>    721c24e01000 ---p     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-44"><a id="__codelineno-49-44" name="__codelineno-49-44" href="#__codelineno-49-44"></a>    721c25000000 rw-p     00000000  00:00       0         64        64         4         4         64        64   60        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-45"><a id="__codelineno-49-45" name="__codelineno-49-45" href="#__codelineno-49-45"></a>    721c25010000 ---p     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-46"><a id="__codelineno-49-46" name="__codelineno-49-46" href="#__codelineno-49-46"></a>    721c25200000 rw-p     00000000  00:00       0       2048      2048        54        54       2048      2048 2004        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-47"><a id="__codelineno-49-47" name="__codelineno-49-47" href="#__codelineno-49-47"></a>    721c25400000 ---p     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-48"><a id="__codelineno-49-48" name="__codelineno-49-48" href="#__codelineno-49-48"></a>    721c25600000 rw-p     00000000  00:00       0        256       160       160       160        160       160    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-49"><a id="__codelineno-49-49" name="__codelineno-49-49" href="#__codelineno-49-49"></a>    721c25640000 ---p     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-50"><a id="__codelineno-49-50" name="__codelineno-49-50" href="#__codelineno-49-50"></a>    721c2580a000 rw-p     00000000  00:00       0        924       924       924       924        924       924    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-51"><a id="__codelineno-49-51" name="__codelineno-49-51" href="#__codelineno-49-51"></a>    721c25a00000 rw-p     00000000  00:00       0        128         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-52"><a id="__codelineno-49-52" name="__codelineno-49-52" href="#__codelineno-49-52"></a>    721c25a20000 ---p     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-53"><a id="__codelineno-49-53" name="__codelineno-49-53" href="#__codelineno-49-53"></a>    721c25c00000 rw-p     00000000  00:00       0        256       256       256       256        256       256    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-54"><a id="__codelineno-49-54" name="__codelineno-49-54" href="#__codelineno-49-54"></a>    721c25c40000 ---p     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-55"><a id="__codelineno-49-55" name="__codelineno-49-55" href="#__codelineno-49-55"></a>    721c25c5c000 rw-p     00000000  00:00       0       1648      1648      1648      1648       1648      1648    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-56"><a id="__codelineno-49-56" name="__codelineno-49-56" href="#__codelineno-49-56"></a>    721c25e39000 ---p     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-57"><a id="__codelineno-49-57" name="__codelineno-49-57" href="#__codelineno-49-57"></a>    721c25e3a000 rw-p     00000000  00:00       0       8192        32        32        32         32        32    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-58"><a id="__codelineno-49-58" name="__codelineno-49-58" href="#__codelineno-49-58"></a>    721c2663a000 ---p     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-59"><a id="__codelineno-49-59" name="__codelineno-49-59" href="#__codelineno-49-59"></a>    721c2663b000 rw-p     00000000  00:00       0       8192        12        12        12         12        12    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-60"><a id="__codelineno-49-60" name="__codelineno-49-60" href="#__codelineno-49-60"></a>    721c26e3b000 rw-p     00000000  00:00       0        780       780       780       780        780       780    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-61"><a id="__codelineno-49-61" name="__codelineno-49-61" href="#__codelineno-49-61"></a>    721c26efe000 ---p     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-62"><a id="__codelineno-49-62" name="__codelineno-49-62" href="#__codelineno-49-62"></a>    721c26eff000 rw-p     00000000  00:00       0       1024         4         4         4          4         4    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-63"><a id="__codelineno-49-63" name="__codelineno-49-63" href="#__codelineno-49-63"></a>    721c26fff000 ---p     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-64"><a id="__codelineno-49-64" name="__codelineno-49-64" href="#__codelineno-49-64"></a>    721c27000000 rw-p     00000000  00:00       0       8192         8         8         8          8         8    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-65"><a id="__codelineno-49-65" name="__codelineno-49-65" href="#__codelineno-49-65"></a>    721c27800000 r--p     00000000 103:1f 6553641       3020      3020      3020         0       3020         0    0        0              0             0              0               0    0       0      0           0             0 qemu-system-x86_64
</span><span id="__span-49-66"><a id="__codelineno-49-66" name="__codelineno-49-66" href="#__codelineno-49-66"></a>    721c27af3000 r-xp     002f3000 103:1f 6553641       7144      6776      6776         0       6776         0    0        0              0             0              0               0    0       0      0           0             0 qemu-system-x86_64
</span><span id="__span-49-67"><a id="__codelineno-49-67" name="__codelineno-49-67" href="#__codelineno-49-67"></a>    721c281ed000 r--p     009ed000 103:1f 6553641       3804      2012      2012         0       2012         0    0        0              0             0              0               0    0       0      0           0             0 qemu-system-x86_64
</span><span id="__span-49-68"><a id="__codelineno-49-68" name="__codelineno-49-68" href="#__codelineno-49-68"></a>    721c285a4000 r--p     00da3000 103:1f 6553641      12140      1560      1560      1560       1560      1560    0        0              0             0              0               0    0       0      0           0             0 qemu-system-x86_64
</span><span id="__span-49-69"><a id="__codelineno-49-69" name="__codelineno-49-69" href="#__codelineno-49-69"></a>    721c2917f000 rw-p     0197e000 103:1f 6553641        892       892       892       888        892       888    0        0              0             0              0               0    0       0      0           0             0 qemu-system-x86_64
</span><span id="__span-49-70"><a id="__codelineno-49-70" name="__codelineno-49-70" href="#__codelineno-49-70"></a>    721c2925e000 rw-p     00000000  00:00       0         64        48        48        48         48        48    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-71"><a id="__codelineno-49-71" name="__codelineno-49-71" href="#__codelineno-49-71"></a>    721c2929b000 rw-s     00000000  00:0f    1050         12         8         8         8          8         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:kvm-vcpu:223
</span><span id="__span-49-72"><a id="__codelineno-49-72" name="__codelineno-49-72" href="#__codelineno-49-72"></a>    721c2929e000 rw-s     00000000  00:0f    1050         12        12        12        12         12         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:kvm-vcpu:0
</span><span id="__span-49-73"><a id="__codelineno-49-73" name="__codelineno-49-73" href="#__codelineno-49-73"></a>    721c292a1000 rw-s     00000000  00:01   90199          4         4         4         4          4         0    0        0              0             0              0               0    0       0      0           0             0 zero (deleted)
</span><span id="__span-49-74"><a id="__codelineno-49-74" name="__codelineno-49-74" href="#__codelineno-49-74"></a>    721c292a2000 rw-p     00000000  00:00       0        780       780       780       780        780       780    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-49-75"><a id="__codelineno-49-75" name="__codelineno-49-75" href="#__codelineno-49-75"></a>    7ffd7248b000 rw-p     00000000  00:00       0        132        40        40        40         40        40    0        0              0             0              0               0    0       0      0           0             0 [stack]
</span><span id="__span-49-76"><a id="__codelineno-49-76" name="__codelineno-49-76" href="#__codelineno-49-76"></a>    7ffd7254c000 r--p     00000000  00:00       0         16         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 [vvar]
</span><span id="__span-49-77"><a id="__codelineno-49-77" name="__codelineno-49-77" href="#__codelineno-49-77"></a>    7ffd72550000 r-xp     00000000  00:00       0          8         4         0         0          4         0    0        0              0             0              0               0    0       0      0           0             0 [vdso]
</span><span id="__span-49-78"><a id="__codelineno-49-78" name="__codelineno-49-78" href="#__codelineno-49-78"></a>ffffffffff600000 --xp     00000000  00:00       0          4         0         0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 [vsyscall]
</span><span id="__span-49-79"><a id="__codelineno-49-79" name="__codelineno-49-79" href="#__codelineno-49-79"></a>                                                ========== ========= ========= ========= ========== ========= ==== ======== ============== ============= ============== =============== ==== ======= ====== =========== ============= 
</span><span id="__span-49-80"><a id="__codelineno-49-80" name="__codelineno-49-80" href="#__codelineno-49-80"></a>                                                1056085680 115626212 115614162 115448698  115626212    117360 2064        0              0             0              0               0    0       0      0           0             0 KB 
</span></code></pre></div>
</details>
<h3 id="turned-on">Turned On<a class="headerlink" href="#turned-on" title="Permanent link">&para;</a></h3>
<p>Let's now do the same measurements but with hugepages being granted to the <abbr title="Quick Emulator">QEMU</abbr> process. We only make a few minor modifications:</p>
<div class="language-diff highlight"><span class="filename">Diff</span><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="gu">7c7</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="gd">&lt;     #io.katacontainers.config.hypervisor.enable_hugepages: &quot;true&quot;</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="gs">---</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="gi">&gt;     io.katacontainers.config.hypervisor.enable_hugepages: &quot;true&quot;</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>20c20
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="gd">&lt;         #hugepages-1Gi: 125Gi</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="gs">---</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="gi">&gt;         hugepages-1Gi: 125Gi</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a>25c25
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="gd">&lt;         #hugepages-1Gi: 125Gi</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="gs">---</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="gi">&gt;         hugepages-1Gi: 125Gi</span>
</span></code></pre></div>
<div class="result">

<div class="language-yaml highlight"><span class="filename">pod.yaml</span><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cdi-vfio-gpu0-test-160</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">    </span><span class="nt">io.katacontainers.config.hypervisor.default_memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10240&quot;</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">    </span><span class="nt">io.katacontainers.config.hypervisor.enable_hugepages</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">  </span><span class="nt">runtimeClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kata-qemu-nvidia-gpu</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">  </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">  </span><span class="nt">nodeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dal03-sgpu-160</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">check</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu:22.04</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="w">        </span><span class="nt">nvidia.com/gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500m</span>
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100Gi</span>
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="w">        </span><span class="nt">hugepages-1Gi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">125Gi</span>
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a><span class="w">      </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a><span class="w">        </span><span class="nt">nvidia.com/gpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>
</span><span id="__span-51-23"><a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500m</span>
</span><span id="__span-51-24"><a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100Gi</span>
</span><span id="__span-51-25"><a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a><span class="w">        </span><span class="nt">hugepages-1Gi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">125Gi</span>
</span><span id="__span-51-26"><a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span>
</span><span id="__span-51-27"><a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/bash</span>
</span><span id="__span-51-28"><a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-lc</span>
</span><span id="__span-51-29"><a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sleep 9999</span>
</span></code></pre></div>

</div>

<p>We submit the pod and do the same measurements:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a># kubectl describe pod cdi-vfio-gpu0-test-160 |&amp; grep &#39;Nov 2025&#39;
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>Start Time:          Mon, 24 Nov 2025 21:50:22 +0000
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>      Started:      Mon, 24 Nov 2025 21:52:48 +0000
</span></code></pre></div>
<p>That's 2:26 minutes, 37 seconds faster than before. Our memory statistics are also much better:</p>
<p><a class="glightbox" href="https://assets.topofmind.dev/posts/2025-11-19-gpu-passthrough-boot/Screenshot+2025-11-24+at+3.56.46%E2%80%AFPM.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="https://assets.topofmind.dev/posts/2025-11-19-gpu-passthrough-boot/Screenshot+2025-11-24+at+3.56.46%E2%80%AFPM.png" /></a>
<a class="glightbox" href="https://assets.topofmind.dev/posts/2025-11-19-gpu-passthrough-boot/Screenshot+2025-11-24+at+3.57.32%E2%80%AFPM.png" data-type="image" data-width="100%" data-height="auto" data-desc-position="bottom"><img alt="" src="https://assets.topofmind.dev/posts/2025-11-19-gpu-passthrough-boot/Screenshot+2025-11-24+at+3.57.32%E2%80%AFPM.png" /></a></p>
<p>Something a little more subtle, but still worth noting, is that both the secondary page tables (used in things like Extended Page Tables) and the slab memory (used for grouping data types together in memory) are both far reduced. More noteworthy is the fact that our <code>Memory Total Bytes</code> is strangely around 3GiB. Why would that be? Well, when we allocated the hugepages before the pod was spun up, that memory utilization becomes persistent and is counted against the "free" memory of the system. You'll note that a command like <code>free</code> will count those pre-allocated hugepages against the <code>used</code> column. For whatever reason, the cgroup system does not consider the resident set size of the RAM backing a hugepage to be part of a process's utilization. I'm sure there is a good reason for it.</p>
<p>Let's look at this process's memory map:</p>
<details class="note">
<summary>pmap</summary>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>pmap 686403 
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>686403:   /opt/kata/bin/qemu-system-x86_64 -name sandbox-3f219f48134f8da7b5faa009eccaafd50eef417c5e2d6ea4ed0f86c7ddacefaf,debug-threads=on -uuid de67ce82-f347-4ec3-aafb-90a16666e57b -machine q35,accel=kvm -cpu host,pmu=off -qmp unix:fd=3,server=on,wait=off -m 10240M,slots=10,maxmem=2060538M -device pci-bridge,bus=pcie.0,id=pci-bridge-0,chassis_nr=1,shpc=off,addr=2,io-reserve=4k,mem-reserve=1m,pref64-reserve=1m -device virtio-serial-pci,disable-modern=false,id=serial0 -device virtconsole,chardev=charconsole0,id=console0 -chardev socket,id=charconsole0,path=/run/vc/vm/3f219f48134f8da7b5faa009eccaafd50eef417c5e2d6ea4ed0f86c7ddacefaf/console.sock,server=on,wait=off -device virtio-scsi-pci,id=scsi0,disable-modern=false -object rng-random,id=rng0,filename=/dev/urandom -device virtio-rng-pci,rng=rng0 -device pcie-root-port,id=rp0,bus=pcie.0,chassis=0,slot=0,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp1,bus=pcie.0,chassis=0,slot=1,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp2,bus=pcie.0,chassis=0,slot=2,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp3,bus=pcie.0,chassis=0,slot=3,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp4,bus=pcie.0,chassis=0,slot=4,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp5,bus=pcie.0,chassis=0,slot=5,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp6,bus=pcie.0,chassis=0,slot=6,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp7,bus=pcie.0,chassis=0,slot=7,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp8,bus=pcie.0,chassis=0,slot=8,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp9,bus=pcie.0,chassis=0,slot=9,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device vhost-vsock-pci,disable-modern=false,vhostfd=4,id=vsock-3257660399,guest-cid=3257660399 -chardev socket,id=char-c3493397927c7b53,path=/run/vc/vm/3f219f48134f8da7b5faa009eccaafd50eef417c5e2d6ea4ed0f86c7ddacefaf/vhost-fs.sock -device vhost-user-fs-pci,chardev=char-c3493397927c7b53,tag=kataShared,queue-size=1024 -netdev tap,id=network-0,vhost=on,vhostfds=5,fds=6 -device driver=virtio-net-pci,netdev=network-0,mac=f6:c9:df:61:71:4b,disable-modern=false,mq=on,vectors=4 -rtc base=utc,driftfix=slew,clock=host -global kvm-pit.lost_tick_policy=discard -vga none -no-user-config -nodefaults -nographic --no-reboot -object memory-backend-file,id=dimm1,size=10240M,mem-path=/dev/hugepages,share=on,prealloc=on -numa node,memdev=dimm1 -kernel /opt/kata/share/kata-containers/vmlinux-6.12.47-166-nvidia-gpu -initrd /opt/kata/share/kata-containers/kata-ubuntu-noble-nvidia-gpu-580.65.06.initrd -append tsc=reliable no_timer_check rcupdate.rcu_expedited=1 i8042.direct=1 i8042.dumbkbd=1 i8042.nopnp=1 i8042.noaux=1 noreplace-smp reboot=k cryptomgr.notests net.ifnames=0 pci=lastbus=0 console=hvc0 console=hvc1 debug panic=1 nr_cpus=224 selinux=0 scsi_mod.scan=none agent.log=debug agent.debug_console agent.debug_console_vport=1026 agent.debug_console agent.debug_console_vport=1026 agent.hotplug_timeout=20 cgroup_no_v1=all -pidfile /run/vc/vm/3f219f48134f8da7b5faa009eccaafd50eef417c5e2d6ea4ed0f86c7ddacefaf/pid -smp 1,cores=1,threads=1,sockets=224,maxcpus=224
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>000055556e427000 122196K rw---   [ anon ]
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>0000736480000000 104857600K rw-s- qemu_back_mem.mem0.nWhJ9P (deleted)
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>0000737d80000000      4K -----   [ anon ]
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>0000737dc0000000 134217728K rw-s-   [ anon ]
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>0000739e00000000 134217728K rw-s-   [ anon ]
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>000073be40000000 134217728K rw-s-   [ anon ]
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>000073de80000000 134217728K rw-s-   [ anon ]
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>000073fec0000000 134217728K rw-s-   [ anon ]
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>0000741f00000000 134217728K rw-s-   [ anon ]
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>0000743f38000000    132K rw---   [ anon ]
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a>0000743f38021000  65404K -----   [ anon ]
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a>0000743f40000000 134217728K rw-s-   [ anon ]
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>0000745f48000000  32768K rw-s-   [ anon ]
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a>0000745f4c000000  16384K rw-s-   [ anon ]
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a>0000745f4e000000  32768K rw-s-   [ anon ]
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a>0000745f52000000  16384K rw-s-   [ anon ]
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a>0000745f54000000  32768K rw-s-   [ anon ]
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a>0000745f58000000  16384K rw-s-   [ anon ]
</span><span id="__span-53-21"><a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a>0000745f5a000000  32768K rw-s-   [ anon ]
</span><span id="__span-53-22"><a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a>0000745f5e000000  16384K rw-s-   [ anon ]
</span><span id="__span-53-23"><a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a>0000745f60000000  32768K rw-s-   [ anon ]
</span><span id="__span-53-24"><a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a>0000745f64000000  16384K rw-s-   [ anon ]
</span><span id="__span-53-25"><a id="__codelineno-53-25" name="__codelineno-53-25" href="#__codelineno-53-25"></a>0000745f66000000  32768K rw-s-   [ anon ]
</span><span id="__span-53-26"><a id="__codelineno-53-26" name="__codelineno-53-26" href="#__codelineno-53-26"></a>0000745f6a000000  16384K rw-s-   [ anon ]
</span><span id="__span-53-27"><a id="__codelineno-53-27" name="__codelineno-53-27" href="#__codelineno-53-27"></a>0000745f6c000000  32768K rw-s-   [ anon ]
</span><span id="__span-53-28"><a id="__codelineno-53-28" name="__codelineno-53-28" href="#__codelineno-53-28"></a>0000745f6e400000 289048K rw--- vmlinux-6.12.47-166-nvidia-gpu
</span><span id="__span-53-29"><a id="__codelineno-53-29" name="__codelineno-53-29" href="#__codelineno-53-29"></a>0000745f80000000 10485760K rw-s- qemu_back_mem.dimm1.8mPNaQ (deleted)
</span><span id="__span-53-30"><a id="__codelineno-53-30" name="__codelineno-53-30" href="#__codelineno-53-30"></a>0000746200000000      4K -----   [ anon ]
</span><span id="__span-53-31"><a id="__codelineno-53-31" name="__codelineno-53-31" href="#__codelineno-53-31"></a>0000746202000000  16384K rw-s-   [ anon ]
</span><span id="__span-53-32"><a id="__codelineno-53-32" name="__codelineno-53-32" href="#__codelineno-53-32"></a>0000746203e00000 132788K r---- kata-ubuntu-noble-nvidia-gpu-580.65.06.initrd
</span><span id="__span-53-33"><a id="__codelineno-53-33" name="__codelineno-53-33" href="#__codelineno-53-33"></a>000074620c000000    132K rw---   [ anon ]
</span><span id="__span-53-34"><a id="__codelineno-53-34" name="__codelineno-53-34" href="#__codelineno-53-34"></a>000074620c021000  65404K -----   [ anon ]
</span><span id="__span-53-35"><a id="__codelineno-53-35" name="__codelineno-53-35" href="#__codelineno-53-35"></a>0000746210000000  56880K rw---   [ anon ]
</span><span id="__span-53-36"><a id="__codelineno-53-36" name="__codelineno-53-36" href="#__codelineno-53-36"></a>000074621378c000   8656K -----   [ anon ]
</span><span id="__span-53-37"><a id="__codelineno-53-37" name="__codelineno-53-37" href="#__codelineno-53-37"></a>0000746214000000    132K rw---   [ anon ]
</span><span id="__span-53-38"><a id="__codelineno-53-38" name="__codelineno-53-38" href="#__codelineno-53-38"></a>0000746214021000  65404K -----   [ anon ]
</span><span id="__span-53-39"><a id="__codelineno-53-39" name="__codelineno-53-39" href="#__codelineno-53-39"></a>00007462197ff000      4K -----   [ anon ]
</span><span id="__span-53-40"><a id="__codelineno-53-40" name="__codelineno-53-40" href="#__codelineno-53-40"></a>0000746219800000   8192K rw---   [ anon ]
</span><span id="__span-53-41"><a id="__codelineno-53-41" name="__codelineno-53-41" href="#__codelineno-53-41"></a>000074621a000000      4K rw---   [ anon ]
</span><span id="__span-53-42"><a id="__codelineno-53-42" name="__codelineno-53-42" href="#__codelineno-53-42"></a>000074621a001000      4K -----   [ anon ]
</span><span id="__span-53-43"><a id="__codelineno-53-43" name="__codelineno-53-43" href="#__codelineno-53-43"></a>000074621a200000     64K rw---   [ anon ]
</span><span id="__span-53-44"><a id="__codelineno-53-44" name="__codelineno-53-44" href="#__codelineno-53-44"></a>000074621a210000      4K -----   [ anon ]
</span><span id="__span-53-45"><a id="__codelineno-53-45" name="__codelineno-53-45" href="#__codelineno-53-45"></a>000074621a400000   2048K rw---   [ anon ]
</span><span id="__span-53-46"><a id="__codelineno-53-46" name="__codelineno-53-46" href="#__codelineno-53-46"></a>000074621a600000      4K -----   [ anon ]
</span><span id="__span-53-47"><a id="__codelineno-53-47" name="__codelineno-53-47" href="#__codelineno-53-47"></a>000074621a800000    256K rw---   [ anon ]
</span><span id="__span-53-48"><a id="__codelineno-53-48" name="__codelineno-53-48" href="#__codelineno-53-48"></a>000074621a840000      4K -----   [ anon ]
</span><span id="__span-53-49"><a id="__codelineno-53-49" name="__codelineno-53-49" href="#__codelineno-53-49"></a>000074621aa0a000    924K rw---   [ anon ]
</span><span id="__span-53-50"><a id="__codelineno-53-50" name="__codelineno-53-50" href="#__codelineno-53-50"></a>000074621ac00000    128K rw---   [ anon ]
</span><span id="__span-53-51"><a id="__codelineno-53-51" name="__codelineno-53-51" href="#__codelineno-53-51"></a>000074621ac20000      4K -----   [ anon ]
</span><span id="__span-53-52"><a id="__codelineno-53-52" name="__codelineno-53-52" href="#__codelineno-53-52"></a>000074621ac64000   1648K rw---   [ anon ]
</span><span id="__span-53-53"><a id="__codelineno-53-53" name="__codelineno-53-53" href="#__codelineno-53-53"></a>000074621ae00000    256K rw---   [ anon ]
</span><span id="__span-53-54"><a id="__codelineno-53-54" name="__codelineno-53-54" href="#__codelineno-53-54"></a>000074621ae40000      4K -----   [ anon ]
</span><span id="__span-53-55"><a id="__codelineno-53-55" name="__codelineno-53-55" href="#__codelineno-53-55"></a>000074621af3a000      4K -----   [ anon ]
</span><span id="__span-53-56"><a id="__codelineno-53-56" name="__codelineno-53-56" href="#__codelineno-53-56"></a>000074621af3b000   8192K rw---   [ anon ]
</span><span id="__span-53-57"><a id="__codelineno-53-57" name="__codelineno-53-57" href="#__codelineno-53-57"></a>000074621b73b000      4K -----   [ anon ]
</span><span id="__span-53-58"><a id="__codelineno-53-58" name="__codelineno-53-58" href="#__codelineno-53-58"></a>000074621b73c000   8192K rw---   [ anon ]
</span><span id="__span-53-59"><a id="__codelineno-53-59" name="__codelineno-53-59" href="#__codelineno-53-59"></a>000074621bf3c000    780K rw---   [ anon ]
</span><span id="__span-53-60"><a id="__codelineno-53-60" name="__codelineno-53-60" href="#__codelineno-53-60"></a>000074621bfff000      4K -----   [ anon ]
</span><span id="__span-53-61"><a id="__codelineno-53-61" name="__codelineno-53-61" href="#__codelineno-53-61"></a>000074621c000000   8192K rw---   [ anon ]
</span><span id="__span-53-62"><a id="__codelineno-53-62" name="__codelineno-53-62" href="#__codelineno-53-62"></a>000074621c800000   3020K r---- qemu-system-x86_64
</span><span id="__span-53-63"><a id="__codelineno-53-63" name="__codelineno-53-63" href="#__codelineno-53-63"></a>000074621caf3000   7144K r-x-- qemu-system-x86_64
</span><span id="__span-53-64"><a id="__codelineno-53-64" name="__codelineno-53-64" href="#__codelineno-53-64"></a>000074621d1ed000   3804K r---- qemu-system-x86_64
</span><span id="__span-53-65"><a id="__codelineno-53-65" name="__codelineno-53-65" href="#__codelineno-53-65"></a>000074621d5a4000  12140K r---- qemu-system-x86_64
</span><span id="__span-53-66"><a id="__codelineno-53-66" name="__codelineno-53-66" href="#__codelineno-53-66"></a>000074621e17f000    892K rw--- qemu-system-x86_64
</span><span id="__span-53-67"><a id="__codelineno-53-67" name="__codelineno-53-67" href="#__codelineno-53-67"></a>000074621e25e000     64K rw---   [ anon ]
</span><span id="__span-53-68"><a id="__codelineno-53-68" name="__codelineno-53-68" href="#__codelineno-53-68"></a>000074621e274000     12K rw-s-   [ anon ]
</span><span id="__span-53-69"><a id="__codelineno-53-69" name="__codelineno-53-69" href="#__codelineno-53-69"></a>000074621e277000     12K rw-s-   [ anon ]
</span><span id="__span-53-70"><a id="__codelineno-53-70" name="__codelineno-53-70" href="#__codelineno-53-70"></a>000074621e27a000      4K rw-s- zero (deleted)
</span><span id="__span-53-71"><a id="__codelineno-53-71" name="__codelineno-53-71" href="#__codelineno-53-71"></a>000074621e27b000    780K rw---   [ anon ]
</span><span id="__span-53-72"><a id="__codelineno-53-72" name="__codelineno-53-72" href="#__codelineno-53-72"></a>000074621e33e000      4K -----   [ anon ]
</span><span id="__span-53-73"><a id="__codelineno-53-73" name="__codelineno-53-73" href="#__codelineno-53-73"></a>000074621e33f000   1024K rw---   [ anon ]
</span><span id="__span-53-74"><a id="__codelineno-53-74" name="__codelineno-53-74" href="#__codelineno-53-74"></a>00007fffd39f2000    136K rw---   [ stack ]
</span><span id="__span-53-75"><a id="__codelineno-53-75" name="__codelineno-53-75" href="#__codelineno-53-75"></a>00007fffd3b9a000     16K r----   [ anon ]
</span><span id="__span-53-76"><a id="__codelineno-53-76" name="__codelineno-53-76" href="#__codelineno-53-76"></a>00007fffd3b9e000      8K r-x--   [ anon ]
</span><span id="__span-53-77"><a id="__codelineno-53-77" name="__codelineno-53-77" href="#__codelineno-53-77"></a>ffffffffff600000      4K --x--   [ anon ]
</span><span id="__span-53-78"><a id="__codelineno-53-78" name="__codelineno-53-78" href="#__codelineno-53-78"></a>total       1056085684K
</span></code></pre></div>
</details>
<details class="note">
<summary>pmap extended format</summary>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>pmap 686403 -X
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>686403:   /opt/kata/bin/qemu-system-x86_64 -name sandbox-3f219f48134f8da7b5faa009eccaafd50eef417c5e2d6ea4ed0f86c7ddacefaf,debug-threads=on -uuid de67ce82-f347-4ec3-aafb-90a16666e57b -machine q35,accel=kvm -cpu host,pmu=off -qmp unix:fd=3,server=on,wait=off -m 10240M,slots=10,maxmem=2060538M -device pci-bridge,bus=pcie.0,id=pci-bridge-0,chassis_nr=1,shpc=off,addr=2,io-reserve=4k,mem-reserve=1m,pref64-reserve=1m -device virtio-serial-pci,disable-modern=false,id=serial0 -device virtconsole,chardev=charconsole0,id=console0 -chardev socket,id=charconsole0,path=/run/vc/vm/3f219f48134f8da7b5faa009eccaafd50eef417c5e2d6ea4ed0f86c7ddacefaf/console.sock,server=on,wait=off -device virtio-scsi-pci,id=scsi0,disable-modern=false -object rng-random,id=rng0,filename=/dev/urandom -device virtio-rng-pci,rng=rng0 -device pcie-root-port,id=rp0,bus=pcie.0,chassis=0,slot=0,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp1,bus=pcie.0,chassis=0,slot=1,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp2,bus=pcie.0,chassis=0,slot=2,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp3,bus=pcie.0,chassis=0,slot=3,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp4,bus=pcie.0,chassis=0,slot=4,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp5,bus=pcie.0,chassis=0,slot=5,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp6,bus=pcie.0,chassis=0,slot=6,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp7,bus=pcie.0,chassis=0,slot=7,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp8,bus=pcie.0,chassis=0,slot=8,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device pcie-root-port,id=rp9,bus=pcie.0,chassis=0,slot=9,multifunction=off,pref64-reserve=274877906944B,mem-reserve=4194304B -device vhost-vsock-pci,disable-modern=false,vhostfd=4,id=vsock-3257660399,guest-cid=3257660399 -chardev socket,id=char-c3493397927c7b53,path=/run/vc/vm/3f219f48134f8da7b5faa009eccaafd50eef417c5e2d6ea4ed0f86c7ddacefaf/vhost-fs.sock -device vhost-user-fs-pci,chardev=char-c3493397927c7b53,tag=kataShared,queue-size=1024 -netdev tap,id=network-0,vhost=on,vhostfds=5,fds=6 -device driver=virtio-net-pci,netdev=network-0,mac=f6:c9:df:61:71:4b,disable-modern=false,mq=on,vectors=4 -rtc base=utc,driftfix=slew,clock=host -global kvm-pit.lost_tick_policy=discard -vga none -no-user-config -nodefaults -nographic --no-reboot -object memory-backend-file,id=dimm1,size=10240M,mem-path=/dev/hugepages,share=on,prealloc=on -numa node,memdev=dimm1 -kernel /opt/kata/share/kata-containers/vmlinux-6.12.47-166-nvidia-gpu -initrd /opt/kata/share/kata-containers/kata-ubuntu-noble-nvidia-gpu-580.65.06.initrd -append tsc=reliable no_timer_check rcupdate.rcu_expedited=1 i8042.direct=1 i8042.dumbkbd=1 i8042.nopnp=1 i8042.noaux=1 noreplace-smp reboot=k cryptomgr.notests net.ifnames=0 pci=lastbus=0 console=hvc0 console=hvc1 debug panic=1 nr_cpus=224 selinux=0 scsi_mod.scan=none agent.log=debug agent.debug_console agent.debug_console_vport=1026 agent.debug_console agent.debug_console_vport=1026 agent.hotplug_timeout=20 cgroup_no_v1=all -pidfile /run/vc/vm/3f219f48134f8da7b5faa009eccaafd50eef417c5e2d6ea4ed0f86c7ddacefaf/pid -smp 1,cores=1,threads=1,sockets=224,maxcpus=224
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>        Address Perm       Offset Device     Inode       Size    Rss    Pss Pss_Dirty Referenced Anonymous  KSM LazyFree ShmemPmdMapped FilePmdMapped Shared_Hugetlb Private_Hugetlb Swap SwapPss Locked THPeligible ProtectionKey Mapping
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>    55556e427000 rw-p     00000000  00:00         0     122196 105836 105836    105836     105836    105836    0        0              0             0              0               0    0       0      0           0             0 [heap]
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>    736480000000 rw-s     00000000  00:22 192796858  104857600      0      0         0          0         0    0        0              0             0              0       104857600    0       0      0           0             0 qemu_back_mem.mem0.nWhJ9P (deleted)
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>    737d80000000 ---p     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a>    737dc0000000 rw-s 43a000000000  00:0f      1050  134217728      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a>    739e00000000 rw-s 3fa000000000  00:0f      1050  134217728      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a>    73be40000000 rw-s 3da000000000  00:0f      1050  134217728      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a>    73de80000000 rw-s 3ba000000000  00:0f      1050  134217728      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a>    73fec0000000 rw-s 57a000000000  00:0f      1050  134217728      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a>    741f00000000 rw-s 53a000000000  00:0f      1050  134217728      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a>    743f38000000 rw-p     00000000  00:00         0        132     52     52        52         52        52    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-14"><a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a>    743f38021000 ---p     00000000  00:00         0      65404      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-15"><a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a>    743f40000000 rw-s 4fa000000000  00:0f      1050  134217728      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-16"><a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a>    745f48000000 rw-s 43e040000000  00:0f      1050      32768      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-17"><a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a>    745f4c000000 rw-s 43e042000000  00:0f      1050      16384      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-18"><a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a>    745f4e000000 rw-s 3fe040000000  00:0f      1050      32768      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-19"><a id="__codelineno-54-19" name="__codelineno-54-19" href="#__codelineno-54-19"></a>    745f52000000 rw-s 3fe042000000  00:0f      1050      16384      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-20"><a id="__codelineno-54-20" name="__codelineno-54-20" href="#__codelineno-54-20"></a>    745f54000000 rw-s 3de040000000  00:0f      1050      32768      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-21"><a id="__codelineno-54-21" name="__codelineno-54-21" href="#__codelineno-54-21"></a>    745f58000000 rw-s 3de042000000  00:0f      1050      16384      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-22"><a id="__codelineno-54-22" name="__codelineno-54-22" href="#__codelineno-54-22"></a>    745f5a000000 rw-s 3be040000000  00:0f      1050      32768      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-23"><a id="__codelineno-54-23" name="__codelineno-54-23" href="#__codelineno-54-23"></a>    745f5e000000 rw-s 3be042000000  00:0f      1050      16384      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-24"><a id="__codelineno-54-24" name="__codelineno-54-24" href="#__codelineno-54-24"></a>    745f60000000 rw-s 57e040000000  00:0f      1050      32768      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-25"><a id="__codelineno-54-25" name="__codelineno-54-25" href="#__codelineno-54-25"></a>    745f64000000 rw-s 57e042000000  00:0f      1050      16384      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-26"><a id="__codelineno-54-26" name="__codelineno-54-26" href="#__codelineno-54-26"></a>    745f66000000 rw-s 53e040000000  00:0f      1050      32768      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-27"><a id="__codelineno-54-27" name="__codelineno-54-27" href="#__codelineno-54-27"></a>    745f6a000000 rw-s 53e042000000  00:0f      1050      16384      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-28"><a id="__codelineno-54-28" name="__codelineno-54-28" href="#__codelineno-54-28"></a>    745f6c000000 rw-s 4fe040000000  00:0f      1050      32768      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-29"><a id="__codelineno-54-29" name="__codelineno-54-29" href="#__codelineno-54-29"></a>    745f6e400000 rw-p     00000000 103:1f   6553612     289048  20864  20864         0      20864         0    0        0              0             0              0               0    0       0      0           0             0 vmlinux-6.12.47-166-nvidia-gpu
</span><span id="__span-54-30"><a id="__codelineno-54-30" name="__codelineno-54-30" href="#__codelineno-54-30"></a>    745f80000000 rw-s     00000000  00:22 192846868   10485760      0      0         0          0         0    0        0              0             0        3145728         7340032    0       0      0           0             0 qemu_back_mem.dimm1.8mPNaQ (deleted)
</span><span id="__span-54-31"><a id="__codelineno-54-31" name="__codelineno-54-31" href="#__codelineno-54-31"></a>    746200000000 ---p     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-32"><a id="__codelineno-54-32" name="__codelineno-54-32" href="#__codelineno-54-32"></a>    746202000000 rw-s 4fe042000000  00:0f      1050      16384      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:[vfio-device]
</span><span id="__span-54-33"><a id="__codelineno-54-33" name="__codelineno-54-33" href="#__codelineno-54-33"></a>    746203e00000 r--p     00000000 103:1f   6553611     132788 132788 132788         0     132788         0    0        0              0             0              0               0    0       0      0           0             0 kata-ubuntu-noble-nvidia-gpu-580.65.06.initrd
</span><span id="__span-54-34"><a id="__codelineno-54-34" name="__codelineno-54-34" href="#__codelineno-54-34"></a>    74620c000000 rw-p     00000000  00:00         0        132     68     68        68         68        68    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-35"><a id="__codelineno-54-35" name="__codelineno-54-35" href="#__codelineno-54-35"></a>    74620c021000 ---p     00000000  00:00         0      65404      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-36"><a id="__codelineno-54-36" name="__codelineno-54-36" href="#__codelineno-54-36"></a>    746210000000 rw-p     00000000  00:00         0      56880   2228   2228      2228       2228      2228    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-37"><a id="__codelineno-54-37" name="__codelineno-54-37" href="#__codelineno-54-37"></a>    74621378c000 ---p     00000000  00:00         0       8656      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-38"><a id="__codelineno-54-38" name="__codelineno-54-38" href="#__codelineno-54-38"></a>    746214000000 rw-p     00000000  00:00         0        132     12     12        12         12        12    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-39"><a id="__codelineno-54-39" name="__codelineno-54-39" href="#__codelineno-54-39"></a>    746214021000 ---p     00000000  00:00         0      65404      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-40"><a id="__codelineno-54-40" name="__codelineno-54-40" href="#__codelineno-54-40"></a>    7462197ff000 ---p     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-41"><a id="__codelineno-54-41" name="__codelineno-54-41" href="#__codelineno-54-41"></a>    746219800000 rw-p     00000000  00:00         0       8192     12     12        12         12        12    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-42"><a id="__codelineno-54-42" name="__codelineno-54-42" href="#__codelineno-54-42"></a>    74621a000000 rw-p     00000000  00:00         0          4      4      4         4          4         4    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-43"><a id="__codelineno-54-43" name="__codelineno-54-43" href="#__codelineno-54-43"></a>    74621a001000 ---p     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-44"><a id="__codelineno-54-44" name="__codelineno-54-44" href="#__codelineno-54-44"></a>    74621a200000 rw-p     00000000  00:00         0         64     64      4         4         64        64   60        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-45"><a id="__codelineno-54-45" name="__codelineno-54-45" href="#__codelineno-54-45"></a>    74621a210000 ---p     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-46"><a id="__codelineno-54-46" name="__codelineno-54-46" href="#__codelineno-54-46"></a>    74621a400000 rw-p     00000000  00:00         0       2048   2048     54        54       2048      2048 2004        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-47"><a id="__codelineno-54-47" name="__codelineno-54-47" href="#__codelineno-54-47"></a>    74621a600000 ---p     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-48"><a id="__codelineno-54-48" name="__codelineno-54-48" href="#__codelineno-54-48"></a>    74621a800000 rw-p     00000000  00:00         0        256    160    160       160        160       160    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-49"><a id="__codelineno-54-49" name="__codelineno-54-49" href="#__codelineno-54-49"></a>    74621a840000 ---p     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-50"><a id="__codelineno-54-50" name="__codelineno-54-50" href="#__codelineno-54-50"></a>    74621aa0a000 rw-p     00000000  00:00         0        924    924    924       924        924       924    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-51"><a id="__codelineno-54-51" name="__codelineno-54-51" href="#__codelineno-54-51"></a>    74621ac00000 rw-p     00000000  00:00         0        128      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-52"><a id="__codelineno-54-52" name="__codelineno-54-52" href="#__codelineno-54-52"></a>    74621ac20000 ---p     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-53"><a id="__codelineno-54-53" name="__codelineno-54-53" href="#__codelineno-54-53"></a>    74621ac64000 rw-p     00000000  00:00         0       1648   1648   1648      1648       1648      1648    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-54"><a id="__codelineno-54-54" name="__codelineno-54-54" href="#__codelineno-54-54"></a>    74621ae00000 rw-p     00000000  00:00         0        256    256    256       256        256       256    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-55"><a id="__codelineno-54-55" name="__codelineno-54-55" href="#__codelineno-54-55"></a>    74621ae40000 ---p     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-56"><a id="__codelineno-54-56" name="__codelineno-54-56" href="#__codelineno-54-56"></a>    74621af3a000 ---p     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-57"><a id="__codelineno-54-57" name="__codelineno-54-57" href="#__codelineno-54-57"></a>    74621af3b000 rw-p     00000000  00:00         0       8192     32     32        32         32        32    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-58"><a id="__codelineno-54-58" name="__codelineno-54-58" href="#__codelineno-54-58"></a>    74621b73b000 ---p     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-59"><a id="__codelineno-54-59" name="__codelineno-54-59" href="#__codelineno-54-59"></a>    74621b73c000 rw-p     00000000  00:00         0       8192     12     12        12         12        12    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-60"><a id="__codelineno-54-60" name="__codelineno-54-60" href="#__codelineno-54-60"></a>    74621bf3c000 rw-p     00000000  00:00         0        780    780    780       780        780       780    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-61"><a id="__codelineno-54-61" name="__codelineno-54-61" href="#__codelineno-54-61"></a>    74621bfff000 ---p     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-62"><a id="__codelineno-54-62" name="__codelineno-54-62" href="#__codelineno-54-62"></a>    74621c000000 rw-p     00000000  00:00         0       8192      8      8         8          8         8    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-63"><a id="__codelineno-54-63" name="__codelineno-54-63" href="#__codelineno-54-63"></a>    74621c800000 r--p     00000000 103:1f   6553641       3020   3020   3020         0       3020         0    0        0              0             0              0               0    0       0      0           0             0 qemu-system-x86_64
</span><span id="__span-54-64"><a id="__codelineno-54-64" name="__codelineno-54-64" href="#__codelineno-54-64"></a>    74621caf3000 r-xp     002f3000 103:1f   6553641       7144   6776   6776         0       6776         0    0        0              0             0              0               0    0       0      0           0             0 qemu-system-x86_64
</span><span id="__span-54-65"><a id="__codelineno-54-65" name="__codelineno-54-65" href="#__codelineno-54-65"></a>    74621d1ed000 r--p     009ed000 103:1f   6553641       3804   2012   2012         0       2012         0    0        0              0             0              0               0    0       0      0           0             0 qemu-system-x86_64
</span><span id="__span-54-66"><a id="__codelineno-54-66" name="__codelineno-54-66" href="#__codelineno-54-66"></a>    74621d5a4000 r--p     00da3000 103:1f   6553641      12140   1560   1560      1560       1560      1560    0        0              0             0              0               0    0       0      0           0             0 qemu-system-x86_64
</span><span id="__span-54-67"><a id="__codelineno-54-67" name="__codelineno-54-67" href="#__codelineno-54-67"></a>    74621e17f000 rw-p     0197e000 103:1f   6553641        892    892    892       888        892       888    0        0              0             0              0               0    0       0      0           0             0 qemu-system-x86_64
</span><span id="__span-54-68"><a id="__codelineno-54-68" name="__codelineno-54-68" href="#__codelineno-54-68"></a>    74621e25e000 rw-p     00000000  00:00         0         64     48     48        48         48        48    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-69"><a id="__codelineno-54-69" name="__codelineno-54-69" href="#__codelineno-54-69"></a>    74621e274000 rw-s     00000000  00:0f      1050         12      8      8         8          8         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:kvm-vcpu:223
</span><span id="__span-54-70"><a id="__codelineno-54-70" name="__codelineno-54-70" href="#__codelineno-54-70"></a>    74621e277000 rw-s     00000000  00:0f      1050         12     12     12        12         12         0    0        0              0             0              0               0    0       0      0           0             0 anon_inode:kvm-vcpu:0
</span><span id="__span-54-71"><a id="__codelineno-54-71" name="__codelineno-54-71" href="#__codelineno-54-71"></a>    74621e27a000 rw-s     00000000  00:01     26803          4      4      4         4          4         0    0        0              0             0              0               0    0       0      0           0             0 zero (deleted)
</span><span id="__span-54-72"><a id="__codelineno-54-72" name="__codelineno-54-72" href="#__codelineno-54-72"></a>    74621e27b000 rw-p     00000000  00:00         0        780    780    780       780        780       780    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-73"><a id="__codelineno-54-73" name="__codelineno-54-73" href="#__codelineno-54-73"></a>    74621e33e000 ---p     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-74"><a id="__codelineno-54-74" name="__codelineno-54-74" href="#__codelineno-54-74"></a>    74621e33f000 rw-p     00000000  00:00         0       1024      4      4         4          4         4    0        0              0             0              0               0    0       0      0           0             0 
</span><span id="__span-54-75"><a id="__codelineno-54-75" name="__codelineno-54-75" href="#__codelineno-54-75"></a>    7fffd39f2000 rw-p     00000000  00:00         0        136     40     40        40         40        40    0        0              0             0              0               0    0       0      0           0             0 [stack]
</span><span id="__span-54-76"><a id="__codelineno-54-76" name="__codelineno-54-76" href="#__codelineno-54-76"></a>    7fffd3b9a000 r--p     00000000  00:00         0         16      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 [vvar]
</span><span id="__span-54-77"><a id="__codelineno-54-77" name="__codelineno-54-77" href="#__codelineno-54-77"></a>    7fffd3b9e000 r-xp     00000000  00:00         0          8      4      0         0          4         0    0        0              0             0              0               0    0       0      0           0             0 [vdso]
</span><span id="__span-54-78"><a id="__codelineno-54-78" name="__codelineno-54-78" href="#__codelineno-54-78"></a>ffffffffff600000 --xp     00000000  00:00         0          4      0      0         0          0         0    0        0              0             0              0               0    0       0      0           0             0 [vsyscall]
</span><span id="__span-54-79"><a id="__codelineno-54-79" name="__codelineno-54-79" href="#__codelineno-54-79"></a>                                                    ========== ====== ====== ========= ========== ========= ==== ======== ============== ============= ============== =============== ==== ======= ====== =========== ============= 
</span><span id="__span-54-80"><a id="__codelineno-54-80" name="__codelineno-54-80" href="#__codelineno-54-80"></a>                                                    1056085684 282956 280898    115434     282956    117464 2064        0              0             0        3145728       112197632    0       0      0           0             0 KB 
</span></code></pre></div>
</details>
<p>In case you didn't believe me that hugepages are turned on, we can drill down and compare the most relevant lines of this memory map. Recall the memory mapping of these <code>qemu_back_mem</code> entries with hugepages turned off:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">off</label><label for="__tabbed_1_2">on</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>        Address Perm       Offset Device   Inode       Size       Rss       Pss Pss_Dirty Referenced Anonymous  KSM LazyFree ShmemPmdMapped FilePmdMapped Shared_Hugetlb Private_Hugetlb Swap SwapPss Locked THPeligible ProtectionKey Mapping
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>    711ebffff000 rw-s     00000000  00:1c     252  104857600 104857600 104857600 104857600  104857600         0    0        0              0             0              0               0    0       0      0           0             0 qemu_back_mem.mem0.mvNUmy (deleted)
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>    72199ffff000 rw-s     00000000  00:1c     251   10485760  10485760  10475768  10475768   10485760         0    0        0              0             0              0               0    0       0      0           0             0 qemu_back_mem.dimm1.R0EWjI (deleted)
</span></code></pre></div>
<p>The <code>{Shared,Private}_Hugetlb</code> lines for these are both zero.</p>
</div>
<div class="tabbed-block">
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>        Address Perm       Offset Device     Inode       Size    Rss    Pss Pss_Dirty Referenced Anonymous  KSM LazyFree ShmemPmdMapped FilePmdMapped Shared_Hugetlb Private_Hugetlb Swap SwapPss Locked THPeligible ProtectionKey Mapping
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>    736480000000 rw-s     00000000  00:22 192796858  104857600      0      0         0          0         0    0        0              0             0              0       104857600    0       0      0           0             0 qemu_back_mem.mem0.nWhJ9P (deleted)
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>    745f80000000 rw-s     00000000  00:22 192846868   10485760      0      0         0          0         0    0        0              0             0        3145728         7340032    0       0      0           0             0 qemu_back_mem.dimm1.8mPNaQ (deleted)
</span></code></pre></div>
<p>The Hugetlb columns are now non-zero.</p>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you pass in the <code>-p</code> flag, you can see that these entries are actually files <abbr title="Quick Emulator">QEMU</abbr> opened in <code>/dev/shm</code>. For example:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>0000711ebffff000 104857600K rw-s- /dev/shm/qemu_back_mem.mem0.mvNUmy (deleted)
</span></code></pre></div>
</div>
<h2 id="performance-problems-with-vfio-mmio-mappings">Performance Problems with VFIO <abbr title="Memory Mapped IO">MMIO</abbr> Mappings<a class="headerlink" href="#performance-problems-with-vfio-mmio-mappings" title="Permanent link">&para;</a></h2>
<p>When I first started the Kata containers exploration, I was running it on Linux kernel 5.15.0. Multi-GPU containers suffered from extremely long boot times, over 30 minutes in the 8-GPU case. Additionally, the boot time seemed to scale almost exponentially the more GPUs were being attached to the VM. I later updated to kernel 6.8.0 at the recommendation of the Kata developers and also switched to the IOMMUFD backend for vfio-pci. After doing this, the boot times were reduced essentially by one order of magnitude. Let me unpack exactly what all of that means...</p>
<p>Apparently, older versions of Linux used to page fault every single page that was being <abbr title="Input-Output Memory Management Unit">IOMMU</abbr>-mapped, something confirmed by an email I sent to the Linux <abbr title="Input-Output Memory Management Unit">IOMMU</abbr> developers: <a href="https://lore.kernel.org/linux-iommu/20251122001953.GL233636@ziepe.ca/T/#t">https://lore.kernel.org/linux-iommu/20251122001953.GL233636@ziepe.ca/T/#t</a></p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>* Explanation of VM Boot Performance Gains with IOMMUFD
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>@ 2025-11-17 17:31 Landon Clipp
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>  2025-11-22  0:19 ` Jason Gunthorpe
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>  0 siblings, 1 reply; 2+ messages in thread
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>From: Landon Clipp @ 2025-11-17 17:31 UTC (permalink / raw)
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>  To: iommu
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>Hi folks,
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a>I have a Kubernetes cluster whereby containers are spawned inside of
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a>VMs (Kata Containers). These VMs have 8 NVIDIA H100 GPUs (from a
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a>Supermicro HGX box) passed through with vfio-pci. Passing through the
</span><span id="__span-58-13"><a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a>GPUs with the legacy VFIO cdev corresponded to boot times of around 30
</span><span id="__span-58-14"><a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a>minutes, while passing through with the IOMMUFD API brought it down to
</span><span id="__span-58-15"><a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a>around 3 minutes.
</span><span id="__span-58-16"><a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a>
</span><span id="__span-58-17"><a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a>I have asked numerous Linux virtualization experts as to why I am
</span><span id="__span-58-18"><a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a>seeing this behavior and none have been able to properly answer. I
</span><span id="__span-58-19"><a id="__codelineno-58-19" name="__codelineno-58-19" href="#__codelineno-58-19"></a>wanted to know if there was some salient difference between how
</span><span id="__span-58-20"><a id="__codelineno-58-20" name="__codelineno-58-20" href="#__codelineno-58-20"></a>IOMMUFD and the legacy VFIO API handle IOMMU page mappings that would
</span><span id="__span-58-21"><a id="__codelineno-58-21" name="__codelineno-58-21" href="#__codelineno-58-21"></a>account for this performance difference.
</span><span id="__span-58-22"><a id="__codelineno-58-22" name="__codelineno-58-22" href="#__codelineno-58-22"></a>
</span><span id="__span-58-23"><a id="__codelineno-58-23" name="__codelineno-58-23" href="#__codelineno-58-23"></a>Regards,
</span><span id="__span-58-24"><a id="__codelineno-58-24" name="__codelineno-58-24" href="#__codelineno-58-24"></a>--
</span><span id="__span-58-25"><a id="__codelineno-58-25" name="__codelineno-58-25" href="#__codelineno-58-25"></a>Landon Clipp
</span><span id="__span-58-26"><a id="__codelineno-58-26" name="__codelineno-58-26" href="#__codelineno-58-26"></a>
</span><span id="__span-58-27"><a id="__codelineno-58-27" name="__codelineno-58-27" href="#__codelineno-58-27"></a>^ permalink raw reply   [flat|nested] 2+ messages in thread
</span><span id="__span-58-28"><a id="__codelineno-58-28" name="__codelineno-58-28" href="#__codelineno-58-28"></a>* Re: Explanation of VM Boot Performance Gains with IOMMUFD
</span><span id="__span-58-29"><a id="__codelineno-58-29" name="__codelineno-58-29" href="#__codelineno-58-29"></a>  2025-11-17 17:31 Explanation of VM Boot Performance Gains with IOMMUFD Landon Clipp
</span><span id="__span-58-30"><a id="__codelineno-58-30" name="__codelineno-58-30" href="#__codelineno-58-30"></a>@ 2025-11-22  0:19 ` Jason Gunthorpe
</span><span id="__span-58-31"><a id="__codelineno-58-31" name="__codelineno-58-31" href="#__codelineno-58-31"></a>  0 siblings, 0 replies; 2+ messages in thread
</span><span id="__span-58-32"><a id="__codelineno-58-32" name="__codelineno-58-32" href="#__codelineno-58-32"></a>From: Jason Gunthorpe @ 2025-11-22  0:19 UTC (permalink / raw)
</span><span id="__span-58-33"><a id="__codelineno-58-33" name="__codelineno-58-33" href="#__codelineno-58-33"></a>  To: Landon Clipp; +Cc: iommu
</span><span id="__span-58-34"><a id="__codelineno-58-34" name="__codelineno-58-34" href="#__codelineno-58-34"></a>
</span><span id="__span-58-35"><a id="__codelineno-58-35" name="__codelineno-58-35" href="#__codelineno-58-35"></a>On Mon, Nov 17, 2025 at 11:31:03AM -0600, Landon Clipp wrote:
</span><span id="__span-58-36"><a id="__codelineno-58-36" name="__codelineno-58-36" href="#__codelineno-58-36"></a>&gt; Hi folks,
</span><span id="__span-58-37"><a id="__codelineno-58-37" name="__codelineno-58-37" href="#__codelineno-58-37"></a>&gt; 
</span><span id="__span-58-38"><a id="__codelineno-58-38" name="__codelineno-58-38" href="#__codelineno-58-38"></a>&gt; I have a Kubernetes cluster whereby containers are spawned inside of
</span><span id="__span-58-39"><a id="__codelineno-58-39" name="__codelineno-58-39" href="#__codelineno-58-39"></a>&gt; VMs (Kata Containers). These VMs have 8 NVIDIA H100 GPUs (from a
</span><span id="__span-58-40"><a id="__codelineno-58-40" name="__codelineno-58-40" href="#__codelineno-58-40"></a>&gt; Supermicro HGX box) passed through with vfio-pci. Passing through the
</span><span id="__span-58-41"><a id="__codelineno-58-41" name="__codelineno-58-41" href="#__codelineno-58-41"></a>&gt; GPUs with the legacy VFIO cdev corresponded to boot times of around 30
</span><span id="__span-58-42"><a id="__codelineno-58-42" name="__codelineno-58-42" href="#__codelineno-58-42"></a>&gt; minutes, while passing through with the IOMMUFD API brought it down to
</span><span id="__span-58-43"><a id="__codelineno-58-43" name="__codelineno-58-43" href="#__codelineno-58-43"></a>&gt; around 3 minutes.
</span><span id="__span-58-44"><a id="__codelineno-58-44" name="__codelineno-58-44" href="#__codelineno-58-44"></a>
</span><span id="__span-58-45"><a id="__codelineno-58-45" name="__codelineno-58-45" href="#__codelineno-58-45"></a>30 mins seems so unreasonable, are you sure you aren&#39;t hitting one of
</span><span id="__span-58-46"><a id="__codelineno-58-46" name="__codelineno-58-46" href="#__codelineno-58-46"></a>those kernels that is faulting every GPU page? That was fixed at some
</span><span id="__span-58-47"><a id="__codelineno-58-47" name="__codelineno-58-47" href="#__codelineno-58-47"></a>point. Though iommufd with the OOT patch would hit the same issue.
</span><span id="__span-58-48"><a id="__codelineno-58-48" name="__codelineno-58-48" href="#__codelineno-58-48"></a>
</span><span id="__span-58-49"><a id="__codelineno-58-49" name="__codelineno-58-49" href="#__codelineno-58-49"></a>I fully expect that when qemu uses a memfd and uses dmabuf iommufd
</span><span id="__span-58-50"><a id="__codelineno-58-50" name="__codelineno-58-50" href="#__codelineno-58-50"></a>will boot much, much faster that vfio ever could, it has so much less
</span><span id="__span-58-51"><a id="__codelineno-58-51" name="__codelineno-58-51" href="#__codelineno-58-51"></a>overhead.
</span><span id="__span-58-52"><a id="__codelineno-58-52" name="__codelineno-58-52" href="#__codelineno-58-52"></a>
</span><span id="__span-58-53"><a id="__codelineno-58-53" name="__codelineno-58-53" href="#__codelineno-58-53"></a>Jason
</span><span id="__span-58-54"><a id="__codelineno-58-54" name="__codelineno-58-54" href="#__codelineno-58-54"></a>
</span><span id="__span-58-55"><a id="__codelineno-58-55" name="__codelineno-58-55" href="#__codelineno-58-55"></a>^ permalink raw reply   [flat|nested] 2+ messages in thread
</span><span id="__span-58-56"><a id="__codelineno-58-56" name="__codelineno-58-56" href="#__codelineno-58-56"></a>end of thread, other threads:[~2025-11-22  0:19 UTC | newest]
</span><span id="__span-58-57"><a id="__codelineno-58-57" name="__codelineno-58-57" href="#__codelineno-58-57"></a>
</span><span id="__span-58-58"><a id="__codelineno-58-58" name="__codelineno-58-58" href="#__codelineno-58-58"></a>Thread overview: 2+ messages (download: mbox.gz follow: Atom feed
</span><span id="__span-58-59"><a id="__codelineno-58-59" name="__codelineno-58-59" href="#__codelineno-58-59"></a>-- links below jump to the message on this page --
</span><span id="__span-58-60"><a id="__codelineno-58-60" name="__codelineno-58-60" href="#__codelineno-58-60"></a>2025-11-17 17:31 Explanation of VM Boot Performance Gains with IOMMUFD Landon Clipp
</span><span id="__span-58-61"><a id="__codelineno-58-61" name="__codelineno-58-61" href="#__codelineno-58-61"></a>2025-11-22  0:19 ` Jason Gunthorpe
</span><span id="__span-58-62"><a id="__codelineno-58-62" name="__codelineno-58-62" href="#__codelineno-58-62"></a>This is a public inbox, see mirroring instructions
</span><span id="__span-58-63"><a id="__codelineno-58-63" name="__codelineno-58-63" href="#__codelineno-58-63"></a>for how to clone and mirror all data and code used for this inbox;
</span><span id="__span-58-64"><a id="__codelineno-58-64" name="__codelineno-58-64" href="#__codelineno-58-64"></a>as well as URLs for NNTP newsgroup(s).
</span></code></pre></div>
<p>This seems to independently agree with what I was seeing internally at the company <a href="lambda.ai">Lambda</a> that I work for. We had been having issues with the VFIO driver unnecessarily faulting in every page of <abbr title="Memory Mapped IO">MMIO</abbr>-mapped memory. This was mainly because VFIO was originally designed to map device IOVAs to physical RAM, so in this case it obviously makes sense to fault in every page to ensure the page always exists in memory. However when <abbr title="Memory Mapped IO">MMIO</abbr> mappings were being created between host virtual addresses to PCIe device <abbr title="Base Address Register">BARs</abbr>, it incorrectly faulted in every single page. This amounted to walking across 33 million pages for every map or unmap of the <abbr title="Memory Mapped IO">MMIO</abbr> regions for a single H100 GPU!</p>
<p>As much as I would love to show you the exact pull request that fixed this, honestly the answer I received second hand is good enough for me. The moral of the story is that you should always use the latest Linux kernel version that you reasonably can. </p>
<h3 id="is-iommufd-faster-than-legacy-vfio-backend">Is IOMMUFD Faster Than Legacy VFIO Backend?<a class="headerlink" href="#is-iommufd-faster-than-legacy-vfio-backend" title="Permanent link">&para;</a></h3>
<p>To recap, the vfio-pci Linux kernel driver provides a way for userspace programs to act as device drivers. This is relevant when guest VMs need to run NVIDIA kernel drivers for the GPUs, as you'll recall that we attach vfio-pci to the GPU as its driver, then we provide <abbr title="Quick Emulator">QEMU</abbr> a handle (such as <code>/dev/vfio/33</code> or whatever the path is) for that device. This gives <abbr title="Quick Emulator">QEMU</abbr> access to the VFIO API. <abbr title="Quick Emulator">QEMU</abbr> then maps the device <abbr title="Base Address Register">BARs</abbr> it sees into the guest's <abbr title="Memory Mapped IO">MMIO</abbr> region so that the NVIDIA kernel driver <em>inside</em> can attach to it. Yes it is all a very complicated dance, and if you're confused, don't worry. It took me a long time to get this straight in my head.</p>
<p>Anyway, the vfio-pci kernel driver had a legacy integration with the Linux <abbr title="Input-Output Memory Management Unit">IOMMU</abbr> subsystem that was implemented in <code>drivers/vfio/vfio_iommu_type1.c</code>. This is the legacy <abbr title="Input-Output Memory Management Unit">IOMMU</abbr> backend code VFIO used. For a number of reasons that aren't totally relevant (and that are explained <a href="https://www.qemu.org/docs/master/devel/vfio-iommufd.html">here</a>), the VFIO driver was updated to allow users to provide an IOMMUFD file descriptor to the VFIO driver. Instead of interacting with <abbr title="Input-Output Memory Management Unit">IOMMU</abbr> groups (as done in the legacy VFIO backend), users have access to IOMMUFD file descriptors that represent single PCIe devices.</p>
<p>It was previously suggested to me that using IOMMUFD would give me large performance benefits when <abbr title="Input-Output Memory Management Unit">IOMMU</abbr> mapping operations were done. I pitted IOMMUFD against the legacy VFIO backend to see if there was any noticable performance difference. I did this by updating my CDI device DaemonSet to pass in the <code>/dev/vfio/devices/*</code> paths like so:</p>
<div class="language-json highlight"><span class="filename">/var/run/cdi/nvidia-gpu.json</span><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="p">{</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="w">  </span><span class="nt">&quot;cdiVersion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0.7.0&quot;</span><span class="p">,</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="w">  </span><span class="nt">&quot;kind&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;nvidia.com/gpu&quot;</span><span class="p">,</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="w">  </span><span class="nt">&quot;containerEdits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="w">  </span><span class="nt">&quot;devices&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="w">      </span><span class="nt">&quot;containerEdits&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="w">        </span><span class="nt">&quot;deviceNodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-59-10"><a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-59-11"><a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a><span class="w">            </span><span class="nt">&quot;path&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/dev/vfio/devices/vfio0&quot;</span><span class="p">,</span>
</span><span id="__span-59-12"><a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a><span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;c&quot;</span><span class="p">,</span>
</span><span id="__span-59-13"><a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a><span class="w">            </span><span class="nt">&quot;permissions&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;rwm&quot;</span>
</span><span id="__span-59-14"><a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-59-15"><a id="__codelineno-59-15" name="__codelineno-59-15" href="#__codelineno-59-15"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-59-16"><a id="__codelineno-59-16" name="__codelineno-59-16" href="#__codelineno-59-16"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-59-17"><a id="__codelineno-59-17" name="__codelineno-59-17" href="#__codelineno-59-17"></a><span class="w">    </span><span class="p">},</span>
</span></code></pre></div>
<p>I then tested the VM boot performance with and without this change.</p>
<h4 id="legacy-vfio-backend">Legacy VFIO Backend<a class="headerlink" href="#legacy-vfio-backend" title="Permanent link">&para;</a></h4>
<p>The runtime with the legacy backend is as such:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a>Start Time:          Mon, 08 Dec 2025 20:14:58 +0000
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>      Started:      Mon, 08 Dec 2025 20:17:23 +0000
</span></code></pre></div>
<p>That's 2:25 minutes. And you can see the legacy VFIO handles being used:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a># ls -lah /proc/1196278/fd |&amp; egrep &#39;vfio|iommu&#39;
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>lrwx------ 1 root root  64 Dec  8 20:15 127 -&gt; /dev/vfio/57
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>lrwx------ 1 root root  64 Dec  8 20:15 128 -&gt; /dev/vfio/vfio
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>lrwx------ 1 root root  64 Dec  8 20:15 129 -&gt; anon_inode:kvm-vfio
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a>lrwx------ 1 root root  64 Dec  8 20:15 130 -&gt; anon_inode:[vfio-device]
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>lrwx------ 1 root root  64 Dec  8 20:15 135 -&gt; /dev/vfio/46
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>lrwx------ 1 root root  64 Dec  8 20:15 136 -&gt; anon_inode:[vfio-device]
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a>lrwx------ 1 root root  64 Dec  8 20:15 141 -&gt; /dev/vfio/16
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a>lrwx------ 1 root root  64 Dec  8 20:15 142 -&gt; anon_inode:[vfio-device]
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a>lrwx------ 1 root root  64 Dec  8 20:15 147 -&gt; /dev/vfio/132
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a>lrwx------ 1 root root  64 Dec  8 20:15 148 -&gt; anon_inode:[vfio-device]
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a>lrwx------ 1 root root  64 Dec  8 20:15 153 -&gt; /dev/vfio/112
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a>lrwx------ 1 root root  64 Dec  8 20:15 154 -&gt; anon_inode:[vfio-device]
</span><span id="__span-61-14"><a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a>lrwx------ 1 root root  64 Dec  8 20:15 159 -&gt; /dev/vfio/86
</span><span id="__span-61-15"><a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a>lrwx------ 1 root root  64 Dec  8 20:15 160 -&gt; anon_inode:[vfio-device]
</span><span id="__span-61-16"><a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a>lrwx------ 1 root root  64 Dec  8 20:15 165 -&gt; /dev/vfio/66
</span><span id="__span-61-17"><a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a>lrwx------ 1 root root  64 Dec  8 20:15 166 -&gt; anon_inode:[vfio-device]
</span></code></pre></div>
<h4 id="iommufd-vfio-backend">IOMMUFD VFIO Backend<a class="headerlink" href="#iommufd-vfio-backend" title="Permanent link">&para;</a></h4>
<p>With the above change:</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>Start Time:          Mon, 08 Dec 2025 20:09:54 +0000
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>      Started:      Mon, 08 Dec 2025 20:11:48 +0000
</span></code></pre></div>
<p>That's 1:54 minutes, which is a solid 31 second reduction in performance! It's a clear difference when we tweak that single factor.</p>
<div class="language-text highlight"><span class="filename">Text Only</span><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a># ls -lah /proc/1193235/fd |&amp; egrep &#39;vfio|iommu&#39;
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>lrwx------ 1 root root  64 Dec  8 20:11 127 -&gt; /dev/iommu
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>lrwx------ 1 root root  64 Dec  8 20:11 128 -&gt; /dev/vfio/devices/vfio7
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>lrwx------ 1 root root  64 Dec  8 20:11 129 -&gt; anon_inode:kvm-vfio
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>lrwx------ 1 root root  64 Dec  8 20:11 134 -&gt; /dev/iommu
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a>lrwx------ 1 root root  64 Dec  8 20:11 135 -&gt; /dev/vfio/devices/vfio0
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>lrwx------ 1 root root  64 Dec  8 20:11 140 -&gt; /dev/iommu
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a>lrwx------ 1 root root  64 Dec  8 20:11 141 -&gt; /dev/vfio/devices/vfio1
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a>lrwx------ 1 root root  64 Dec  8 20:11 146 -&gt; /dev/iommu
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a>lrwx------ 1 root root  64 Dec  8 20:11 147 -&gt; /dev/vfio/devices/vfio2
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a>lrwx------ 1 root root  64 Dec  8 20:11 152 -&gt; /dev/iommu
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a>lrwx------ 1 root root  64 Dec  8 20:11 153 -&gt; /dev/vfio/devices/vfio3
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a>lrwx------ 1 root root  64 Dec  8 20:11 158 -&gt; /dev/iommu
</span><span id="__span-63-14"><a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a>lrwx------ 1 root root  64 Dec  8 20:11 159 -&gt; /dev/vfio/devices/vfio4
</span><span id="__span-63-15"><a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a>lrwx------ 1 root root  64 Dec  8 20:11 164 -&gt; /dev/iommu
</span><span id="__span-63-16"><a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a>lrwx------ 1 root root  64 Dec  8 20:11 165 -&gt; /dev/vfio/devices/vfio6
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Getting Kata to successfully use the IOMMUFD backend requires a patch that is not merged upstream: <a href="https://github.com/kata-containers/kata-containers/pull/12173">https://github.com/kata-containers/kata-containers/pull/12173</a></p>
</div>
<h2 id="parting-thoughts">Parting Thoughts<a class="headerlink" href="#parting-thoughts" title="Permanent link">&para;</a></h2>
<p>This post didn't have an exact agenda other than to prove to the world that Kata can in fact boot in 2 minutes given proper environmental configuration. If you didn't read anything else from this post, the key takeaways are:</p>
<ol>
<li>Use the latest Linux kernel version you can.</li>
<li>Use hugepages.</li>
<li>Use a kernel with 64KiB pages instead of 4KiB.</li>
<li>Use the IOMMUFD backend for VFIO.</li>
</ol>
<p>The other big takeaway is that there is still work to be done in this field, mainly surrounding Linux's inability to take advantage of Intel's VT-d hugepage capability. Linux appears to be hard-coded to use only 4KiB pages to program the Intel <abbr title="Input-Output Memory Management Unit">IOMMU</abbr> when VT-d additionally supports 1MiB and 1GiB. Solving this can shave an additional ~30 seconds off of our boot time.</p>
<p><a href="https://www.linkedin.com/in/jason-gunthorpe-5b154394/">Jason Gunthorpe</a> et al specifically have been doing incredible work in this domain. Jason's talks on IOMMUFD are really interesting and I recommend giving those videos below a watch.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There are almost certainly issues with conclusions I've made, or errors in my reasoning. There are only a select few people in the world who <em>actually</em> know what they're talking about regarding <abbr title="Input-Output Memory Management Unit">IOMMUs</abbr>, and I'm not one of them! If you find anything incorrect in this post, please feel free to leave a comment below.</p>
</div>
<h2 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://www.openeuler.org/en/blog/wxggg/2020-11-29-vfio-passthrough-2.html">https://www.openeuler.org/en/blog/wxggg/2020-11-29-vfio-passthrough-2.html</a></li>
<li><a href="https://cpaelzer.github.io/blogs/007-vfio-slow-startup/">https://cpaelzer.github.io/blogs/007-vfio-slow-startup/</a></li>
<li><a href="https://xillybus.com/tutorials/iommu-swiotlb-linux">https://xillybus.com/tutorials/iommu-swiotlb-linux</a></li>
<li><a href="https://www.youtube.com/watch?v=IE_A8wSWV7g">https://www.youtube.com/watch?v=IE_A8wSWV7g</a></li>
<li><a href="https://www.youtube.com/watch?v=ZkzqRznaR44">https://www.youtube.com/watch?v=ZkzqRznaR44</a></li>
</ul>







  
  



  


  



  <h2 id="__comments">Comments</h2>
  <!-- Insert generated snippet here -->
  <script src="https://giscus.app/client.js"
        data-repo="LandonTClipp/LandonTClipp.github.io"
        data-repo-id="R_kgDOJyEjoQ"
        data-category="Announcements"
        data-category-id="DIC_kwDOJyEjoc4CXXxl"
        data-mapping="url"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="en"
        crossorigin="anonymous"
        async>
    </script>
  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    /* Set palette on initial load */
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate" ? "dark" : "light"
      giscus.setAttribute("data-theme", theme) 
    }

    /* Register event handlers after documented loaded */
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate" ? "dark" : "light"

          /* Instruct Giscus to change theme */
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>

      
    </article>
  </div>

          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/LandonTClipp" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/landonclipp/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../../..", "features": ["content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "navigation.expand", "navigation.indexes", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.tracking", "navigation.top", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../../../../js/open_in_new_tab.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>